<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE CPP #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE RecordWildCards #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE DataKinds #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE DeriveFunctor #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE RankNTypes #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables #-}</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- | Please see the README.md file for examples of using this API.</span><span>
</span><a name="line-10"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">System.Process.Typed</span><span>
</span><a name="line-11"></a><span>    </span><span class="hs-special">(</span><span> </span><span class="hs-comment">-- * Types</span><span>
</span><a name="line-12"></a><span>      </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span>
</span><a name="line-13"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span>
</span><a name="line-14"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#StreamType"><span class="hs-identifier hs-type">StreamType</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span>
</span><a name="line-16"></a><span>
</span><a name="line-17"></a><span>      </span><span class="hs-comment">-- * ProcessConfig</span><span>
</span><a name="line-18"></a><span>      </span><span class="hs-comment">-- ** Smart constructors</span><span>
</span><a name="line-19"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#proc"><span class="hs-identifier hs-var">proc</span></a><span>
</span><a name="line-20"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#shell"><span class="hs-identifier hs-var">shell</span></a><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span>      </span><span class="hs-comment">-- ** Setters</span><span>
</span><a name="line-23"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setStdin"><span class="hs-identifier hs-var">setStdin</span></a><span>
</span><a name="line-24"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setStdout"><span class="hs-identifier hs-var">setStdout</span></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setStderr"><span class="hs-identifier hs-var">setStderr</span></a><span>
</span><a name="line-26"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setWorkingDir"><span class="hs-identifier hs-var">setWorkingDir</span></a><span>
</span><a name="line-27"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setWorkingDirInherit"><span class="hs-identifier hs-var">setWorkingDirInherit</span></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setEnv"><span class="hs-identifier hs-var">setEnv</span></a><span>
</span><a name="line-29"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setEnvInherit"><span class="hs-identifier hs-var">setEnvInherit</span></a><span>
</span><a name="line-30"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setCloseFds"><span class="hs-identifier hs-var">setCloseFds</span></a><span>
</span><a name="line-31"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setCreateGroup"><span class="hs-identifier hs-var">setCreateGroup</span></a><span>
</span><a name="line-32"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setDelegateCtlc"><span class="hs-identifier hs-var">setDelegateCtlc</span></a><span>
</span><a name="line-33"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 3, 0)
</span><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setDetachConsole"><span class="hs-identifier hs-var">setDetachConsole</span></a><span>
</span><a name="line-35"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setCreateNewConsole"><span class="hs-identifier hs-var">setCreateNewConsole</span></a><span>
</span><a name="line-36"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setNewSession"><span class="hs-identifier hs-var">setNewSession</span></a><span>
</span><a name="line-37"></a><span class="hs-cpp">#endif
#if MIN_VERSION_process(1, 4, 0) &amp;&amp; !WINDOWS
</span><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setChildGroup"><span class="hs-identifier hs-var">setChildGroup</span></a><span>
</span><a name="line-40"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setChildGroupInherit"><span class="hs-identifier hs-var">setChildGroupInherit</span></a><span>
</span><a name="line-41"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setChildUser"><span class="hs-identifier hs-var">setChildUser</span></a><span>
</span><a name="line-42"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#setChildUserInherit"><span class="hs-identifier hs-var">setChildUserInherit</span></a><span>
</span><a name="line-43"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-45"></a><span>      </span><span class="hs-comment">-- * Stream specs</span><span>
</span><a name="line-46"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span>
</span><a name="line-47"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#inherit"><span class="hs-identifier hs-var">inherit</span></a><span>
</span><a name="line-48"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#nullStream"><span class="hs-identifier hs-var">nullStream</span></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#closed"><span class="hs-identifier hs-var">closed</span></a><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#byteStringInput"><span class="hs-identifier hs-var">byteStringInput</span></a><span>
</span><a name="line-51"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span>
</span><a name="line-52"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#createPipe"><span class="hs-identifier hs-var">createPipe</span></a><span>
</span><a name="line-53"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#useHandleOpen"><span class="hs-identifier hs-var">useHandleOpen</span></a><span>
</span><a name="line-54"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#useHandleClose"><span class="hs-identifier hs-var">useHandleClose</span></a><span>
</span><a name="line-55"></a><span>
</span><a name="line-56"></a><span>      </span><span class="hs-comment">-- * Launch a process</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#startProcess"><span class="hs-identifier hs-var">startProcess</span></a><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#stopProcess"><span class="hs-identifier hs-var">stopProcess</span></a><span>
</span><a name="line-59"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#withProcessWait"><span class="hs-identifier hs-var">withProcessWait</span></a><span>
</span><a name="line-60"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#withProcessWait_"><span class="hs-identifier hs-var">withProcessWait_</span></a><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#withProcessTerm"><span class="hs-identifier hs-var">withProcessTerm</span></a><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#withProcessTerm_"><span class="hs-identifier hs-var">withProcessTerm_</span></a><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#withProcess_"><span class="hs-identifier hs-var">withProcess_</span></a><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcess"><span class="hs-identifier hs-var">readProcess</span></a><span>
</span><a name="line-66"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcess_"><span class="hs-identifier hs-var">readProcess_</span></a><span>
</span><a name="line-67"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#runProcess"><span class="hs-identifier hs-var">runProcess</span></a><span>
</span><a name="line-68"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#runProcess_"><span class="hs-identifier hs-var">runProcess_</span></a><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcessStdout"><span class="hs-identifier hs-var">readProcessStdout</span></a><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcessStdout_"><span class="hs-identifier hs-var">readProcessStdout_</span></a><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcessStderr"><span class="hs-identifier hs-var">readProcessStderr</span></a><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcessStderr_"><span class="hs-identifier hs-var">readProcessStderr_</span></a><span>
</span><a name="line-73"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcessInterleaved"><span class="hs-identifier hs-var">readProcessInterleaved</span></a><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#readProcessInterleaved_"><span class="hs-identifier hs-var">readProcessInterleaved_</span></a><span>
</span><a name="line-75"></a><span>
</span><a name="line-76"></a><span>      </span><span class="hs-comment">-- * Interact with a process</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span>      </span><span class="hs-comment">-- ** Process exit code</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#waitExitCode"><span class="hs-identifier hs-var">waitExitCode</span></a><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#waitExitCodeSTM"><span class="hs-identifier hs-var">waitExitCodeSTM</span></a><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#getExitCode"><span class="hs-identifier hs-var">getExitCode</span></a><span>
</span><a name="line-82"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#getExitCodeSTM"><span class="hs-identifier hs-var">getExitCodeSTM</span></a><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#checkExitCode"><span class="hs-identifier hs-var">checkExitCode</span></a><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#checkExitCodeSTM"><span class="hs-identifier hs-var">checkExitCodeSTM</span></a><span>
</span><a name="line-85"></a><span>
</span><a name="line-86"></a><span>      </span><span class="hs-comment">-- ** Process streams</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#getStdin"><span class="hs-identifier hs-var">getStdin</span></a><span>
</span><a name="line-88"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier hs-var">getStdout</span></a><span>
</span><a name="line-89"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#getStderr"><span class="hs-identifier hs-var">getStderr</span></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>      </span><span class="hs-comment">-- * Exceptions</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#ExitCodeException"><span class="hs-identifier hs-type">ExitCodeException</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#ByteStringOutputException"><span class="hs-identifier hs-type">ByteStringOutputException</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>      </span><span class="hs-comment">-- * Unsafe functions</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-special">,</span><span> </span><a href="System.Process.Typed.html#unsafeProcessHandle"><span class="hs-identifier hs-var">unsafeProcessHandle</span></a><span>
</span><a name="line-96"></a><span>    </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">S</span><span>
</span><a name="line-99"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy.Internal</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">defaultChunkSize</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">E</span><span>
</span><a name="line-101"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">bracket</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">finally</span><span class="hs-special">)</span><span>
</span><a name="line-102"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">void</span><span class="hs-special">)</span><span>
</span><a name="line-103"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.IO.Class</span><span>
</span><a name="line-104"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System.Process</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">P</span><span>
</span><a name="line-105"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-106"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Handle</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hClose</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IOMode</span><span class="hs-special">(</span><span class="hs-identifier hs-var">ReadWriteMode</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">withBinaryFile</span><span class="hs-special">)</span><span>
</span><a name="line-107"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO.Error</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isPermissionError</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">threadDelay</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent.Async</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">async</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">asyncWithUnmask</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">cancel</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">waitCatch</span><span class="hs-special">)</span><span>
</span><a name="line-110"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent.STM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">newEmptyTMVarIO</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">atomically</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">putTMVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TMVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">readTMVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">tryReadTMVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">STM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">tryPutTMVar</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">throwSTM</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">catchSTM</span><span class="hs-special">)</span><span>
</span><a name="line-111"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Exit</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExitCode</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ExitSuccess</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-112"></a><span class="hs-keyword">import</span><span> </span><a href="System.Process.Typed.Internal.html"><span class="hs-identifier">System.Process.Typed.Internal</span></a><span>
</span><a name="line-113"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L</span><span>
</span><a name="line-114"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Lazy.Char8</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">L8</span><span>
</span><a name="line-115"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.String</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">IsString</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromString</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.RTS.Flags</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">getConcFlags</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">ctxtSwitchTime</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.IO.Unlift</span><span>
</span><a name="line-118"></a><span>
</span><a name="line-119"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 4, 0) &amp;&amp; !WINDOWS
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Posix.Types</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">GroupID</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">UserID</span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-123"></a><span class="hs-cpp">#if !MIN_VERSION_base(4, 8, 0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Applicative</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Applicative</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator">&lt;$&gt;</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator">&lt;$</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-125"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-127"></a><span class="hs-cpp">#if !MIN_VERSION_process(1, 3, 0)
</span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">System.Process.Internals</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">P</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">createProcess_</span><span class="hs-special">)</span><span>
</span><a name="line-129"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-131"></a><span class="hs-comment">-- | An abstract configuration for a process, which can then be</span><span>
</span><a name="line-132"></a><span class="hs-comment">-- launched into an actual running 'Process'. Takes three type</span><span>
</span><a name="line-133"></a><span class="hs-comment">-- parameters, providing the types of standard input, standard output,</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- and standard error, respectively.</span><span>
</span><a name="line-135"></a><span class="hs-comment">--</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- There are three ways to construct a value of this type:</span><span>
</span><a name="line-137"></a><span class="hs-comment">--</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- * With the 'proc' smart constructor, which takes a command name and</span><span>
</span><a name="line-139"></a><span class="hs-comment">-- a list of arguments.</span><span>
</span><a name="line-140"></a><span class="hs-comment">--</span><span>
</span><a name="line-141"></a><span class="hs-comment">-- * With the 'shell' smart constructor, which takes a shell string</span><span>
</span><a name="line-142"></a><span class="hs-comment">--</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- * With the 'IsString' instance via OverloadedStrings. If you</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- provide it a string with no spaces (e.g., @&quot;date&quot;@), it will</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- treat it as a raw command with no arguments (e.g., @proc &quot;date&quot;</span><span>
</span><a name="line-146"></a><span class="hs-comment">-- []@). If it has spaces, it will use @shell@.</span><span>
</span><a name="line-147"></a><span class="hs-comment">--</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- In all cases, the default for all three streams is to inherit the</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- streams from the parent process. For other settings, see the</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- setters below for default values.</span><span>
</span><a name="line-151"></a><span class="hs-comment">--</span><span>
</span><a name="line-152"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-153"></a><span class="hs-keyword">data</span><span> </span><a name="ProcessConfig"><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier">ProcessConfig</span></a></a><span> </span><a name="local-6989586621679034157"><a href="#local-6989586621679034157"><span class="hs-identifier">stdin</span></a></a><span> </span><a name="local-6989586621679034158"><a href="#local-6989586621679034158"><span class="hs-identifier">stdout</span></a></a><span> </span><a name="local-6989586621679034159"><a href="#local-6989586621679034159"><span class="hs-identifier">stderr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ProcessConfig"><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier">ProcessConfig</span></a></a><span>
</span><a name="line-154"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="pcCmdSpec"><a href="System.Process.Typed.html#pcCmdSpec"><span class="hs-identifier">pcCmdSpec</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">P.CmdSpec</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcStdin"><a href="System.Process.Typed.html#pcStdin"><span class="hs-identifier">pcStdin</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><span class="hs-special">'</span><a href="System.Process.Typed.html#STInput"><span class="hs-identifier hs-type">STInput</span></a><span> </span><a href="#local-6989586621679034157"><span class="hs-identifier hs-type">stdin</span></a><span class="hs-special">)</span><span>
</span><a name="line-156"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcStdout"><a href="System.Process.Typed.html#pcStdout"><span class="hs-identifier">pcStdout</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><span class="hs-special">'</span><a href="System.Process.Typed.html#STOutput"><span class="hs-identifier hs-type">STOutput</span></a><span> </span><a href="#local-6989586621679034158"><span class="hs-identifier hs-type">stdout</span></a><span class="hs-special">)</span><span>
</span><a name="line-157"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcStderr"><a href="System.Process.Typed.html#pcStderr"><span class="hs-identifier">pcStderr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><span class="hs-special">'</span><a href="System.Process.Typed.html#STOutput"><span class="hs-identifier hs-type">STOutput</span></a><span> </span><a href="#local-6989586621679034159"><span class="hs-identifier hs-type">stderr</span></a><span class="hs-special">)</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcWorkingDir"><a href="System.Process.Typed.html#pcWorkingDir"><span class="hs-identifier">pcWorkingDir</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">FilePath</span><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcEnv"><a href="System.Process.Typed.html#pcEnv"><span class="hs-identifier">pcEnv</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><span class="hs-identifier hs-type">String</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">String</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcCloseFds"><a href="System.Process.Typed.html#pcCloseFds"><span class="hs-identifier">pcCloseFds</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcCreateGroup"><a href="System.Process.Typed.html#pcCreateGroup"><span class="hs-identifier">pcCreateGroup</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcDelegateCtlc"><a href="System.Process.Typed.html#pcDelegateCtlc"><span class="hs-identifier">pcDelegateCtlc</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 3, 0)
</span><span>    </span><span class="hs-special">,</span><span> </span><a name="pcDetachConsole"><a href="System.Process.Typed.html#pcDetachConsole"><span class="hs-identifier">pcDetachConsole</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcCreateNewConsole"><a href="System.Process.Typed.html#pcCreateNewConsole"><span class="hs-identifier">pcCreateNewConsole</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcNewSession"><a href="System.Process.Typed.html#pcNewSession"><span class="hs-identifier">pcNewSession</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-168"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-170"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 4, 0) &amp;&amp; !WINDOWS
</span><span>    </span><span class="hs-special">,</span><span> </span><a name="pcChildGroup"><a href="System.Process.Typed.html#pcChildGroup"><span class="hs-identifier">pcChildGroup</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">GroupID</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="pcChildUser"><a href="System.Process.Typed.html#pcChildUser"><span class="hs-identifier">pcChildUser</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-glyph">!</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">UserID</span><span class="hs-special">)</span><span>
</span><a name="line-173"></a><span class="hs-cpp">#endif
</span><span class="">    }
instance Show (ProcessConfig stdin stdout stderr) where
    show pc = concat
        [ case pcCmdSpec pc of
            P.ShellCommand s -&gt; &quot;Shell command: &quot; ++ s
            P.RawCommand x xs -&gt; &quot;Raw command: &quot; ++ unwords (map escape (x:xs))
        , &quot;\n&quot;
        , case pcWorkingDir pc of
            Nothing -&gt; &quot;&quot;
            Just wd -&gt; concat
                [ &quot;Run from: &quot;
                , wd
                , &quot;\n&quot;
                ]
        , case pcEnv pc of
            Nothing -&gt; &quot;&quot;
            Just e -&gt; unlines
                $ &quot;Modified environment:&quot;
                : map (\(k, v) -&gt; concat [k, &quot;=&quot;, v]) e
        ]
      where
        escape x
            | any (`elem` &quot; \\\&quot;'&quot;) x = show x
            | otherwise = x
instance (stdin ~ (), stdout ~ (), stderr ~ ())
  =&gt; IsString (ProcessConfig stdin stdout stderr) where
    fromString s
        | any (== ' ') s = shell s
        | otherwise = proc s []

-- | Whether a stream is an input stream or output stream. Note that
-- this is from the perspective of the /child process/, so that a
-- child's standard input stream is an @STInput@, even though the
-- parent process will be writing to it.
--
-- @since 0.1.0.0
data StreamType = STInput | STOutput

-- | A specification for how to create one of the three standard child
-- streams. See examples below.
--
-- @since 0.1.0.0
data StreamSpec (streamType :: StreamType) a = StreamSpec
    { ssStream :: !(forall b. (P.StdStream -&gt; IO b) -&gt; IO b)
    , ssCreate :: !(ProcessConfig () () () -&gt; Maybe Handle -&gt; Cleanup a)
    }
    deriving Functor

-- | This instance uses 'byteStringInput' to convert a raw string into
-- a stream of input for a child process.
--
-- @since 0.1.0.0
instance (streamType ~ 'STInput, res ~ ())
  =&gt; IsString (StreamSpec streamType res) where
    fromString = byteStringInput . fromString

-- | Internal type, to make for easier composition of cleanup actions.
--
-- @since 0.1.0.0
newtype Cleanup a = Cleanup { runCleanup :: IO (a, IO ()) }
    deriving Functor
instance Applicative Cleanup where
    pure x = Cleanup (return (x, return ()))
    Cleanup f &lt;*&gt; Cleanup x = Cleanup $ do
        (f', c1) &lt;- f
        (`onException` c1) $ do
            (x', c2) &lt;- x
            return (f' x', c1 `finally` c2)

-- | A running process. The three type parameters provide the type of
-- the standard input, standard output, and standard error streams.
--
-- @since 0.1.0.0
data Process stdin stdout stderr = Process
    { pConfig :: !(ProcessConfig () () ())
    , pCleanup :: !(IO ())
    , pStdin :: !stdin
    , pStdout :: !stdout
    , pStderr :: !stderr
    , pHandle :: !P.ProcessHandle
    , pExitCode :: !(TMVar ExitCode)
    }
instance Show (Process stdin stdout stderr) where
    show p = &quot;Running process: &quot; ++ show (pConfig p)

-- | Internal helper
defaultProcessConfig :: ProcessConfig () () ()
defaultProcessConfig = ProcessConfig
    { pcCmdSpec = P.ShellCommand &quot;&quot;
    , pcStdin = inherit
    , pcStdout = inherit
    , pcStderr = inherit
    , pcWorkingDir = Nothing
    , pcEnv = Nothing
    , pcCloseFds = False
    , pcCreateGroup = False
    , pcDelegateCtlc = False

</span><span class="hs-cpp">#if MIN_VERSION_process(1, 3, 0)
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pcDetachConsole</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-274"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pcCreateNewConsole</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-275"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pcNewSession</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-276"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-278"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 4, 0) &amp;&amp; !WINDOWS
</span><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pcChildGroup</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-280"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pcChildUser</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-281"></a><span class="hs-cpp">#endif
</span><span class="">    }

-- | Create a 'ProcessConfig' from the given command and arguments.
--
-- @since 0.1.0.0
proc :: FilePath -&gt; [String] -&gt; ProcessConfig () () ()
proc cmd args = setProc cmd args defaultProcessConfig

-- | Internal helper
setProc :: FilePath -&gt; [String]
        -&gt; ProcessConfig stdin stdout stderr
        -&gt; ProcessConfig stdin stdout stderr
setProc cmd args p = p { pcCmdSpec = P.RawCommand cmd args }

-- | Create a 'ProcessConfig' from the given shell command.
--
-- @since 0.1.0.0
shell :: String -&gt; ProcessConfig () () ()
shell cmd = setShell cmd defaultProcessConfig

-- | Internal helper
setShell :: String
         -&gt; ProcessConfig stdin stdout stderr
         -&gt; ProcessConfig stdin stdout stderr
setShell cmd p = p { pcCmdSpec = P.ShellCommand cmd }

-- | Set the child's standard input stream to the given 'StreamSpec'.
--
-- Default: 'inherit'
--
-- @since 0.1.0.0
setStdin :: StreamSpec 'STInput stdin
         -&gt; ProcessConfig stdin0 stdout stderr
         -&gt; ProcessConfig stdin stdout stderr
setStdin spec pc = pc { pcStdin = spec }

-- | Set the child's standard output stream to the given 'StreamSpec'.
--
-- Default: 'inherit'
--
-- @since 0.1.0.0
setStdout :: StreamSpec 'STOutput stdout
          -&gt; ProcessConfig stdin stdout0 stderr
          -&gt; ProcessConfig stdin stdout stderr
setStdout spec pc = pc { pcStdout = spec }

-- | Set the child's standard error stream to the given 'StreamSpec'.
--
-- Default: 'inherit'
--
-- @since 0.1.0.0
setStderr :: StreamSpec 'STOutput stderr
          -&gt; ProcessConfig stdin stdout stderr0
          -&gt; ProcessConfig stdin stdout stderr
setStderr spec pc = pc { pcStderr = spec }

-- | Set the working directory of the child process.
--
-- Default: current process's working directory.
--
-- @since 0.1.0.0
setWorkingDir :: FilePath
              -&gt; ProcessConfig stdin stdout stderr
              -&gt; ProcessConfig stdin stdout stderr
setWorkingDir dir pc = pc { pcWorkingDir = Just dir }

-- | Inherit the working directory from the parent process.
--
-- @since 0.2.2.0
setWorkingDirInherit
  :: ProcessConfig stdin stdout stderr
  -&gt; ProcessConfig stdin stdout stderr
setWorkingDirInherit pc = pc { pcWorkingDir = Nothing }

-- | Set the environment variables of the child process.
--
-- Default: current process's environment.
--
-- @since 0.1.0.0
setEnv :: [(String, String)]
       -&gt; ProcessConfig stdin stdout stderr
       -&gt; ProcessConfig stdin stdout stderr
setEnv env pc = pc { pcEnv = Just env }

-- | Inherit the environment variables from the parent process.
--
-- @since 0.2.2.0
setEnvInherit
  :: ProcessConfig stdin stdout stderr
  -&gt; ProcessConfig stdin stdout stderr
setEnvInherit pc = pc { pcEnv = Nothing }

-- | Should we close all file descriptors besides stdin, stdout, and
-- stderr? See 'P.close_fds' for more information.
--
-- Default: False
--
-- @since 0.1.0.0
setCloseFds
    :: Bool
    -&gt; ProcessConfig stdin stdout stderr
    -&gt; ProcessConfig stdin stdout stderr
setCloseFds x pc = pc { pcCloseFds = x }

-- | Should we create a new process group?
--
-- Default: False
--
-- @since 0.1.0.0
setCreateGroup
    :: Bool
    -&gt; ProcessConfig stdin stdout stderr
    -&gt; ProcessConfig stdin stdout stderr
setCreateGroup x pc = pc { pcCreateGroup = x }

-- | Delegate handling of Ctrl-C to the child. For more information,
-- see 'P.delegate_ctlc'.
--
-- Default: False
--
-- @since 0.1.0.0
setDelegateCtlc
    :: Bool
    -&gt; ProcessConfig stdin stdout stderr
    -&gt; ProcessConfig stdin stdout stderr
setDelegateCtlc x pc = pc { pcDelegateCtlc = x }

</span><span class="hs-cpp">#if MIN_VERSION_process(1, 3, 0)
</span><span>
</span><a name="line-411"></a><span class="hs-comment">-- | Detach console on Windows, see 'P.detach_console'.</span><span>
</span><a name="line-412"></a><span class="hs-comment">--</span><span>
</span><a name="line-413"></a><span class="hs-comment">-- Default: False</span><span>
</span><a name="line-414"></a><span class="hs-comment">--</span><span>
</span><a name="line-415"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-416"></a><span class="hs-identifier">setDetachConsole</span><span>
</span><a name="line-417"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-418"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040568"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040569"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040570"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-419"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040568"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040569"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040570"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-420"></a><a name="setDetachConsole"><a href="System.Process.Typed.html#setDetachConsole"><span class="hs-identifier">setDetachConsole</span></a></a><span> </span><a name="local-6989586621679040636"><a href="#local-6989586621679040636"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679040637"><a href="#local-6989586621679040637"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040637"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcDetachConsole</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040636"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-421"></a><span>
</span><a name="line-422"></a><span class="hs-comment">-- | Create new console on Windows, see 'P.create_new_console'.</span><span>
</span><a name="line-423"></a><span class="hs-comment">--</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- Default: False</span><span>
</span><a name="line-425"></a><span class="hs-comment">--</span><span>
</span><a name="line-426"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-427"></a><span class="hs-identifier">setCreateNewConsole</span><span>
</span><a name="line-428"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-429"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040565"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040566"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040567"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-430"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040565"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040566"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040567"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-431"></a><a name="setCreateNewConsole"><a href="System.Process.Typed.html#setCreateNewConsole"><span class="hs-identifier">setCreateNewConsole</span></a></a><span> </span><a name="local-6989586621679040638"><a href="#local-6989586621679040638"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679040639"><a href="#local-6989586621679040639"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040639"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcCreateNewConsole</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040638"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-432"></a><span>
</span><a name="line-433"></a><span class="hs-comment">-- | Set a new session with the POSIX @setsid@ syscall, does nothing</span><span>
</span><a name="line-434"></a><span class="hs-comment">-- on non-POSIX. See 'P.new_session'.</span><span>
</span><a name="line-435"></a><span class="hs-comment">--</span><span>
</span><a name="line-436"></a><span class="hs-comment">-- Default: False</span><span>
</span><a name="line-437"></a><span class="hs-comment">--</span><span>
</span><a name="line-438"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-439"></a><span class="hs-identifier">setNewSession</span><span>
</span><a name="line-440"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-441"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040562"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040563"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040564"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-442"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040562"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040563"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040564"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-443"></a><a name="setNewSession"><a href="System.Process.Typed.html#setNewSession"><span class="hs-identifier">setNewSession</span></a></a><span> </span><a name="local-6989586621679040640"><a href="#local-6989586621679040640"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679040641"><a href="#local-6989586621679040641"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040641"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcNewSession</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040640"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-444"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-446"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 4, 0) &amp;&amp; !WINDOWS
</span><span class="hs-comment">-- | Set the child process's group ID with the POSIX @setgid@ syscall,</span><span>
</span><a name="line-448"></a><span class="hs-comment">-- does nothing on non-POSIX. See 'P.child_group'.</span><span>
</span><a name="line-449"></a><span class="hs-comment">--</span><span>
</span><a name="line-450"></a><span class="hs-comment">-- Default: False</span><span>
</span><a name="line-451"></a><span class="hs-comment">--</span><span>
</span><a name="line-452"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-453"></a><span class="hs-identifier">setChildGroup</span><span>
</span><a name="line-454"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">GroupID</span><span>
</span><a name="line-455"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040559"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040560"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040561"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-456"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040559"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040560"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040561"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-457"></a><a name="setChildGroup"><a href="System.Process.Typed.html#setChildGroup"><span class="hs-identifier">setChildGroup</span></a></a><span> </span><a name="local-6989586621679040642"><a href="#local-6989586621679040642"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679040643"><a href="#local-6989586621679040643"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040643"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcChildGroup</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679040642"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-458"></a><span>
</span><a name="line-459"></a><span class="hs-comment">-- | Inherit the group from the parent process.</span><span>
</span><a name="line-460"></a><span class="hs-comment">--</span><span>
</span><a name="line-461"></a><span class="hs-comment">-- @since 0.2.2.0</span><span>
</span><a name="line-462"></a><span class="hs-identifier">setChildGroupInherit</span><span>
</span><a name="line-463"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040556"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040557"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040558"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-464"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040556"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040557"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040558"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-465"></a><a name="setChildGroupInherit"><a href="System.Process.Typed.html#setChildGroupInherit"><span class="hs-identifier">setChildGroupInherit</span></a></a><span> </span><a name="local-6989586621679040644"><a href="#local-6989586621679040644"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040644"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcChildGroup</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-466"></a><span>
</span><a name="line-467"></a><span class="hs-comment">-- | Set the child process's user ID with the POSIX @setuid@ syscall,</span><span>
</span><a name="line-468"></a><span class="hs-comment">-- does nothing on non-POSIX. See 'P.child_user'.</span><span>
</span><a name="line-469"></a><span class="hs-comment">--</span><span>
</span><a name="line-470"></a><span class="hs-comment">-- Default: False</span><span>
</span><a name="line-471"></a><span class="hs-comment">--</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-473"></a><span class="hs-identifier">setChildUser</span><span>
</span><a name="line-474"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">UserID</span><span>
</span><a name="line-475"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040553"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040554"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040555"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-476"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040553"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040554"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040555"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-477"></a><a name="setChildUser"><a href="System.Process.Typed.html#setChildUser"><span class="hs-identifier">setChildUser</span></a></a><span> </span><a name="local-6989586621679040645"><a href="#local-6989586621679040645"><span class="hs-identifier">x</span></a></a><span> </span><a name="local-6989586621679040646"><a href="#local-6989586621679040646"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040646"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcChildUser</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679040645"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span class="hs-comment">-- | Inherit the user from the parent process.</span><span>
</span><a name="line-480"></a><span class="hs-comment">--</span><span>
</span><a name="line-481"></a><span class="hs-comment">-- @since 0.2.2.0</span><span>
</span><a name="line-482"></a><span class="hs-identifier">setChildUserInherit</span><span>
</span><a name="line-483"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040550"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040551"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040552"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-484"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040550"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040551"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040552"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-485"></a><a name="setChildUserInherit"><a href="System.Process.Typed.html#setChildUserInherit"><span class="hs-identifier">setChildUserInherit</span></a></a><span> </span><a name="local-6989586621679040647"><a href="#local-6989586621679040647"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679040647"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcChildUser</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-486"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-488"></a><span class="hs-comment">-- | Create a new 'StreamSpec' from the given 'P.StdStream' and a</span><span>
</span><a name="line-489"></a><span class="hs-comment">-- helper function. This function:</span><span>
</span><a name="line-490"></a><span class="hs-comment">--</span><span>
</span><a name="line-491"></a><span class="hs-comment">-- * Takes as input the raw @Maybe Handle@ returned by the</span><span>
</span><a name="line-492"></a><span class="hs-comment">-- 'P.createProcess' function. This will be determined by the</span><span>
</span><a name="line-493"></a><span class="hs-comment">-- 'P.StdStream' argument.</span><span>
</span><a name="line-494"></a><span class="hs-comment">--</span><span>
</span><a name="line-495"></a><span class="hs-comment">-- * Returns the actual stream value @a@, as well as a cleanup</span><span>
</span><a name="line-496"></a><span class="hs-comment">-- * function to be run when calling 'stopProcess'.</span><span>
</span><a name="line-497"></a><span class="hs-comment">--</span><span>
</span><a name="line-498"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-499"></a><span class="hs-identifier">mkStreamSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">P.StdStream</span><span>
</span><a name="line-500"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040548"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-501"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040549"><span class="hs-identifier hs-type">streamType</span></a><span> </span><a href="#local-6989586621679040548"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-502"></a><a name="mkStreamSpec"><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier">mkStreamSpec</span></a></a><span> </span><a name="local-6989586621679040648"><a href="#local-6989586621679040648"><span class="hs-identifier">ss</span></a></a><span> </span><a name="local-6989586621679040649"><a href="#local-6989586621679040649"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkManagedStreamSpec"><span class="hs-identifier hs-var">mkManagedStreamSpec</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679040648"><span class="hs-identifier hs-var">ss</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679040649"><span class="hs-identifier hs-var">f</span></a><span>
</span><a name="line-503"></a><span>
</span><a name="line-504"></a><span class="hs-comment">-- | Create a new 'StreamSpec' from a function that accepts a</span><span>
</span><a name="line-505"></a><span class="hs-comment">-- 'P.StdStream' and a helper function.  This function is the same as</span><span>
</span><a name="line-506"></a><span class="hs-comment">-- the helper in 'mkStreamSpec'</span><span>
</span><a name="line-507"></a><span class="hs-identifier">mkManagedStreamSpec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">forall</span><span> </span><a name="local-6989586621679040547"><a href="#local-6989586621679040547"><span class="hs-identifier">b</span></a></a><span class="hs-operator">.</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">P.StdStream</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679040547"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679040547"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-508"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040545"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-509"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040546"><span class="hs-identifier hs-type">streamType</span></a><span> </span><a href="#local-6989586621679040545"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-510"></a><a name="mkManagedStreamSpec"><a href="System.Process.Typed.html#mkManagedStreamSpec"><span class="hs-identifier">mkManagedStreamSpec</span></a></a><span> </span><a name="local-6989586621679040650"><a href="#local-6989586621679040650"><span class="hs-identifier">ss</span></a></a><span> </span><a name="local-6989586621679040651"><a href="#local-6989586621679040651"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-var">StreamSpec</span></a><span> </span><a href="#local-6989586621679040650"><span class="hs-identifier hs-var">ss</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679040652"><a href="#local-6989586621679040652"><span class="hs-identifier">pc</span></a></a><span> </span><a name="local-6989586621679040653"><a href="#local-6989586621679040653"><span class="hs-identifier">mh</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#Cleanup"><span class="hs-identifier hs-var">Cleanup</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679040651"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679040652"><span class="hs-identifier hs-var">pc</span></a><span> </span><a href="#local-6989586621679040653"><span class="hs-identifier hs-var">mh</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-511"></a><span>
</span><a name="line-512"></a><span class="hs-comment">-- | A stream spec which simply inherits the stream of the parent</span><span>
</span><a name="line-513"></a><span class="hs-comment">-- process.</span><span>
</span><a name="line-514"></a><span class="hs-comment">--</span><span>
</span><a name="line-515"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-516"></a><span class="hs-identifier">inherit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040544"><span class="hs-identifier hs-type">anyStreamType</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-517"></a><a name="inherit"><a href="System.Process.Typed.html#inherit"><span class="hs-identifier">inherit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-identifier hs-var">P.Inherit</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span>
</span><a name="line-519"></a><span class="hs-comment">-- | A stream spec which is empty when used for for input and discards</span><span>
</span><a name="line-520"></a><span class="hs-comment">-- output.  Note this requires your platform's null device to be</span><span>
</span><a name="line-521"></a><span class="hs-comment">-- available when the process is started.</span><span>
</span><a name="line-522"></a><span class="hs-comment">--</span><span>
</span><a name="line-523"></a><span class="hs-comment">-- @since 0.2.5.0</span><span>
</span><a name="line-524"></a><span class="hs-identifier">nullStream</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040543"><span class="hs-identifier hs-type">anyStreamType</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-525"></a><a name="nullStream"><a href="System.Process.Typed.html#nullStream"><span class="hs-identifier">nullStream</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkManagedStreamSpec"><span class="hs-identifier hs-var">mkManagedStreamSpec</span></a><span> </span><a href="#local-6989586621679040654"><span class="hs-identifier hs-var">opener</span></a><span> </span><a href="#local-6989586621679040655"><span class="hs-identifier hs-var">cleanup</span></a><span>
</span><a name="line-526"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-527"></a><span>    </span><a name="local-6989586621679040654"><a href="#local-6989586621679040654"><span class="hs-identifier">opener</span></a></a><span> </span><a name="local-6989586621679040656"><a href="#local-6989586621679040656"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-528"></a><span>      </span><span class="hs-identifier hs-var">withBinaryFile</span><span> </span><a href="System.Process.Typed.Internal.html#nullDevice"><span class="hs-identifier hs-var">nullDevice</span></a><span> </span><span class="hs-identifier hs-var">ReadWriteMode</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679040861"><a href="#local-6989586621679040861"><span class="hs-identifier">handle</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-529"></a><span>        </span><a href="#local-6989586621679040656"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">P.UseHandle</span><span> </span><a href="#local-6989586621679040861"><span class="hs-identifier hs-var">handle</span></a><span class="hs-special">)</span><span>
</span><a name="line-530"></a><span>    </span><a name="local-6989586621679040655"><a href="#local-6989586621679040655"><span class="hs-identifier">cleanup</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-531"></a><span>      </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span class="hs-comment">-- | A stream spec which will close the stream for the child process.</span><span>
</span><a name="line-534"></a><span class="hs-comment">-- You usually do not want to use this, as it will leave the</span><span>
</span><a name="line-535"></a><span class="hs-comment">-- corresponding file descriptor unassigned and hence available for</span><span>
</span><a name="line-536"></a><span class="hs-comment">-- re-use in the child process.  Prefer 'nullStream' unless you're</span><span>
</span><a name="line-537"></a><span class="hs-comment">-- certain you want this behavior.</span><span>
</span><a name="line-538"></a><span class="hs-comment">--</span><span>
</span><a name="line-539"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-540"></a><span class="hs-identifier">closed</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040542"><span class="hs-identifier hs-type">anyStreamType</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-541"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 4, 0)
</span><a name="closed"><a href="System.Process.Typed.html#closed"><span class="hs-identifier">closed</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-identifier hs-var">P.NoStream</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">pure</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-543"></a><span class="hs-cpp">#else
</span><span class="hs-identifier">closed</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">mkStreamSpec</span><span> </span><span class="hs-identifier">P.CreatePipe</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">h</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator">&lt;$</span><span> </span><span class="hs-identifier">hClose</span><span> </span><span class="hs-identifier">h</span><span class="hs-special">)</span><span>
</span><a name="line-545"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-547"></a><span class="hs-comment">-- | An input stream spec which sets the input to the given</span><span>
</span><a name="line-548"></a><span class="hs-comment">-- 'L.ByteString'. A separate thread will be forked to write the</span><span>
</span><a name="line-549"></a><span class="hs-comment">-- contents to the child process.</span><span>
</span><a name="line-550"></a><span class="hs-comment">--</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-552"></a><span class="hs-identifier">byteStringInput</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><span class="hs-special">'</span><a href="System.Process.Typed.html#STInput"><span class="hs-identifier hs-type">STInput</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-553"></a><a name="byteStringInput"><a href="System.Process.Typed.html#byteStringInput"><span class="hs-identifier">byteStringInput</span></a></a><span> </span><a name="local-6989586621679040862"><a href="#local-6989586621679040862"><span class="hs-identifier">lbs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-identifier hs-var">P.CreatePipe</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679040863"><a href="#local-6989586621679040863"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-554"></a><span>    </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">async</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-555"></a><span>        </span><span class="hs-identifier hs-var">L.hPut</span><span> </span><a href="#local-6989586621679040863"><span class="hs-identifier hs-var">h</span></a><span> </span><a href="#local-6989586621679040862"><span class="hs-identifier hs-var">lbs</span></a><span>
</span><a name="line-556"></a><span>        </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679040863"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-557"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679040863"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-558"></a><span>
</span><a name="line-559"></a><span class="hs-comment">-- | Capture the output of a process in a 'L.ByteString'.</span><span>
</span><a name="line-560"></a><span class="hs-comment">--</span><span>
</span><a name="line-561"></a><span class="hs-comment">-- This function will fork a separate thread to consume all input from</span><span>
</span><a name="line-562"></a><span class="hs-comment">-- the process, and will only make the results available when the</span><span>
</span><a name="line-563"></a><span class="hs-comment">-- underlying 'Handle' is closed. As this is provided as an 'STM'</span><span>
</span><a name="line-564"></a><span class="hs-comment">-- action, you can either check if the result is available, or block</span><span>
</span><a name="line-565"></a><span class="hs-comment">-- until it's ready.</span><span>
</span><a name="line-566"></a><span class="hs-comment">--</span><span>
</span><a name="line-567"></a><span class="hs-comment">-- In the event of any exception occurring when reading from the</span><span>
</span><a name="line-568"></a><span class="hs-comment">-- 'Handle', the 'STM' action will throw a</span><span>
</span><a name="line-569"></a><span class="hs-comment">-- 'ByteStringOutputException'.</span><span>
</span><a name="line-570"></a><span class="hs-comment">--</span><span>
</span><a name="line-571"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-572"></a><span class="hs-identifier">byteStringOutput</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><span class="hs-special">'</span><a href="System.Process.Typed.html#STOutput"><span class="hs-identifier hs-type">STOutput</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">STM</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-573"></a><a name="byteStringOutput"><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier">byteStringOutput</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-identifier hs-var">P.CreatePipe</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041176"><a href="#local-6989586621679041176"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679041177"><a href="#local-6989586621679041177"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#byteStringFromHandle"><span class="hs-identifier hs-var">byteStringFromHandle</span></a><span> </span><a href="#local-6989586621679041176"><span class="hs-identifier hs-var">pc</span></a><span> </span><a href="#local-6989586621679041177"><span class="hs-identifier hs-var">h</span></a><span>
</span><a name="line-574"></a><span>
</span><a name="line-575"></a><span class="hs-comment">-- | Helper function (not exposed) for both 'byteStringOutput' and</span><span>
</span><a name="line-576"></a><span class="hs-comment">-- 'withProcessInterleave'. This will consume all of the output from</span><span>
</span><a name="line-577"></a><span class="hs-comment">-- the given 'Handle' in a separate thread and provide access to the</span><span>
</span><a name="line-578"></a><span class="hs-comment">-- resulting 'L.ByteString' via STM. Second action will close the</span><span>
</span><a name="line-579"></a><span class="hs-comment">-- reader handle.</span><span>
</span><a name="line-580"></a><span class="hs-identifier">byteStringFromHandle</span><span>
</span><a name="line-581"></a><span>  </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-582"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-comment">-- ^ reader handle</span><span>
</span><a name="line-583"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">STM</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-584"></a><a name="byteStringFromHandle"><a href="System.Process.Typed.html#byteStringFromHandle"><span class="hs-identifier">byteStringFromHandle</span></a></a><span> </span><a name="local-6989586621679041178"><a href="#local-6989586621679041178"><span class="hs-identifier">pc</span></a></a><span> </span><a name="local-6989586621679041179"><a href="#local-6989586621679041179"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-585"></a><span>    </span><a name="local-6989586621679041180"><a href="#local-6989586621679041180"><span class="hs-identifier">mvar</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">newEmptyTMVarIO</span><span>
</span><a name="line-586"></a><span>
</span><a name="line-587"></a><span>    </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">async</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-588"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041181"><a href="#local-6989586621679041181"><span class="hs-identifier">loop</span></a></a><span> </span><a name="local-6989586621679041182"><a href="#local-6989586621679041182"><span class="hs-identifier">front</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-589"></a><span>                </span><a name="local-6989586621679041183"><a href="#local-6989586621679041183"><span class="hs-identifier">bs</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">S.hGetSome</span><span> </span><a href="#local-6989586621679041179"><span class="hs-identifier hs-var">h</span></a><span> </span><span class="hs-identifier hs-var">defaultChunkSize</span><span>
</span><a name="line-590"></a><span>                </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">S.null</span><span> </span><a href="#local-6989586621679041183"><span class="hs-identifier hs-var">bs</span></a><span>
</span><a name="line-591"></a><span>                    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">putTMVar</span><span> </span><a href="#local-6989586621679041180"><span class="hs-identifier hs-var">mvar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">L.fromChunks</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679041182"><span class="hs-identifier hs-var">front</span></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-592"></a><span>                    </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679041181"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679041182"><span class="hs-identifier hs-var">front</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041183"><span class="hs-identifier hs-var">bs</span></a><span class="hs-glyph">:</span><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>        </span><a href="#local-6989586621679041181"><span class="hs-identifier hs-var">loop</span></a><span> </span><span class="hs-identifier hs-var">id</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">catch</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041326"><a href="#local-6989586621679041326"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-594"></a><span>            </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">void</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">tryPutTMVar</span><span> </span><a href="#local-6989586621679041180"><span class="hs-identifier hs-var">mvar</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#ByteStringOutputException"><span class="hs-identifier hs-var">ByteStringOutputException</span></a><span> </span><a href="#local-6989586621679041326"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679041178"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-595"></a><span>            </span><span class="hs-identifier hs-var">throwIO</span><span> </span><a href="#local-6989586621679041326"><span class="hs-identifier hs-var">e</span></a><span>
</span><a name="line-596"></a><span>
</span><a name="line-597"></a><span>    </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">readTMVar</span><span> </span><a href="#local-6989586621679041180"><span class="hs-identifier hs-var">mvar</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><span class="hs-identifier hs-var">either</span><span> </span><span class="hs-identifier hs-var">throwSTM</span><span> </span><span class="hs-identifier hs-var">return</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679041179"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-598"></a><span>
</span><a name="line-599"></a><span class="hs-comment">-- | Create a new pipe between this process and the child, and return</span><span>
</span><a name="line-600"></a><span class="hs-comment">-- a 'Handle' to communicate with the child.</span><span>
</span><a name="line-601"></a><span class="hs-comment">--</span><span>
</span><a name="line-602"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-603"></a><span class="hs-identifier">createPipe</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040541"><span class="hs-identifier hs-type">anyStreamType</span></a><span> </span><span class="hs-identifier hs-type">Handle</span><span>
</span><a name="line-604"></a><a name="createPipe"><a href="System.Process.Typed.html#createPipe"><span class="hs-identifier">createPipe</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-identifier hs-var">P.CreatePipe</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a name="local-6989586621679041327"><a href="#local-6989586621679041327"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679041327"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679041327"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-605"></a><span>
</span><a name="line-606"></a><span class="hs-comment">-- | Use the provided 'Handle' for the child process, and when the</span><span>
</span><a name="line-607"></a><span class="hs-comment">-- process exits, do /not/ close it. This is useful if, for example,</span><span>
</span><a name="line-608"></a><span class="hs-comment">-- you want to have multiple processes write to the same log file</span><span>
</span><a name="line-609"></a><span class="hs-comment">-- sequentially.</span><span>
</span><a name="line-610"></a><span class="hs-comment">--</span><span>
</span><a name="line-611"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-612"></a><span class="hs-identifier">useHandleOpen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040540"><span class="hs-identifier hs-type">anyStreamType</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-613"></a><a name="useHandleOpen"><a href="System.Process.Typed.html#useHandleOpen"><span class="hs-identifier">useHandleOpen</span></a></a><span> </span><a name="local-6989586621679041328"><a href="#local-6989586621679041328"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">P.UseHandle</span><span> </span><a href="#local-6989586621679041328"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span class="hs-comment">-- | Use the provided 'Handle' for the child process, and when the</span><span>
</span><a name="line-616"></a><span class="hs-comment">-- process exits, close it. If you have no reason to keep the 'Handle'</span><span>
</span><a name="line-617"></a><span class="hs-comment">-- open, you should use this over 'useHandleOpen'.</span><span>
</span><a name="line-618"></a><span class="hs-comment">--</span><span>
</span><a name="line-619"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-620"></a><span class="hs-identifier">useHandleClose</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Handle</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#StreamSpec"><span class="hs-identifier hs-type">StreamSpec</span></a><span> </span><a href="#local-6989586621679040539"><span class="hs-identifier hs-type">anyStreamType</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-621"></a><a name="useHandleClose"><a href="System.Process.Typed.html#useHandleClose"><span class="hs-identifier">useHandleClose</span></a></a><span> </span><a name="local-6989586621679041329"><a href="#local-6989586621679041329"><span class="hs-identifier">h</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">P.UseHandle</span><span> </span><a href="#local-6989586621679041329"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679041329"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span>
</span><a name="line-622"></a><span>
</span><a name="line-623"></a><span class="hs-comment">-- | Launch a process based on the given 'ProcessConfig'. You should</span><span>
</span><a name="line-624"></a><span class="hs-comment">-- ensure that you close 'stopProcess' on the result. It's usually</span><span>
</span><a name="line-625"></a><span class="hs-comment">-- better to use one of the functions in this module which ensures</span><span>
</span><a name="line-626"></a><span class="hs-comment">-- 'stopProcess' is called, such as 'withProcess'.</span><span>
</span><a name="line-627"></a><span class="hs-comment">--</span><span>
</span><a name="line-628"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-629"></a><span class="hs-identifier">startProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040535"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-630"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040536"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040537"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040538"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-631"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040535"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040536"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040537"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040538"><span class="hs-identifier hs-type">stderr</span></a><span class="hs-special">)</span><span>
</span><a name="line-632"></a><a name="startProcess"><a href="System.Process.Typed.html#startProcess"><span class="hs-identifier">startProcess</span></a></a><span> </span><a name="local-6989586621679041330"><a href="#local-6989586621679041330"><span class="hs-identifier">pConfig'</span></a></a><span class="hs-glyph">@</span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-var">ProcessConfig</span></a><span> </span><span class="hs-special">{</span><span class="hs-glyph">..</span><span class="hs-special">}</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-633"></a><span>    </span><span class="hs-identifier">ssStream</span><span> </span><a href="#local-6989586621679041332"><span class="hs-identifier hs-var">pcStdin</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041346"><a href="#local-6989586621679041346"><span class="hs-identifier">realStdin</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-634"></a><span>      </span><span class="hs-identifier">ssStream</span><span> </span><a href="#local-6989586621679041333"><span class="hs-identifier hs-var">pcStdout</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041347"><a href="#local-6989586621679041347"><span class="hs-identifier">realStdout</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-635"></a><span>        </span><span class="hs-identifier">ssStream</span><span> </span><a href="#local-6989586621679041334"><span class="hs-identifier hs-var">pcStderr</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679041348"><a href="#local-6989586621679041348"><span class="hs-identifier">realStderr</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-636"></a><span>
</span><a name="line-637"></a><span>          </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679041349"><a href="#local-6989586621679041349"><span class="hs-identifier">cp0</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-638"></a><span>                  </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679041331"><span class="hs-identifier hs-var">pcCmdSpec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-639"></a><span>                      </span><span class="hs-identifier hs-var">P.ShellCommand</span><span> </span><a name="local-6989586621679041351"><a href="#local-6989586621679041351"><span class="hs-identifier">cmd</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">P.shell</span><span> </span><a href="#local-6989586621679041351"><span class="hs-identifier hs-var">cmd</span></a><span>
</span><a name="line-640"></a><span>                      </span><span class="hs-identifier hs-var">P.RawCommand</span><span> </span><a name="local-6989586621679041352"><a href="#local-6989586621679041352"><span class="hs-identifier">cmd</span></a></a><span> </span><a name="local-6989586621679041353"><a href="#local-6989586621679041353"><span class="hs-identifier">args</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">P.proc</span><span> </span><a href="#local-6989586621679041352"><span class="hs-identifier hs-var">cmd</span></a><span> </span><a href="#local-6989586621679041353"><span class="hs-identifier hs-var">args</span></a><span>
</span><a name="line-641"></a><span>              </span><a name="local-6989586621679041350"><a href="#local-6989586621679041350"><span class="hs-identifier">cp</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041349"><span class="hs-identifier hs-var">cp0</span></a><span>
</span><a name="line-642"></a><span>                  </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">P.std_in</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041346"><span class="hs-identifier hs-var">realStdin</span></a><span>
</span><a name="line-643"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.std_out</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041347"><span class="hs-identifier hs-var">realStdout</span></a><span>
</span><a name="line-644"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.std_err</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041348"><span class="hs-identifier hs-var">realStderr</span></a><span>
</span><a name="line-645"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.cwd</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041335"><span class="hs-identifier hs-var">pcWorkingDir</span></a><span>
</span><a name="line-646"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.env</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041336"><span class="hs-identifier hs-var">pcEnv</span></a><span>
</span><a name="line-647"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.close_fds</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041337"><span class="hs-identifier hs-var">pcCloseFds</span></a><span>
</span><a name="line-648"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.create_group</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041338"><span class="hs-identifier hs-var">pcCreateGroup</span></a><span>
</span><a name="line-649"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.delegate_ctlc</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041339"><span class="hs-identifier hs-var">pcDelegateCtlc</span></a><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 3, 0)
</span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.detach_console</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041340"><span class="hs-identifier hs-var">pcDetachConsole</span></a><span>
</span><a name="line-653"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.create_new_console</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041341"><span class="hs-identifier hs-var">pcCreateNewConsole</span></a><span>
</span><a name="line-654"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.new_session</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041342"><span class="hs-identifier hs-var">pcNewSession</span></a><span>
</span><a name="line-655"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-657"></a><span class="hs-cpp">#if MIN_VERSION_process(1, 4, 0) &amp;&amp; !WINDOWS
</span><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.child_group</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041343"><span class="hs-identifier hs-var">pcChildGroup</span></a><span>
</span><a name="line-659"></a><span>                  </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">P.child_user</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679041344"><span class="hs-identifier hs-var">pcChildUser</span></a><span>
</span><a name="line-660"></a><span class="hs-cpp">#endif
</span><span class="">
                  }

          (minH, moutH, merrH, pHandle) &lt;- P.createProcess_ &quot;startProcess&quot; cp

          ((pStdin, pStdout, pStderr), pCleanup1) &lt;- runCleanup $ (,,)
              &lt;$&gt; ssCreate pcStdin  pConfig minH
              &lt;*&gt; ssCreate pcStdout pConfig moutH
              &lt;*&gt; ssCreate pcStderr pConfig merrH

          pExitCode &lt;- newEmptyTMVarIO
          waitingThread &lt;- asyncWithUnmask $ \unmask -&gt; do
              ec &lt;- unmask $ -- make sure the masking state from a bracket isn't inherited
                if multiThreadedRuntime
                  then P.waitForProcess pHandle
                  else do
                    switchTime &lt;- fromIntegral . (`div` 1000) . ctxtSwitchTime
                              &lt;$&gt; getConcFlags
                    let minDelay = 1
                        maxDelay = max minDelay switchTime
                        loop delay = do
                          threadDelay delay
                          mec &lt;- P.getProcessExitCode pHandle
                          case mec of
                            Nothing -&gt; loop $ min maxDelay (delay * 2)
                            Just ec -&gt; pure ec
                    loop minDelay
              atomically $ putTMVar pExitCode ec
              return ec

          let pCleanup = pCleanup1 `finally` do
                  -- First: stop calling waitForProcess, so that we can
                  -- avoid race conditions where the process is removed from
                  -- the system process table while we're trying to
                  -- terminate it.
                  cancel waitingThread

                  -- Now check if the process had already exited
                  eec &lt;- waitCatch waitingThread

                  case eec of
                      -- Process already exited, nothing to do
                      Right _ec -&gt; return ()

                      -- Process didn't exit yet, let's terminate it and
                      -- then call waitForProcess ourselves
                      Left _ -&gt; do
                          eres &lt;- try $ P.terminateProcess pHandle
                          ec &lt;-
                            case eres of
                              Left e
                                -- On Windows, with the single-threaded runtime, it
                                -- seems that if a process has already exited, the
                                -- call to terminateProcess will fail with a
                                -- permission denied error. To work around this, we
                                -- catch this exception and then immediately
                                -- waitForProcess. There's a chance that there may be
                                -- other reasons for this permission error to appear,
                                -- in which case this code may allow us to wait too
                                -- long for a child process instead of erroring out.
                                -- Recommendation: always use the multi-threaded
                                -- runtime!
                                | isPermissionError e &amp;&amp; not multiThreadedRuntime &amp;&amp; isWindows -&gt;
                                  P.waitForProcess pHandle
                                | otherwise -&gt; throwIO e
                              Right () -&gt; P.waitForProcess pHandle
                          success &lt;- atomically $ tryPutTMVar pExitCode ec
                          evaluate $ assert success ()

          return Process {..}
  where
    pConfig = clearStreams pConfig'

foreign import ccall unsafe &quot;rtsSupportsBoundThreads&quot;
  multiThreadedRuntime :: Bool

isWindows :: Bool
</span><span class="hs-cpp">#if WINDOWS
</span><span class="hs-identifier">isWindows</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">True</span><span>
</span><a name="line-740"></a><span class="hs-cpp">#else
</span><a name="isWindows"><a href="System.Process.Typed.html#isWindows"><span class="hs-identifier">isWindows</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-742"></a><span class="hs-cpp">#endif
</span><span>
</span><a name="line-744"></a><span class="hs-comment">-- | Close a process and release any resources acquired. This will</span><span>
</span><a name="line-745"></a><span class="hs-comment">-- ensure 'P.terminateProcess' is called, wait for the process to</span><span>
</span><a name="line-746"></a><span class="hs-comment">-- actually exit, and then close out resources allocated for the</span><span>
</span><a name="line-747"></a><span class="hs-comment">-- streams. In the event of any cleanup exceptions being thrown this</span><span>
</span><a name="line-748"></a><span class="hs-comment">-- will throw an exception.</span><span>
</span><a name="line-749"></a><span class="hs-comment">--</span><span>
</span><a name="line-750"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-751"></a><span class="hs-identifier">stopProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040531"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-752"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040532"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040533"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040534"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-753"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040531"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-754"></a><a name="stopProcess"><a href="System.Process.Typed.html#stopProcess"><span class="hs-identifier">stopProcess</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">pCleanup</span><span>
</span><a name="line-755"></a><span>
</span><a name="line-756"></a><span class="hs-comment">-- | Uses the bracket pattern to call 'startProcess' and ensures that</span><span>
</span><a name="line-757"></a><span class="hs-comment">-- 'stopProcess' is called.</span><span>
</span><a name="line-758"></a><span class="hs-comment">--</span><span>
</span><a name="line-759"></a><span class="hs-comment">-- This function is usually /not/ what you want. You're likely better</span><span>
</span><a name="line-760"></a><span class="hs-comment">-- off using 'withProcessWait'. See</span><span>
</span><a name="line-761"></a><span class="hs-comment">-- &lt;https://github.com/fpco/typed-process/issues/25&gt;.</span><span>
</span><a name="line-762"></a><span class="hs-comment">--</span><span>
</span><a name="line-763"></a><span class="hs-comment">-- @since 0.2.5.0</span><span>
</span><a name="line-764"></a><span class="hs-identifier">withProcessTerm</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679040526"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-765"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040527"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040528"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040529"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-766"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040527"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040528"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040529"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040526"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040530"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-767"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040526"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040530"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-768"></a><a name="withProcessTerm"><a href="System.Process.Typed.html#withProcessTerm"><span class="hs-identifier">withProcessTerm</span></a></a><span> </span><a name="local-6989586621679042032"><a href="#local-6989586621679042032"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#startProcess"><span class="hs-identifier hs-var">startProcess</span></a><span> </span><a href="#local-6989586621679042032"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span> </span><a href="System.Process.Typed.html#stopProcess"><span class="hs-identifier hs-var">stopProcess</span></a><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span class="hs-comment">-- | Uses the bracket pattern to call 'startProcess'. Unlike</span><span>
</span><a name="line-771"></a><span class="hs-comment">-- 'withProcessTerm', this function will wait for the child process to</span><span>
</span><a name="line-772"></a><span class="hs-comment">-- exit, and only kill it with 'stopProcess' in the event that the</span><span>
</span><a name="line-773"></a><span class="hs-comment">-- inner function throws an exception.</span><span>
</span><a name="line-774"></a><span class="hs-comment">--</span><span>
</span><a name="line-775"></a><span class="hs-comment">-- @since 0.2.5.0</span><span>
</span><a name="line-776"></a><span class="hs-identifier">withProcessWait</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679040521"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-777"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040522"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040523"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040524"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-778"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040522"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040523"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040524"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040521"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040525"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-779"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040521"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040525"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-780"></a><a name="withProcessWait"><a href="System.Process.Typed.html#withProcessWait"><span class="hs-identifier">withProcessWait</span></a></a><span> </span><a name="local-6989586621679042033"><a href="#local-6989586621679042033"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679042034"><a href="#local-6989586621679042034"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-781"></a><span>  </span><a href="System.Process.Typed.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-782"></a><span>    </span><span class="hs-special">(</span><a href="System.Process.Typed.html#startProcess"><span class="hs-identifier hs-var">startProcess</span></a><span> </span><a href="#local-6989586621679042033"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span>
</span><a name="line-783"></a><span>    </span><a href="System.Process.Typed.html#stopProcess"><span class="hs-identifier hs-var">stopProcess</span></a><span>
</span><a name="line-784"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679042035"><a href="#local-6989586621679042035"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679042034"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679042035"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="System.Process.Typed.html#waitExitCode"><span class="hs-identifier hs-var">waitExitCode</span></a><span> </span><a href="#local-6989586621679042035"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-785"></a><span>
</span><a name="line-786"></a><span class="hs-comment">-- | Deprecated synonym for 'withProcessTerm'.</span><span>
</span><a name="line-787"></a><span class="hs-comment">--</span><span>
</span><a name="line-788"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-789"></a><span class="hs-identifier">withProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679040516"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-790"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040517"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040518"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040519"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-791"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040517"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040518"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040519"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040516"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040520"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-792"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040516"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040520"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-793"></a><a name="withProcess"><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier">withProcess</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#withProcessTerm"><span class="hs-identifier hs-var">withProcessTerm</span></a><span>
</span><a name="line-794"></a><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">withProcess</span><span> </span><span class="hs-pragma">&quot;Please consider using withProcessWait, or instead use withProcessTerm&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-795"></a><span>
</span><a name="line-796"></a><span class="hs-comment">-- | Same as 'withProcessTerm', but also calls 'checkExitCode'</span><span>
</span><a name="line-797"></a><span class="hs-comment">--</span><span>
</span><a name="line-798"></a><span class="hs-comment">-- @since 0.2.5.0</span><span>
</span><a name="line-799"></a><span class="hs-identifier">withProcessTerm_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679040511"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-800"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040512"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040513"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040514"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-801"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040512"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040513"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040514"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040511"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040515"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-802"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040511"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040515"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-803"></a><a name="withProcessTerm_"><a href="System.Process.Typed.html#withProcessTerm_"><span class="hs-identifier">withProcessTerm_</span></a></a><span> </span><a name="local-6989586621679042036"><a href="#local-6989586621679042036"><span class="hs-identifier">config</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-804"></a><span>    </span><span class="hs-special">(</span><a href="System.Process.Typed.html#startProcess"><span class="hs-identifier hs-var">startProcess</span></a><span> </span><a href="#local-6989586621679042036"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span>
</span><a name="line-805"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679042037"><a href="#local-6989586621679042037"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#stopProcess"><span class="hs-identifier hs-var">stopProcess</span></a><span> </span><a href="#local-6989586621679042037"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><a href="System.Process.Typed.html#finally"><span class="hs-identifier hs-var">finally</span></a><span class="hs-special">`</span><span> </span><a href="System.Process.Typed.html#checkExitCode"><span class="hs-identifier hs-var">checkExitCode</span></a><span> </span><a href="#local-6989586621679042037"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-806"></a><span>
</span><a name="line-807"></a><span class="hs-comment">-- | Same as 'withProcessWait', but also calls 'checkExitCode'</span><span>
</span><a name="line-808"></a><span class="hs-comment">--</span><span>
</span><a name="line-809"></a><span class="hs-comment">-- @since 0.2.5.0</span><span>
</span><a name="line-810"></a><span class="hs-identifier">withProcessWait_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679040506"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-811"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040507"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040508"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040509"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-812"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040507"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040508"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040509"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040506"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040510"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-813"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040506"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040510"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-814"></a><a name="withProcessWait_"><a href="System.Process.Typed.html#withProcessWait_"><span class="hs-identifier">withProcessWait_</span></a></a><span> </span><a name="local-6989586621679042038"><a href="#local-6989586621679042038"><span class="hs-identifier">config</span></a></a><span> </span><a name="local-6989586621679042039"><a href="#local-6989586621679042039"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span>
</span><a name="line-815"></a><span>    </span><span class="hs-special">(</span><a href="System.Process.Typed.html#startProcess"><span class="hs-identifier hs-var">startProcess</span></a><span> </span><a href="#local-6989586621679042038"><span class="hs-identifier hs-var">config</span></a><span class="hs-special">)</span><span>
</span><a name="line-816"></a><span>    </span><a href="System.Process.Typed.html#stopProcess"><span class="hs-identifier hs-var">stopProcess</span></a><span>
</span><a name="line-817"></a><span>    </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679042040"><a href="#local-6989586621679042040"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679042039"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679042040"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-operator hs-var">&lt;*</span><span> </span><a href="System.Process.Typed.html#checkExitCode"><span class="hs-identifier hs-var">checkExitCode</span></a><span> </span><a href="#local-6989586621679042040"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-818"></a><span>
</span><a name="line-819"></a><span class="hs-comment">-- | Deprecated synonym for 'withProcessTerm_'.</span><span>
</span><a name="line-820"></a><span class="hs-comment">--</span><span>
</span><a name="line-821"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-822"></a><span class="hs-identifier">withProcess_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679040501"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-823"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040502"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040503"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040504"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-824"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040502"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040503"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040504"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040501"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040505"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-825"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040501"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040505"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-826"></a><a name="withProcess_"><a href="System.Process.Typed.html#withProcess_"><span class="hs-identifier">withProcess_</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#withProcessTerm_"><span class="hs-identifier hs-var">withProcessTerm_</span></a><span>
</span><a name="line-827"></a><span class="hs-pragma">{-# DEPRECATED</span><span> </span><span class="hs-pragma">withProcess_</span><span> </span><span class="hs-pragma">&quot;Please consider using withProcessWait_, or instead use withProcessTerm_&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-828"></a><span>
</span><a name="line-829"></a><span class="hs-comment">-- | Run a process, capture its standard output and error as a</span><span>
</span><a name="line-830"></a><span class="hs-comment">-- 'L.ByteString', wait for it to complete, and then return its exit</span><span>
</span><a name="line-831"></a><span class="hs-comment">-- code, output, and error.</span><span>
</span><a name="line-832"></a><span class="hs-comment">--</span><span>
</span><a name="line-833"></a><span class="hs-comment">-- Note that any previously used 'setStdout' or 'setStderr' will be</span><span>
</span><a name="line-834"></a><span class="hs-comment">-- overridden.</span><span>
</span><a name="line-835"></a><span class="hs-comment">--</span><span>
</span><a name="line-836"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-837"></a><span class="hs-identifier">readProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040497"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-838"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040498"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040499"><span class="hs-identifier hs-type">stdoutIgnored</span></a><span> </span><a href="#local-6989586621679040500"><span class="hs-identifier hs-type">stderrIgnored</span></a><span>
</span><a name="line-839"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040497"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-840"></a><a name="readProcess"><a href="System.Process.Typed.html#readProcess"><span class="hs-identifier">readProcess</span></a></a><span> </span><a name="local-6989586621679042041"><a href="#local-6989586621679042041"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-841"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042042"><span class="hs-identifier hs-var">pc'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042043"><a href="#local-6989586621679042043"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><a name="line-842"></a><span>        </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="System.Process.Typed.html#waitExitCodeSTM"><span class="hs-identifier hs-var">waitExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042043"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-843"></a><span>        </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier hs-var">getStdout</span></a><span> </span><a href="#local-6989586621679042043"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-844"></a><span>        </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="System.Process.Typed.html#getStderr"><span class="hs-identifier hs-var">getStderr</span></a><span> </span><a href="#local-6989586621679042043"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-845"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-846"></a><span>    </span><a name="local-6989586621679042042"><a href="#local-6989586621679042042"><span class="hs-identifier">pc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#setStdout"><span class="hs-identifier hs-var">setStdout</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span>
</span><a name="line-847"></a><span>        </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#setStderr"><span class="hs-identifier hs-var">setStderr</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span> </span><a href="#local-6989586621679042041"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-848"></a><span>
</span><a name="line-849"></a><span class="hs-comment">-- | Same as 'readProcess', but instead of returning the 'ExitCode',</span><span>
</span><a name="line-850"></a><span class="hs-comment">-- checks it with 'checkExitCode'.</span><span>
</span><a name="line-851"></a><span class="hs-comment">--</span><span>
</span><a name="line-852"></a><span class="hs-comment">-- Exceptions thrown by this function will include stdout and stderr.</span><span>
</span><a name="line-853"></a><span class="hs-comment">--</span><span>
</span><a name="line-854"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-855"></a><span class="hs-identifier">readProcess_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040493"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-856"></a><span>             </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040494"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040495"><span class="hs-identifier hs-type">stdoutIgnored</span></a><span> </span><a href="#local-6989586621679040496"><span class="hs-identifier hs-type">stderrIgnored</span></a><span>
</span><a name="line-857"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040493"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-858"></a><a name="readProcess_"><a href="System.Process.Typed.html#readProcess_"><span class="hs-identifier">readProcess_</span></a></a><span> </span><a name="local-6989586621679042044"><a href="#local-6989586621679042044"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-859"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042045"><span class="hs-identifier hs-var">pc'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042046"><a href="#local-6989586621679042046"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-860"></a><span>        </span><a name="local-6989586621679042047"><a href="#local-6989586621679042047"><span class="hs-identifier">stdout</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier hs-var">getStdout</span></a><span> </span><a href="#local-6989586621679042046"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-861"></a><span>        </span><a name="local-6989586621679042048"><a href="#local-6989586621679042048"><span class="hs-identifier">stderr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Typed.html#getStderr"><span class="hs-identifier hs-var">getStderr</span></a><span> </span><a href="#local-6989586621679042046"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-862"></a><span>        </span><a href="System.Process.Typed.html#checkExitCodeSTM"><span class="hs-identifier hs-var">checkExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042046"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">catchSTM</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042049"><a href="#local-6989586621679042049"><span class="hs-identifier">ece</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwSTM</span><span> </span><a href="#local-6989586621679042049"><span class="hs-identifier hs-var">ece</span></a><span>
</span><a name="line-863"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eceStdout</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042047"><span class="hs-identifier hs-var">stdout</span></a><span>
</span><a name="line-864"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eceStderr</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042048"><span class="hs-identifier hs-var">stderr</span></a><span>
</span><a name="line-865"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-866"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679042047"><span class="hs-identifier hs-var">stdout</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679042048"><span class="hs-identifier hs-var">stderr</span></a><span class="hs-special">)</span><span>
</span><a name="line-867"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-868"></a><span>    </span><a name="local-6989586621679042045"><a href="#local-6989586621679042045"><span class="hs-identifier">pc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#setStdout"><span class="hs-identifier hs-var">setStdout</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span>
</span><a name="line-869"></a><span>        </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#setStderr"><span class="hs-identifier hs-var">setStderr</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span> </span><a href="#local-6989586621679042044"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-870"></a><span>
</span><a name="line-871"></a><span class="hs-comment">-- | Same as 'readProcess', but only read the stdout of the process. Original settings for stderr remain.</span><span>
</span><a name="line-872"></a><span class="hs-comment">--</span><span>
</span><a name="line-873"></a><span class="hs-comment">-- @since 0.2.1.0</span><span>
</span><a name="line-874"></a><span class="hs-identifier">readProcessStdout</span><span>
</span><a name="line-875"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040489"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-876"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040490"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040491"><span class="hs-identifier hs-type">stdoutIgnored</span></a><span> </span><a href="#local-6989586621679040492"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-877"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040489"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-878"></a><a name="readProcessStdout"><a href="System.Process.Typed.html#readProcessStdout"><span class="hs-identifier">readProcessStdout</span></a></a><span> </span><a name="local-6989586621679042050"><a href="#local-6989586621679042050"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-879"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042051"><span class="hs-identifier hs-var">pc'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042052"><a href="#local-6989586621679042052"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><a name="line-880"></a><span>        </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="System.Process.Typed.html#waitExitCodeSTM"><span class="hs-identifier hs-var">waitExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042052"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-881"></a><span>        </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier hs-var">getStdout</span></a><span> </span><a href="#local-6989586621679042052"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-882"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-883"></a><span>    </span><a name="local-6989586621679042051"><a href="#local-6989586621679042051"><span class="hs-identifier">pc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#setStdout"><span class="hs-identifier hs-var">setStdout</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span> </span><a href="#local-6989586621679042050"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-884"></a><span>
</span><a name="line-885"></a><span class="hs-comment">-- | Same as 'readProcessStdout', but instead of returning the</span><span>
</span><a name="line-886"></a><span class="hs-comment">-- 'ExitCode', checks it with 'checkExitCode'.</span><span>
</span><a name="line-887"></a><span class="hs-comment">--</span><span>
</span><a name="line-888"></a><span class="hs-comment">-- Exceptions thrown by this function will include stdout.</span><span>
</span><a name="line-889"></a><span class="hs-comment">--</span><span>
</span><a name="line-890"></a><span class="hs-comment">-- @since 0.2.1.0</span><span>
</span><a name="line-891"></a><span class="hs-identifier">readProcessStdout_</span><span>
</span><a name="line-892"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040485"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-893"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040486"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040487"><span class="hs-identifier hs-type">stdoutIgnored</span></a><span> </span><a href="#local-6989586621679040488"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-894"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040485"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span>
</span><a name="line-895"></a><a name="readProcessStdout_"><a href="System.Process.Typed.html#readProcessStdout_"><span class="hs-identifier">readProcessStdout_</span></a></a><span> </span><a name="local-6989586621679042053"><a href="#local-6989586621679042053"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-896"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042054"><span class="hs-identifier hs-var">pc'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042055"><a href="#local-6989586621679042055"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-897"></a><span>        </span><a name="local-6989586621679042056"><a href="#local-6989586621679042056"><span class="hs-identifier">stdout</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier hs-var">getStdout</span></a><span> </span><a href="#local-6989586621679042055"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-898"></a><span>        </span><a href="System.Process.Typed.html#checkExitCodeSTM"><span class="hs-identifier hs-var">checkExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042055"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">catchSTM</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042057"><a href="#local-6989586621679042057"><span class="hs-identifier">ece</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwSTM</span><span> </span><a href="#local-6989586621679042057"><span class="hs-identifier hs-var">ece</span></a><span>
</span><a name="line-899"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eceStdout</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042056"><span class="hs-identifier hs-var">stdout</span></a><span>
</span><a name="line-900"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-901"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679042056"><span class="hs-identifier hs-var">stdout</span></a><span>
</span><a name="line-902"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-903"></a><span>    </span><a name="local-6989586621679042054"><a href="#local-6989586621679042054"><span class="hs-identifier">pc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#setStdout"><span class="hs-identifier hs-var">setStdout</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span> </span><a href="#local-6989586621679042053"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-904"></a><span>
</span><a name="line-905"></a><span class="hs-comment">-- | Same as 'readProcess', but only read the stderr of the process.</span><span>
</span><a name="line-906"></a><span class="hs-comment">-- Original settings for stdout remain.</span><span>
</span><a name="line-907"></a><span class="hs-comment">--</span><span>
</span><a name="line-908"></a><span class="hs-comment">-- @since 0.2.1.0</span><span>
</span><a name="line-909"></a><span class="hs-identifier">readProcessStderr</span><span>
</span><a name="line-910"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040481"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-911"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040482"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040483"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040484"><span class="hs-identifier hs-type">stderrIgnored</span></a><span>
</span><a name="line-912"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040481"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-913"></a><a name="readProcessStderr"><a href="System.Process.Typed.html#readProcessStderr"><span class="hs-identifier">readProcessStderr</span></a></a><span> </span><a name="local-6989586621679042058"><a href="#local-6989586621679042058"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-914"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042059"><span class="hs-identifier hs-var">pc'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042060"><a href="#local-6989586621679042060"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><a name="line-915"></a><span>        </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="System.Process.Typed.html#waitExitCodeSTM"><span class="hs-identifier hs-var">waitExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042060"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-916"></a><span>        </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="System.Process.Typed.html#getStderr"><span class="hs-identifier hs-var">getStderr</span></a><span> </span><a href="#local-6989586621679042060"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-917"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-918"></a><span>    </span><a name="local-6989586621679042059"><a href="#local-6989586621679042059"><span class="hs-identifier">pc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#setStderr"><span class="hs-identifier hs-var">setStderr</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span> </span><a href="#local-6989586621679042058"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-919"></a><span>
</span><a name="line-920"></a><span class="hs-comment">-- | Same as 'readProcessStderr', but instead of returning the</span><span>
</span><a name="line-921"></a><span class="hs-comment">-- 'ExitCode', checks it with 'checkExitCode'.</span><span>
</span><a name="line-922"></a><span class="hs-comment">--</span><span>
</span><a name="line-923"></a><span class="hs-comment">-- Exceptions thrown by this function will include stderr.</span><span>
</span><a name="line-924"></a><span class="hs-comment">--</span><span>
</span><a name="line-925"></a><span class="hs-comment">-- @since 0.2.1.0</span><span>
</span><a name="line-926"></a><span class="hs-identifier">readProcessStderr_</span><span>
</span><a name="line-927"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040477"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-928"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040478"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040479"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040480"><span class="hs-identifier hs-type">stderrIgnored</span></a><span>
</span><a name="line-929"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040477"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span>
</span><a name="line-930"></a><a name="readProcessStderr_"><a href="System.Process.Typed.html#readProcessStderr_"><span class="hs-identifier">readProcessStderr_</span></a></a><span> </span><a name="local-6989586621679042061"><a href="#local-6989586621679042061"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-931"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042062"><span class="hs-identifier hs-var">pc'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042063"><a href="#local-6989586621679042063"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-932"></a><span>        </span><a name="local-6989586621679042064"><a href="#local-6989586621679042064"><span class="hs-identifier">stderr</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Typed.html#getStderr"><span class="hs-identifier hs-var">getStderr</span></a><span> </span><a href="#local-6989586621679042063"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-933"></a><span>        </span><a href="System.Process.Typed.html#checkExitCodeSTM"><span class="hs-identifier hs-var">checkExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042063"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">catchSTM</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042065"><a href="#local-6989586621679042065"><span class="hs-identifier">ece</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwSTM</span><span> </span><a href="#local-6989586621679042065"><span class="hs-identifier hs-var">ece</span></a><span>
</span><a name="line-934"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eceStderr</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042064"><span class="hs-identifier hs-var">stderr</span></a><span>
</span><a name="line-935"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-936"></a><span>        </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679042064"><span class="hs-identifier hs-var">stderr</span></a><span>
</span><a name="line-937"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-938"></a><span>    </span><a name="local-6989586621679042062"><a href="#local-6989586621679042062"><span class="hs-identifier">pc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#setStderr"><span class="hs-identifier hs-var">setStderr</span></a><span> </span><a href="System.Process.Typed.html#byteStringOutput"><span class="hs-identifier hs-var">byteStringOutput</span></a><span> </span><a href="#local-6989586621679042061"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-939"></a><span>
</span><a name="line-940"></a><span class="hs-identifier">withProcessInterleave</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679040472"><span class="hs-identifier hs-type">m</span></a><span class="hs-special">)</span><span>
</span><a name="line-941"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040473"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040474"><span class="hs-identifier hs-type">stdoutIgnored</span></a><span> </span><a href="#local-6989586621679040475"><span class="hs-identifier hs-type">stderrIgnored</span></a><span>
</span><a name="line-942"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040473"><span class="hs-identifier hs-type">stdin</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">STM</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040472"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040476"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span>
</span><a name="line-943"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040472"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679040476"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-944"></a><a name="withProcessInterleave"><a href="System.Process.Typed.html#withProcessInterleave"><span class="hs-identifier">withProcessInterleave</span></a></a><span> </span><a name="local-6989586621679042066"><a href="#local-6989586621679042066"><span class="hs-identifier">pc</span></a></a><span> </span><a name="local-6989586621679042067"><a href="#local-6989586621679042067"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-945"></a><span>    </span><span class="hs-comment">-- Create a pipe to be shared for both stdout and stderr</span><span>
</span><a name="line-946"></a><span>    </span><a href="System.Process.Typed.html#bracket"><span class="hs-identifier hs-var">bracket</span></a><span> </span><span class="hs-identifier hs-var">P.createPipe</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679042068"><a href="#local-6989586621679042068"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679042069"><a href="#local-6989586621679042069"><span class="hs-identifier">w</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679042068"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679042069"><span class="hs-identifier hs-var">w</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679042070"><a href="#local-6989586621679042070"><span class="hs-identifier">readEnd</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679042071"><a href="#local-6989586621679042071"><span class="hs-identifier">writeEnd</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-947"></a><span>        </span><span class="hs-comment">-- Use the writer end of the pipe for both stdout and stderr. For</span><span>
</span><a name="line-948"></a><span>        </span><span class="hs-comment">-- the stdout half, use byteStringFromHandle to read the data into</span><span>
</span><a name="line-949"></a><span>        </span><span class="hs-comment">-- a lazy ByteString in memory.</span><span>
</span><a name="line-950"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679042072"><a href="#local-6989586621679042072"><span class="hs-identifier">pc'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#setStdout"><span class="hs-identifier hs-var">setStdout</span></a><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#mkStreamSpec"><span class="hs-identifier hs-var">mkStreamSpec</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">P.UseHandle</span><span> </span><a href="#local-6989586621679042071"><span class="hs-identifier hs-var">writeEnd</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679042073"><a href="#local-6989586621679042073"><span class="hs-identifier">pc''</span></a></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#byteStringFromHandle"><span class="hs-identifier hs-var">byteStringFromHandle</span></a><span> </span><a href="#local-6989586621679042073"><span class="hs-identifier hs-var">pc''</span></a><span> </span><a href="#local-6989586621679042070"><span class="hs-identifier hs-var">readEnd</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-951"></a><span>                </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#setStderr"><span class="hs-identifier hs-var">setStderr</span></a><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#useHandleOpen"><span class="hs-identifier hs-var">useHandleOpen</span></a><span> </span><a href="#local-6989586621679042071"><span class="hs-identifier hs-var">writeEnd</span></a><span class="hs-special">)</span><span>
</span><a name="line-952"></a><span>                  </span><a href="#local-6989586621679042066"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-953"></a><span>        </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042072"><span class="hs-identifier hs-var">pc'</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042074"><a href="#local-6989586621679042074"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-954"></a><span>          </span><span class="hs-comment">-- Now that the process is forked, close the writer end of this</span><span>
</span><a name="line-955"></a><span>          </span><span class="hs-comment">-- pipe, otherwise the reader end will never give an EOF.</span><span>
</span><a name="line-956"></a><span>          </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">hClose</span><span> </span><a href="#local-6989586621679042071"><span class="hs-identifier hs-var">writeEnd</span></a><span>
</span><a name="line-957"></a><span>          </span><a href="#local-6989586621679042067"><span class="hs-identifier hs-var">inner</span></a><span> </span><a href="#local-6989586621679042074"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-958"></a><span>
</span><a name="line-959"></a><span class="hs-comment">-- | Same as 'readProcess', but interleaves stderr with stdout.</span><span>
</span><a name="line-960"></a><span class="hs-comment">--</span><span>
</span><a name="line-961"></a><span class="hs-comment">-- Motivation: Use this function if you need stdout interleaved with stderr</span><span>
</span><a name="line-962"></a><span class="hs-comment">-- output (e.g. from an HTTP server) in order to debug failures.</span><span>
</span><a name="line-963"></a><span class="hs-comment">--</span><span>
</span><a name="line-964"></a><span class="hs-comment">-- @since 0.2.4.0</span><span>
</span><a name="line-965"></a><span class="hs-identifier">readProcessInterleaved</span><span>
</span><a name="line-966"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040468"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-967"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040469"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040470"><span class="hs-identifier hs-type">stdoutIgnored</span></a><span> </span><a href="#local-6989586621679040471"><span class="hs-identifier hs-type">stderrIgnored</span></a><span>
</span><a name="line-968"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040468"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-969"></a><a name="readProcessInterleaved"><a href="System.Process.Typed.html#readProcessInterleaved"><span class="hs-identifier">readProcessInterleaved</span></a></a><span> </span><a name="local-6989586621679042075"><a href="#local-6989586621679042075"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-970"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-971"></a><span>    </span><a href="System.Process.Typed.html#withProcessInterleave"><span class="hs-identifier hs-var">withProcessInterleave</span></a><span> </span><a href="#local-6989586621679042075"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042076"><a href="#local-6989586621679042076"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-972"></a><span>    </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span>
</span><a name="line-973"></a><span>      </span><span class="hs-operator hs-var">&lt;$&gt;</span><span> </span><a href="System.Process.Typed.html#waitExitCodeSTM"><span class="hs-identifier hs-var">waitExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042076"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-974"></a><span>      </span><span class="hs-operator hs-var">&lt;*&gt;</span><span> </span><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier hs-var">getStdout</span></a><span> </span><a href="#local-6989586621679042076"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-975"></a><span>
</span><a name="line-976"></a><span class="hs-comment">-- | Same as 'readProcessInterleaved', but instead of returning the 'ExitCode',</span><span>
</span><a name="line-977"></a><span class="hs-comment">-- checks it with 'checkExitCode'.</span><span>
</span><a name="line-978"></a><span class="hs-comment">--</span><span>
</span><a name="line-979"></a><span class="hs-comment">-- Exceptions thrown by this function will include stdout.</span><span>
</span><a name="line-980"></a><span class="hs-comment">--</span><span>
</span><a name="line-981"></a><span class="hs-comment">-- @since 0.2.4.0</span><span>
</span><a name="line-982"></a><span class="hs-identifier">readProcessInterleaved_</span><span>
</span><a name="line-983"></a><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040464"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-984"></a><span>  </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040465"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040466"><span class="hs-identifier hs-type">stdoutIgnored</span></a><span> </span><a href="#local-6989586621679040467"><span class="hs-identifier hs-type">stderrIgnored</span></a><span>
</span><a name="line-985"></a><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040464"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span>
</span><a name="line-986"></a><a name="readProcessInterleaved_"><a href="System.Process.Typed.html#readProcessInterleaved_"><span class="hs-identifier">readProcessInterleaved_</span></a></a><span> </span><a name="local-6989586621679042077"><a href="#local-6989586621679042077"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-987"></a><span>    </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-988"></a><span>    </span><a href="System.Process.Typed.html#withProcessInterleave"><span class="hs-identifier hs-var">withProcessInterleave</span></a><span> </span><a href="#local-6989586621679042077"><span class="hs-identifier hs-var">pc</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042078"><a href="#local-6989586621679042078"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-989"></a><span>      </span><a name="local-6989586621679042079"><a href="#local-6989586621679042079"><span class="hs-identifier">stdout'</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier hs-var">getStdout</span></a><span> </span><a href="#local-6989586621679042078"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-990"></a><span>      </span><a href="System.Process.Typed.html#checkExitCodeSTM"><span class="hs-identifier hs-var">checkExitCodeSTM</span></a><span> </span><a href="#local-6989586621679042078"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">catchSTM</span><span class="hs-special">`</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042080"><a href="#local-6989586621679042080"><span class="hs-identifier">ece</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwSTM</span><span> </span><a href="#local-6989586621679042080"><span class="hs-identifier hs-var">ece</span></a><span>
</span><a name="line-991"></a><span>        </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eceStdout</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042079"><span class="hs-identifier hs-var">stdout'</span></a><span>
</span><a name="line-992"></a><span>        </span><span class="hs-special">}</span><span>
</span><a name="line-993"></a><span>      </span><span class="hs-identifier hs-var">return</span><span> </span><a href="#local-6989586621679042079"><span class="hs-identifier hs-var">stdout'</span></a><span>
</span><a name="line-994"></a><span>
</span><a name="line-995"></a><span class="hs-comment">-- | Run the given process, wait for it to exit, and returns its</span><span>
</span><a name="line-996"></a><span class="hs-comment">-- 'ExitCode'.</span><span>
</span><a name="line-997"></a><span class="hs-comment">--</span><span>
</span><a name="line-998"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-999"></a><span class="hs-identifier">runProcess</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040460"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-1000"></a><span>           </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040461"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040462"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040463"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-1001"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040460"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">ExitCode</span><span>
</span><a name="line-1002"></a><a name="runProcess"><a href="System.Process.Typed.html#runProcess"><span class="hs-identifier">runProcess</span></a></a><span> </span><a name="local-6989586621679042081"><a href="#local-6989586621679042081"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042081"><span class="hs-identifier hs-var">pc</span></a><span> </span><a href="System.Process.Typed.html#waitExitCode"><span class="hs-identifier hs-var">waitExitCode</span></a><span>
</span><a name="line-1003"></a><span>
</span><a name="line-1004"></a><span class="hs-comment">-- | Same as 'runProcess', but instead of returning the</span><span>
</span><a name="line-1005"></a><span class="hs-comment">-- 'ExitCode', checks it with 'checkExitCode'.</span><span>
</span><a name="line-1006"></a><span class="hs-comment">--</span><span>
</span><a name="line-1007"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1008"></a><span class="hs-identifier">runProcess_</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040456"><span class="hs-identifier hs-type">m</span></a><span>
</span><a name="line-1009"></a><span>            </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679040457"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040458"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040459"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-1010"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040456"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1011"></a><a name="runProcess_"><a href="System.Process.Typed.html#runProcess_"><span class="hs-identifier">runProcess_</span></a></a><span> </span><a name="local-6989586621679042082"><a href="#local-6989586621679042082"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="System.Process.Typed.html#withProcess"><span class="hs-identifier hs-var">withProcess</span></a><span> </span><a href="#local-6989586621679042082"><span class="hs-identifier hs-var">pc</span></a><span> </span><a href="System.Process.Typed.html#checkExitCode"><span class="hs-identifier hs-var">checkExitCode</span></a><span>
</span><a name="line-1012"></a><span>
</span><a name="line-1013"></a><span class="hs-comment">-- | Wait for the process to exit and then return its 'ExitCode'.</span><span>
</span><a name="line-1014"></a><span class="hs-comment">--</span><span>
</span><a name="line-1015"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1016"></a><span class="hs-identifier">waitExitCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040452"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040453"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040454"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040455"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040452"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-identifier hs-type">ExitCode</span><span>
</span><a name="line-1017"></a><a name="waitExitCode"><a href="System.Process.Typed.html#waitExitCode"><span class="hs-identifier">waitExitCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.Process.Typed.html#waitExitCodeSTM"><span class="hs-identifier hs-var">waitExitCodeSTM</span></a><span>
</span><a name="line-1018"></a><span>
</span><a name="line-1019"></a><span class="hs-comment">-- | Same as 'waitExitCode', but in 'STM'.</span><span>
</span><a name="line-1020"></a><span class="hs-comment">--</span><span>
</span><a name="line-1021"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1022"></a><span class="hs-identifier">waitExitCodeSTM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040449"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040450"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040451"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">STM</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span>
</span><a name="line-1023"></a><a name="waitExitCodeSTM"><a href="System.Process.Typed.html#waitExitCodeSTM"><span class="hs-identifier">waitExitCodeSTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">readTMVar</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">pExitCode</span><span>
</span><a name="line-1024"></a><span>
</span><a name="line-1025"></a><span class="hs-comment">-- | Check if a process has exited and, if so, return its 'ExitCode'.</span><span>
</span><a name="line-1026"></a><span class="hs-comment">--</span><span>
</span><a name="line-1027"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1028"></a><span class="hs-identifier">getExitCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040445"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040446"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040447"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040448"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040445"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">)</span><span>
</span><a name="line-1029"></a><a name="getExitCode"><a href="System.Process.Typed.html#getExitCode"><span class="hs-identifier">getExitCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.Process.Typed.html#getExitCodeSTM"><span class="hs-identifier hs-var">getExitCodeSTM</span></a><span>
</span><a name="line-1030"></a><span>
</span><a name="line-1031"></a><span class="hs-comment">-- | Same as 'getExitCode', but in 'STM'.</span><span>
</span><a name="line-1032"></a><span class="hs-comment">--</span><span>
</span><a name="line-1033"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1034"></a><span class="hs-identifier">getExitCodeSTM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040442"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040443"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040444"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">STM</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span class="hs-special">)</span><span>
</span><a name="line-1035"></a><a name="getExitCodeSTM"><a href="System.Process.Typed.html#getExitCodeSTM"><span class="hs-identifier">getExitCodeSTM</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">tryReadTMVar</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">pExitCode</span><span>
</span><a name="line-1036"></a><span>
</span><a name="line-1037"></a><span class="hs-comment">-- | Wait for a process to exit, and ensure that it exited</span><span>
</span><a name="line-1038"></a><span class="hs-comment">-- successfully. If not, throws an 'ExitCodeException'.</span><span>
</span><a name="line-1039"></a><span class="hs-comment">--</span><span>
</span><a name="line-1040"></a><span class="hs-comment">-- Exceptions thrown by this function will not include stdout or stderr (This prevents unbounded memory usage from reading them into memory).</span><span>
</span><a name="line-1041"></a><span class="hs-comment">-- However, some callers such as 'readProcess_' catch the exception, add the stdout and stderr, and rethrow.</span><span>
</span><a name="line-1042"></a><span class="hs-comment">--</span><span>
</span><a name="line-1043"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1044"></a><span class="hs-identifier">checkExitCode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadIO</span><span> </span><a href="#local-6989586621679040438"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679040439"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679040440"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679040441"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679040438"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1045"></a><a name="checkExitCode"><a href="System.Process.Typed.html#checkExitCode"><span class="hs-identifier">checkExitCode</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">liftIO</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">atomically</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="System.Process.Typed.html#checkExitCodeSTM"><span class="hs-identifier hs-var">checkExitCodeSTM</span></a><span>
</span><a name="line-1046"></a><span>
</span><a name="line-1047"></a><span class="hs-comment">-- | Same as 'checkExitCode', but in 'STM'.</span><span>
</span><a name="line-1048"></a><span class="hs-comment">--</span><span>
</span><a name="line-1049"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1050"></a><span class="hs-identifier">checkExitCodeSTM</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679039955"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679039956"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679039957"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">STM</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><a name="checkExitCodeSTM"><a href="System.Process.Typed.html#checkExitCodeSTM"><span class="hs-identifier">checkExitCodeSTM</span></a></a><span> </span><a name="local-6989586621679042083"><a href="#local-6989586621679042083"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1052"></a><span>    </span><a name="local-6989586621679042084"><a href="#local-6989586621679042084"><span class="hs-identifier">ec</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier hs-var">readTMVar</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pExitCode</span><span> </span><a href="#local-6989586621679042083"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1053"></a><span>    </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679042084"><span class="hs-identifier hs-var">ec</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1054"></a><span>        </span><span class="hs-identifier hs-var">ExitSuccess</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">throwSTM</span><span> </span><a href="System.Process.Typed.html#ExitCodeException"><span class="hs-identifier hs-var">ExitCodeException</span></a><span>
</span><a name="line-1056"></a><span>            </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">eceExitCode</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042084"><span class="hs-identifier hs-var">ec</span></a><span>
</span><a name="line-1057"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eceProcessConfig</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#clearStreams"><span class="hs-identifier hs-var">clearStreams</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">pConfig</span><span> </span><a href="#local-6989586621679042083"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span>
</span><a name="line-1058"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eceStdout</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L.empty</span><span>
</span><a name="line-1059"></a><span>            </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">eceStderr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">L.empty</span><span>
</span><a name="line-1060"></a><span>            </span><span class="hs-special">}</span><span>
</span><a name="line-1061"></a><span>
</span><a name="line-1062"></a><span class="hs-comment">-- | Internal</span><span>
</span><a name="line-1063"></a><span class="hs-identifier">clearStreams</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><a href="#local-6989586621679039952"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679039953"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679039954"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1064"></a><a name="clearStreams"><a href="System.Process.Typed.html#clearStreams"><span class="hs-identifier">clearStreams</span></a></a><span> </span><a name="local-6989586621679042085"><a href="#local-6989586621679042085"><span class="hs-identifier">pc</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679042085"><span class="hs-identifier hs-var">pc</span></a><span>
</span><a name="line-1065"></a><span>    </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcStdin</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#inherit"><span class="hs-identifier hs-var">inherit</span></a><span>
</span><a name="line-1066"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pcStdout</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#inherit"><span class="hs-identifier hs-var">inherit</span></a><span>
</span><a name="line-1067"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pcStderr</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="System.Process.Typed.html#inherit"><span class="hs-identifier hs-var">inherit</span></a><span>
</span><a name="line-1068"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1069"></a><span>
</span><a name="line-1070"></a><span class="hs-comment">-- | Get the child's standard input stream value.</span><span>
</span><a name="line-1071"></a><span class="hs-comment">--</span><span>
</span><a name="line-1072"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1073"></a><span class="hs-identifier">getStdin</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679039949"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679039950"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679039951"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679039949"><span class="hs-identifier hs-type">stdin</span></a><span>
</span><a name="line-1074"></a><a name="getStdin"><a href="System.Process.Typed.html#getStdin"><span class="hs-identifier">getStdin</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pStdin</span><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span class="hs-comment">-- | Get the child's standard output stream value.</span><span>
</span><a name="line-1077"></a><span class="hs-comment">--</span><span>
</span><a name="line-1078"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1079"></a><span class="hs-identifier">getStdout</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679039946"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679039947"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679039948"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679039947"><span class="hs-identifier hs-type">stdout</span></a><span>
</span><a name="line-1080"></a><a name="getStdout"><a href="System.Process.Typed.html#getStdout"><span class="hs-identifier">getStdout</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pStdout</span><span>
</span><a name="line-1081"></a><span>
</span><a name="line-1082"></a><span class="hs-comment">-- | Get the child's standard error stream value.</span><span>
</span><a name="line-1083"></a><span class="hs-comment">--</span><span>
</span><a name="line-1084"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1085"></a><span class="hs-identifier">getStderr</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679039943"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679039944"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679039945"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679039945"><span class="hs-identifier hs-type">stderr</span></a><span>
</span><a name="line-1086"></a><a name="getStderr"><a href="System.Process.Typed.html#getStderr"><span class="hs-identifier">getStderr</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pStderr</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span class="hs-comment">-- | Exception thrown by 'checkExitCode' in the event of a non-success</span><span>
</span><a name="line-1089"></a><span class="hs-comment">-- exit code. Note that 'checkExitCode' is called by other functions</span><span>
</span><a name="line-1090"></a><span class="hs-comment">-- as well, like 'runProcess_' or 'readProcess_'.</span><span>
</span><a name="line-1091"></a><span class="hs-comment">--</span><span>
</span><a name="line-1092"></a><span class="hs-comment">-- Note that several functions that throw an 'ExitCodeException' intentionally do not populate 'eceStdout' or 'eceStderr'.</span><span>
</span><a name="line-1093"></a><span class="hs-comment">-- This prevents unbounded memory usage for large stdout and stderrs.</span><span>
</span><a name="line-1094"></a><span class="hs-comment">--</span><span>
</span><a name="line-1095"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1096"></a><span class="hs-keyword">data</span><span> </span><a name="ExitCodeException"><a href="System.Process.Typed.html#ExitCodeException"><span class="hs-identifier">ExitCodeException</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ExitCodeException"><a href="System.Process.Typed.html#ExitCodeException"><span class="hs-identifier">ExitCodeException</span></a></a><span>
</span><a name="line-1097"></a><span>    </span><span class="hs-special">{</span><span> </span><a name="eceExitCode"><a href="System.Process.Typed.html#eceExitCode"><span class="hs-identifier">eceExitCode</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">ExitCode</span><span>
</span><a name="line-1098"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="eceProcessConfig"><a href="System.Process.Typed.html#eceProcessConfig"><span class="hs-identifier">eceProcessConfig</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1099"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="eceStdout"><a href="System.Process.Typed.html#eceStdout"><span class="hs-identifier">eceStdout</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span>
</span><a name="line-1100"></a><span>    </span><span class="hs-special">,</span><span> </span><a name="eceStderr"><a href="System.Process.Typed.html#eceStderr"><span class="hs-identifier">eceStderr</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">L.ByteString</span><span>
</span><a name="line-1101"></a><span>    </span><span class="hs-special">}</span><span>
</span><a name="line-1102"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span>
</span><a name="line-1103"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="System.Process.Typed.html#ExitCodeException"><span class="hs-identifier hs-type">ExitCodeException</span></a><span>
</span><a name="line-1104"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Show</span><span> </span><a href="System.Process.Typed.html#ExitCodeException"><span class="hs-identifier hs-type">ExitCodeException</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1105"></a><span>    </span><a name="local-8214565720323790397"><span class="hs-identifier">show</span></a><span> </span><a name="local-6989586621679034160"><a href="#local-6989586621679034160"><span class="hs-identifier">ece</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span>
</span><a name="line-1106"></a><span>        </span><span class="hs-special">[</span><span> </span><span class="hs-string">&quot;Received &quot;</span><span>
</span><a name="line-1107"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">eceExitCode</span><span> </span><a href="#local-6989586621679034160"><span class="hs-identifier hs-var">ece</span></a><span class="hs-special">)</span><span>
</span><a name="line-1108"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-string">&quot; when running\n&quot;</span><span>
</span><a name="line-1109"></a><span>        </span><span class="hs-comment">-- Too much output for an exception if we show the modified</span><span>
</span><a name="line-1110"></a><span>        </span><span class="hs-comment">-- environment, so hide it</span><span>
</span><a name="line-1111"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">eceProcessConfig</span><span> </span><a href="#local-6989586621679034160"><span class="hs-identifier hs-var">ece</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">pcEnv</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-special">}</span><span>
</span><a name="line-1112"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">L.null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">eceStdout</span><span> </span><a href="#local-6989586621679034160"><span class="hs-identifier hs-var">ece</span></a><span class="hs-special">)</span><span>
</span><a name="line-1113"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-1114"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;Standard output:\n\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">L8.unpack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">eceStdout</span><span> </span><a href="#local-6989586621679034160"><span class="hs-identifier hs-var">ece</span></a><span class="hs-special">)</span><span>
</span><a name="line-1115"></a><span>        </span><span class="hs-special">,</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">L.null</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">eceStderr</span><span> </span><a href="#local-6989586621679034160"><span class="hs-identifier hs-var">ece</span></a><span class="hs-special">)</span><span>
</span><a name="line-1116"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-string">&quot;&quot;</span><span>
</span><a name="line-1117"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-string">&quot;Standard error:\n\n&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">L8.unpack</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">eceStderr</span><span> </span><a href="#local-6989586621679034160"><span class="hs-identifier hs-var">ece</span></a><span class="hs-special">)</span><span>
</span><a name="line-1118"></a><span>        </span><span class="hs-special">]</span><span>
</span><a name="line-1119"></a><span>
</span><a name="line-1120"></a><span class="hs-comment">-- | Wrapper for when an exception is thrown when reading from a child</span><span>
</span><a name="line-1121"></a><span class="hs-comment">-- process, used by 'byteStringOutput'.</span><span>
</span><a name="line-1122"></a><span class="hs-comment">--</span><span>
</span><a name="line-1123"></a><span class="hs-comment">-- @since 0.1.0.0</span><span>
</span><a name="line-1124"></a><span class="hs-keyword">data</span><span> </span><a name="ByteStringOutputException"><a href="System.Process.Typed.html#ByteStringOutputException"><span class="hs-identifier">ByteStringOutputException</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="ByteStringOutputException"><a href="System.Process.Typed.html#ByteStringOutputException"><span class="hs-identifier">ByteStringOutputException</span></a></a><span> </span><span class="hs-identifier hs-type">SomeException</span><span> </span><span class="hs-special">(</span><a href="System.Process.Typed.html#ProcessConfig"><span class="hs-identifier hs-type">ProcessConfig</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1125"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-1126"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Exception</span><span> </span><a href="System.Process.Typed.html#ByteStringOutputException"><span class="hs-identifier hs-type">ByteStringOutputException</span></a><span>
</span><a name="line-1127"></a><span>
</span><a name="line-1128"></a><span class="hs-comment">-- | Take 'System.Process.ProcessHandle' out of the 'Process'.</span><span>
</span><a name="line-1129"></a><span class="hs-comment">-- This method is needed in cases one need to use low level functions</span><span>
</span><a name="line-1130"></a><span class="hs-comment">-- from the @process@ package. Use cases for this method are:</span><span>
</span><a name="line-1131"></a><span class="hs-comment">--</span><span>
</span><a name="line-1132"></a><span class="hs-comment">--   1. Send a special signal to the process.</span><span>
</span><a name="line-1133"></a><span class="hs-comment">--   2. Terminate the process group instead of terminating single process.</span><span>
</span><a name="line-1134"></a><span class="hs-comment">--   3. Use platform specific API on the underlying process.</span><span>
</span><a name="line-1135"></a><span class="hs-comment">--</span><span>
</span><a name="line-1136"></a><span class="hs-comment">-- This method is considered unsafe because the actions it performs on</span><span>
</span><a name="line-1137"></a><span class="hs-comment">-- the underlying process may overlap with the functionality that</span><span>
</span><a name="line-1138"></a><span class="hs-comment">-- @typed-process@ provides. For example the user should not call</span><span>
</span><a name="line-1139"></a><span class="hs-comment">-- 'System.Process.waitForProcess' on the process handle as eiter</span><span>
</span><a name="line-1140"></a><span class="hs-comment">-- 'System.Process.waitForProcess' or 'stopProcess' will lock.</span><span>
</span><a name="line-1141"></a><span class="hs-comment">-- Additionally, even if process was terminated by the</span><span>
</span><a name="line-1142"></a><span class="hs-comment">-- 'System.Process.terminateProcess' or by sending signal,</span><span>
</span><a name="line-1143"></a><span class="hs-comment">-- 'stopProcess' should be called either way in order to cleanup resources</span><span>
</span><a name="line-1144"></a><span class="hs-comment">-- allocated by the @typed-process@.</span><span>
</span><a name="line-1145"></a><span class="hs-comment">--</span><span>
</span><a name="line-1146"></a><span class="hs-comment">-- @since 0.1.1</span><span>
</span><a name="line-1147"></a><span class="hs-identifier">unsafeProcessHandle</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="System.Process.Typed.html#Process"><span class="hs-identifier hs-type">Process</span></a><span> </span><a href="#local-6989586621679039940"><span class="hs-identifier hs-type">stdin</span></a><span> </span><a href="#local-6989586621679039941"><span class="hs-identifier hs-type">stdout</span></a><span> </span><a href="#local-6989586621679039942"><span class="hs-identifier hs-type">stderr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">P.ProcessHandle</span><span>
</span><a name="line-1148"></a><a name="unsafeProcessHandle"><a href="System.Process.Typed.html#unsafeProcessHandle"><span class="hs-identifier">unsafeProcessHandle</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pHandle</span><span>
</span><a name="line-1149"></a><span>
</span><a name="line-1150"></a><span class="hs-identifier">bracket</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679039936"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679039937"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679039937"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><a href="#local-6989586621679039938"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679039937"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679039936"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679039939"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679039936"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679039939"><span class="hs-identifier hs-type">c</span></a><span>
</span><a name="line-1151"></a><a name="bracket"><a href="System.Process.Typed.html#bracket"><span class="hs-identifier">bracket</span></a></a><span> </span><a name="local-6989586621679042086"><a href="#local-6989586621679042086"><span class="hs-identifier">before</span></a></a><span> </span><a name="local-6989586621679042087"><a href="#local-6989586621679042087"><span class="hs-identifier">after</span></a></a><span> </span><a name="local-6989586621679042088"><a href="#local-6989586621679042088"><span class="hs-identifier">thing</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withRunInIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042089"><a href="#local-6989586621679042089"><span class="hs-identifier">run</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">E.bracket</span><span> </span><a href="#local-6989586621679042086"><span class="hs-identifier hs-var">before</span></a><span> </span><a href="#local-6989586621679042087"><span class="hs-identifier hs-var">after</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679042089"><span class="hs-identifier hs-var">run</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="#local-6989586621679042088"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span>
</span><a name="line-1152"></a><span>
</span><a name="line-1153"></a><span class="hs-identifier">finally</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">MonadUnliftIO</span><span> </span><a href="#local-6989586621679039934"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679039934"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679039935"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679039934"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679039935"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-1154"></a><a name="finally"><a href="System.Process.Typed.html#finally"><span class="hs-identifier">finally</span></a></a><span> </span><a name="local-6989586621679042090"><a href="#local-6989586621679042090"><span class="hs-identifier">thing</span></a></a><span> </span><a name="local-6989586621679042091"><a href="#local-6989586621679042091"><span class="hs-identifier">after</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">withRunInIO</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679042092"><a href="#local-6989586621679042092"><span class="hs-identifier">run</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">E.finally</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679042092"><span class="hs-identifier hs-var">run</span></a><span> </span><a href="#local-6989586621679042090"><span class="hs-identifier hs-var">thing</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679042091"><span class="hs-identifier hs-var">after</span></a><span>
</span><a name="line-1155"></a></pre></body></html>