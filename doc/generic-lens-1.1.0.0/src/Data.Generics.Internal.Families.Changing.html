<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE AllowAmbiguousTypes    #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE DataKinds              #-}</span><span>
</span><a name="line-3"></a><span class="hs-pragma">{-# LANGUAGE FlexibleInstances      #-}</span><span>
</span><a name="line-4"></a><span class="hs-pragma">{-# LANGUAGE FunctionalDependencies #-}</span><span>
</span><a name="line-5"></a><span class="hs-pragma">{-# LANGUAGE GADTs                  #-}</span><span>
</span><a name="line-6"></a><span class="hs-pragma">{-# LANGUAGE PolyKinds              #-}</span><span>
</span><a name="line-7"></a><span class="hs-pragma">{-# LANGUAGE TypeFamilies           #-}</span><span>
</span><a name="line-8"></a><span class="hs-pragma">{-# LANGUAGE TypeOperators          #-}</span><span>
</span><a name="line-9"></a><span class="hs-pragma">{-# LANGUAGE UndecidableInstances   #-}</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Data.Generics.Internal.Families.Changing</span><span>
</span><a name="line-12"></a><span>  </span><span class="hs-special">(</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#Indexed"><span class="hs-identifier hs-type">Indexed</span></a><span>
</span><a name="line-13"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#Infer"><span class="hs-identifier hs-type">Infer</span></a><span>
</span><a name="line-14"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-type">PTag</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-15"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#P"><span class="hs-identifier hs-type">P</span></a><span>
</span><a name="line-16"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-type">LookupParam</span></a><span>
</span><a name="line-17"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier hs-type">ArgAt</span></a><span>
</span><a name="line-18"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier hs-type">ArgCount</span></a><span>
</span><a name="line-19"></a><span>  </span><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-type">UnifyHead</span></a><span>
</span><a name="line-20"></a><span>  </span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-21"></a><span>
</span><a name="line-22"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.TypeLits</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-keyword">type</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-type">+</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">TypeError</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">ErrorMessage</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-23"></a><span>
</span><a name="line-24"></a><span class="hs-comment">{-
  Note [Changing type parameters]
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

  To get good type inference for type-changing lenses, we want to be able
  map the field's type back to the type argument it corresponds to. This way,
  when the field is changed, we know what the result type of the structure is
  going to be.

  However, for a given type @t@, its representation @Rep t@ forgets which types
  in the structure came from type variables, and which didn't. An @Int@ that
  results from the instantiation of the type paremeter and an @Int@ that was
  monomorphically specified in the structure are indistinguishable.

  The solution is to replace the type arguments in the type with unique
  proxies, like: @T a b@ -&gt; @T (P 1 a) (P 0 b)@. This way, if looking up
  a field's type yields something of shape @P _ _@, we know it came from a type
  parameter, and also know which.

  If the field's type is a proxy, then its type is allowed to change, otherwise
  not. This also allows us to satisfy the functional dependency @s field b -&gt; t@.
  If after doing the conversion on @s@, @field@'s type is @(P _ a), then @t@ is
  @s[b/a]@, otherwise @t ~ s@ and @b ~ a@.
-}</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- `P` can be used in place of any type parameter, which means that it can have</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- any kind, not just *, so a data type won't work.</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- (this caused https://github.com/kcsongor/generic-lens/issues/23)</span><span>
</span><a name="line-52"></a><span class="hs-comment">-- Instead, we use a matchable type family to wrap any `k` - however, we can no longer directly</span><span>
</span><a name="line-53"></a><span class="hs-comment">-- pattern match on `P`, as it's not a type constructor. But we can still take it apart as a polymorphic</span><span>
</span><a name="line-54"></a><span class="hs-comment">-- application form. In order to distinguish between applications of P and other type constructors, we use a tag, `PTag`</span><span>
</span><a name="line-55"></a><span class="hs-comment">-- to fake a type constructor.</span><span>
</span><a name="line-56"></a><span class="hs-keyword">data</span><span> </span><a name="PTag"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier">PTag</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="PTag"><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier">PTag</span></a></a><span>
</span><a name="line-57"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="P"><a href="Data.Generics.Internal.Families.Changing.html#P"><span class="hs-identifier">P</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679024787"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-type">PTag</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679024787"><span class="hs-identifier hs-type">k</span></a><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-keyword">type</span><span> </span><a name="Indexed"><a href="Data.Generics.Internal.Families.Changing.html#Indexed"><span class="hs-identifier">Indexed</span></a></a><span> </span><a name="local-6989586621679024786"><a href="#local-6989586621679024786"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier hs-type">Indexed'</span></a><span> </span><a href="#local-6989586621679024786"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-number">0</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="Indexed%27"><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier">Indexed'</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024777"><a href="#local-6989586621679024777"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024776"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024778"><a href="#local-6989586621679024778"><span class="hs-identifier">next</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024776"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-62"></a><span>  </span><span class="hs-identifier">Indexed'</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024781"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024782"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024779"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024780"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024783"><span class="hs-identifier hs-type">next</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#Indexed%27"><span class="hs-identifier hs-type">Indexed'</span></a><span> </span><a href="#local-6989586621679024781"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">next</span><span> </span><span class="hs-operator hs-type">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#P"><span class="hs-identifier hs-type">P</span></a><span> </span><a href="#local-6989586621679024783"><span class="hs-identifier hs-type">next</span></a><span> </span><a href="#local-6989586621679024782"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">'</span><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-type">PTag</span></a><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>  </span><span class="hs-identifier">Indexed'</span><span> </span><a href="#local-6989586621679024784"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024784"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-64"></a><span>
</span><a name="line-65"></a><span class="hs-keyword">data</span><span> </span><a name="Sub"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier">Sub</span></a></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-66"></a><span>  </span><a name="Sub"><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier">Sub</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679024775"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="Unify"><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier">Unify</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024762"><a href="#local-6989586621679024762"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024761"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024763"><a href="#local-6989586621679024763"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024761"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-69"></a><span>  </span><span class="hs-identifier">Unify</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024764"><span class="hs-identifier hs-type">p</span></a><span> </span><a href="#local-6989586621679024765"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">'</span><a href="Data.Generics.Internal.Families.Changing.html#PTag"><span class="hs-identifier hs-type">PTag</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024766"><span class="hs-identifier hs-type">a'</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span> </span><span class="hs-special">'</span><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a><span> </span><a href="#local-6989586621679024765"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679024766"><span class="hs-identifier hs-type">a'</span></a><span class="hs-special">]</span><span>
</span><a name="line-70"></a><span>  </span><span class="hs-identifier">Unify</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024768"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024769"><span class="hs-identifier hs-type">x</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024770"><span class="hs-identifier hs-type">b</span></a><span> </span><a href="#local-6989586621679024771"><span class="hs-identifier hs-type">y</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-identifier hs-type">Unify</span></a><span> </span><a href="#local-6989586621679024769"><span class="hs-identifier hs-type">x</span></a><span> </span><a href="#local-6989586621679024771"><span class="hs-identifier hs-type">y</span></a><span> </span><span class="hs-operator">++</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-type">Unify</span></a><span> </span><a href="#local-6989586621679024768"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024770"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-71"></a><span>  </span><span class="hs-identifier">Unify</span><span> </span><a href="#local-6989586621679024772"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024772"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-72"></a><span>  </span><span class="hs-identifier">Unify</span><span> </span><a href="#local-6989586621679024773"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024774"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">TypeError</span><span>
</span><a name="line-73"></a><span>                </span><span class="hs-special">(</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot;Couldn't match type &quot;</span><span>
</span><a name="line-74"></a><span>                  </span><span class="hs-special">'</span><span class="hs-operator hs-type">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">ShowType</span><span> </span><a href="#local-6989586621679024773"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-75"></a><span>                  </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Text</span><span> </span><span class="hs-string">&quot; with &quot;</span><span>
</span><a name="line-76"></a><span>                  </span><span class="hs-special">'</span><span class="hs-operator">:&lt;&gt;:</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">ShowType</span><span> </span><a href="#local-6989586621679024774"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-77"></a><span>                </span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>
</span><a name="line-79"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024755"><a href="#local-6989586621679024755"><span class="hs-identifier">xs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679024754"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a name="%2B%2B"><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-operator">++</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024756"><a href="#local-6989586621679024756"><span class="hs-identifier">ys</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679024754"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679024754"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">]</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-80"></a><span>  </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-operator">++</span><span> </span><a href="#local-6989586621679024757"><span class="hs-identifier hs-type">ys</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024757"><span class="hs-identifier hs-type">ys</span></a><span>
</span><a name="line-81"></a><span>  </span><span class="hs-special">(</span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679024759"><span class="hs-identifier hs-type">xs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator">++</span><span> </span><a href="#local-6989586621679024760"><span class="hs-identifier hs-type">ys</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">x</span><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-identifier hs-type">xs</span></a><span> </span><a href="Data.Generics.Internal.Families.Changing.html#%2B%2B"><span class="hs-operator hs-type">++</span></a><span> </span><a href="#local-6989586621679024760"><span class="hs-identifier hs-type">ys</span></a><span class="hs-special">)</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="Infer"><a href="Data.Generics.Internal.Families.Changing.html#Infer"><span class="hs-identifier">Infer</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024744"><a href="#local-6989586621679024744"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024745"><a href="#local-6989586621679024745"><span class="hs-identifier">a'</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024746"><a href="#local-6989586621679024746"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-operator">*</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-84"></a><span>  </span><span class="hs-identifier">Infer</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024747"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679024748"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024749"><span class="hs-identifier hs-type">a'</span></a><span> </span><a href="#local-6989586621679024750"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-85"></a><span>    </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier hs-type">ReplaceArgs</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024747"><span class="hs-identifier hs-type">s</span></a><span> </span><a href="#local-6989586621679024748"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#Unify"><span class="hs-identifier hs-type">Unify</span></a><span> </span><a href="#local-6989586621679024749"><span class="hs-identifier hs-type">a'</span></a><span> </span><a href="#local-6989586621679024750"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-86"></a><span>  </span><span class="hs-identifier">Infer</span><span> </span><a href="#local-6989586621679024751"><span class="hs-identifier hs-type">s</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024751"><span class="hs-identifier hs-type">s</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">--------------------------------------------------------------------------------</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span class="hs-comment">-- [TODO]: work this out</span><span>
</span><a name="line-91"></a><span class="hs-comment">--</span><span>
</span><a name="line-92"></a><span class="hs-comment">--type family ArgKind (t :: k) (pos :: Nat) :: * where</span><span>
</span><a name="line-93"></a><span class="hs-comment">--  ArgKind (t (a :: k)) 'Z = k</span><span>
</span><a name="line-94"></a><span class="hs-comment">--  ArgKind (t _) ('S pos) = ArgKind t pos</span><span>
</span><a name="line-95"></a><span class="hs-comment">--</span><span>
</span><a name="line-96"></a><span class="hs-comment">--type family ReplaceArg (t :: k) (pos :: Nat) (to :: ArgKind t pos) :: k where</span><span>
</span><a name="line-97"></a><span class="hs-comment">--  ReplaceArg (t a) 'Z to = t to</span><span>
</span><a name="line-98"></a><span class="hs-comment">--  ReplaceArg (t a) ('S pos) to = ReplaceArg t pos to a</span><span>
</span><a name="line-99"></a><span class="hs-comment">--  ReplaceArg t _ _ = t</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="ReplaceArg"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier">ReplaceArg</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024731"><a href="#local-6989586621679024731"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024729"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024732"><a href="#local-6989586621679024732"><span class="hs-identifier">pos</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024733"><a href="#local-6989586621679024733"><span class="hs-identifier">to</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024730"><span class="hs-identifier hs-type">j</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024729"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-102"></a><span>  </span><span class="hs-identifier">ReplaceArg</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024734"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679024735"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679024736"><span class="hs-identifier hs-type">to</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024734"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679024736"><span class="hs-identifier hs-type">to</span></a><span>
</span><a name="line-103"></a><span>  </span><span class="hs-identifier">ReplaceArg</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024737"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679024738"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024739"><span class="hs-identifier hs-type">pos</span></a><span> </span><a href="#local-6989586621679024740"><span class="hs-identifier hs-type">to</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-type">ReplaceArg</span></a><span> </span><a href="#local-6989586621679024737"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">pos</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024740"><span class="hs-identifier hs-type">to</span></a><span> </span><a href="#local-6989586621679024738"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-104"></a><span>  </span><span class="hs-identifier">ReplaceArg</span><span> </span><a href="#local-6989586621679024741"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024741"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-105"></a><span>
</span><a name="line-106"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="ReplaceArgs"><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier">ReplaceArgs</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024722"><a href="#local-6989586621679024722"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024721"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024723"><a href="#local-6989586621679024723"><span class="hs-identifier">subs</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Data.Generics.Internal.Families.Changing.html#Sub"><span class="hs-identifier hs-type">Sub</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024721"><span class="hs-identifier hs-type">k</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-107"></a><span>  </span><span class="hs-identifier">ReplaceArgs</span><span> </span><a href="#local-6989586621679024724"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">'</span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024724"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-108"></a><span>  </span><span class="hs-identifier">ReplaceArgs</span><span> </span><a href="#local-6989586621679024725"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Sub</span><span> </span><a href="#local-6989586621679024726"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679024727"><span class="hs-identifier hs-type">arg</span></a><span> </span><span class="hs-special">'</span><span class="hs-glyph">:</span><span> </span><a href="#local-6989586621679024728"><span class="hs-identifier hs-type">ss</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArgs"><span class="hs-identifier hs-type">ReplaceArgs</span></a><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#ReplaceArg"><span class="hs-identifier hs-type">ReplaceArg</span></a><span> </span><a href="#local-6989586621679024725"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679024726"><span class="hs-identifier hs-type">n</span></a><span> </span><a href="#local-6989586621679024727"><span class="hs-identifier hs-type">arg</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024728"><span class="hs-identifier hs-type">ss</span></a><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="LookupParam"><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier">LookupParam</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024707"><a href="#local-6989586621679024707"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024706"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024708"><a href="#local-6989586621679024708"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Nat</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-111"></a><span>  </span><span class="hs-identifier">LookupParam</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024709"><span class="hs-identifier hs-type">param</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024710"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024711"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-112"></a><span>  </span><span class="hs-identifier">LookupParam</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024712"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024713"><span class="hs-identifier hs-type">m</span></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024714"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#IfEq"><span class="hs-identifier hs-type">IfEq</span></a><span> </span><a href="#local-6989586621679024713"><span class="hs-identifier hs-type">m</span></a><span> </span><a href="#local-6989586621679024714"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier hs-type">MaybeAdd</span></a><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-type">LookupParam</span></a><span> </span><a href="#local-6989586621679024712"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024714"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-113"></a><span>  </span><span class="hs-identifier">LookupParam</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024716"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024717"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier hs-type">MaybeAdd</span></a><span> </span><span class="hs-special">(</span><a href="Data.Generics.Internal.Families.Changing.html#LookupParam"><span class="hs-identifier hs-type">LookupParam</span></a><span> </span><a href="#local-6989586621679024716"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024717"><span class="hs-identifier hs-type">n</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-114"></a><span>  </span><span class="hs-identifier">LookupParam</span><span> </span><a href="#local-6989586621679024719"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="MaybeAdd"><a href="Data.Generics.Internal.Families.Changing.html#MaybeAdd"><span class="hs-identifier">MaybeAdd</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024701"><a href="#local-6989586621679024701"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024702"><a href="#local-6989586621679024702"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-identifier hs-type">Nat</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-117"></a><span>  </span><span class="hs-identifier">MaybeAdd</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span> </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Nothing</span><span>
</span><a name="line-118"></a><span>  </span><span class="hs-identifier">MaybeAdd</span><span> </span><span class="hs-special">(</span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><a href="#local-6989586621679024704"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024705"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">'</span><span class="hs-identifier hs-type">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">a</span><span> </span><span class="hs-operator hs-type">+</span><span> </span><a href="#local-6989586621679024705"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-119"></a><span>
</span><a name="line-120"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="IfEq"><a href="Data.Generics.Internal.Families.Changing.html#IfEq"><span class="hs-identifier">IfEq</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024639"><a href="#local-6989586621679024639"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024638"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024640"><a href="#local-6989586621679024640"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024638"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024641"><a href="#local-6989586621679024641"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024637"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024642"><a href="#local-6989586621679024642"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024637"><span class="hs-identifier hs-type">l</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024637"><span class="hs-identifier hs-type">l</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-identifier">IfEq</span><span> </span><a href="#local-6989586621679024643"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024643"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024644"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024644"><span class="hs-identifier hs-type">t</span></a><span>
</span><a name="line-122"></a><span>  </span><span class="hs-identifier">IfEq</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a href="#local-6989586621679024646"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024646"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-123"></a><span>
</span><a name="line-124"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="ArgCount"><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier">ArgCount</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679024633"><a href="#local-6989586621679024633"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679024632"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-125"></a><span>  </span><span class="hs-identifier">ArgCount</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024634"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679024635"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-operator hs-type">+</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#ArgCount"><span class="hs-identifier hs-type">ArgCount</span></a><span> </span><a href="#local-6989586621679024634"><span class="hs-identifier hs-type">f</span></a><span>
</span><a name="line-126"></a><span>  </span><span class="hs-identifier">ArgCount</span><span> </span><a href="#local-6989586621679024636"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-127"></a><span>
</span><a name="line-128"></a><span class="hs-keyword">type</span><span> </span><span class="hs-keyword">family</span><span> </span><a name="ArgAt"><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier">ArgAt</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679022628"><a href="#local-6989586621679022628"><span class="hs-identifier">t</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679022627"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679024470"><a href="#local-6989586621679024470"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Nat</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679022626"><span class="hs-identifier hs-type">j</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-129"></a><span>  </span><span class="hs-identifier">ArgAt</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024471"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679024472"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679024472"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-130"></a><span>  </span><span class="hs-identifier">ArgAt</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679024473"><span class="hs-identifier hs-type">t</span></a><span> </span><a href="#local-6989586621679024474"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679024475"><span class="hs-identifier hs-type">n</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#ArgAt"><span class="hs-identifier hs-type">ArgAt</span></a><span> </span><a href="#local-6989586621679024473"><span class="hs-identifier hs-type">t</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">n</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- Note [CPP in instance constraints]</span><span>
</span><a name="line-134"></a><span class="hs-comment">-- ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~</span><span>
</span><a name="line-135"></a><span class="hs-comment">--</span><span>
</span><a name="line-136"></a><span class="hs-comment">-- In GHC 8.0.2, the calculated size of the expressions is too large for the</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- inliner to consider them under the default -funfolding-use-threshold value</span><span>
</span><a name="line-138"></a><span class="hs-comment">-- (60).</span><span>
</span><a name="line-139"></a><span class="hs-comment">--</span><span>
</span><a name="line-140"></a><span class="hs-comment">-- To reduce the size, the constraints</span><span>
</span><a name="line-141"></a><span class="hs-comment">--</span><span>
</span><a name="line-142"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-143"></a><span class="hs-comment">-- s' ~ Proxied s</span><span>
</span><a name="line-144"></a><span class="hs-comment">-- t' ~ Proxied t</span><span>
</span><a name="line-145"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-146"></a><span class="hs-comment">--</span><span>
</span><a name="line-147"></a><span class="hs-comment">-- are written as the following single equality:</span><span>
</span><a name="line-148"></a><span class="hs-comment">--</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-150"></a><span class="hs-comment">-- '(s', t') ~ '(Proxied s, Proxied t)</span><span>
</span><a name="line-151"></a><span class="hs-comment">-- ```</span><span>
</span><a name="line-152"></a><span class="hs-comment">--</span><span>
</span><a name="line-153"></a><span class="hs-comment">-- However, for some reason, this violates the functional dependencies on 8.2.2.</span><span>
</span><a name="line-154"></a><span class="hs-comment">-- Therefore, when using a newer version of the compiler, the original constraints</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- are used, as the expression size is smaller under 8.2.2.</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span class="hs-comment">-- | Ensure that the types @a@ and @b@ are both applications of the same</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- constructor. The arguments may be different.</span><span>
</span><a name="line-159"></a><span class="hs-keyword">class</span><span> </span><a name="UnifyHead"><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier">UnifyHead</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679022624"><a href="#local-6989586621679022624"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679022623"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679022625"><a href="#local-6989586621679022625"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><a href="#local-6989586621679022623"><span class="hs-identifier hs-type">k</span></a><span class="hs-special">)</span><span>
</span><a name="line-160"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-pragma">{-# OVERLAPPING</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">gb</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621679025058"><span class="hs-identifier hs-type">g</span></a><span> </span><a href="#local-6989586621679025059"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-type">UnifyHead</span></a><span> </span><a href="#local-6989586621679025060"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679025058"><span class="hs-identifier hs-type">g</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-type">UnifyHead</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679025060"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679025061"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679025057"><span class="hs-identifier hs-type">gb</span></a><span>
</span><a name="line-161"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">a</span><span> </span><span class="hs-glyph">~</span><span> </span><a href="#local-6989586621679024789"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="Data.Generics.Internal.Families.Changing.html#UnifyHead"><span class="hs-identifier hs-type">UnifyHead</span></a><span> </span><a href="#local-6989586621679024788"><span class="hs-identifier hs-type">a</span></a><span> </span><a href="#local-6989586621679024789"><span class="hs-identifier hs-type">b</span></a><span>
</span><a name="line-162"></a></pre></body></html>