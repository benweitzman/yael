<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- |</span><span>
</span><a name="line-4"></a><span class="hs-comment">-- Module      :  Database.PostgreSQL.LibPQ</span><span>
</span><a name="line-5"></a><span class="hs-comment">-- Copyright   :  (c) 2010 Grant Monroe,</span><span>
</span><a name="line-6"></a><span class="hs-comment">--                (c) 2011 Leon P Smith</span><span>
</span><a name="line-7"></a><span class="hs-comment">-- License     :  BSD3</span><span>
</span><a name="line-8"></a><span class="hs-comment">--</span><span>
</span><a name="line-9"></a><span class="hs-comment">-- Maintainer  :  leon@melding-monads.com</span><span>
</span><a name="line-10"></a><span class="hs-comment">-- Stability   :  experimental</span><span>
</span><a name="line-11"></a><span class="hs-comment">--</span><span>
</span><a name="line-12"></a><span class="hs-comment">-- This is a binding to libpq: the C application programmer's</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- interface to PostgreSQL. libpq is a set of library functions that</span><span>
</span><a name="line-14"></a><span class="hs-comment">-- allow client programs to pass queries to the PostgreSQL backend</span><span>
</span><a name="line-15"></a><span class="hs-comment">-- server and to receive the results of these queries.</span><span>
</span><a name="line-16"></a><span class="hs-comment">--</span><span>
</span><a name="line-17"></a><span class="hs-comment">-- This is intended to be a very low-level interface to libpq.  It</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- provides memory management and a somewhat more consistent interface</span><span>
</span><a name="line-19"></a><span class="hs-comment">-- to error conditions.  Application code should typically use a</span><span>
</span><a name="line-20"></a><span class="hs-comment">-- higher-level PostgreSQL binding.</span><span>
</span><a name="line-21"></a><span class="hs-comment">--</span><span>
</span><a name="line-22"></a><span class="hs-comment">-- This interface is not safe,  because libpq unfortunately conflates</span><span>
</span><a name="line-23"></a><span class="hs-comment">-- explicit disconnects with memory management.   A use-after-free memory</span><span>
</span><a name="line-24"></a><span class="hs-comment">-- fault will result if a connection is used in any way after 'finish' is</span><span>
</span><a name="line-25"></a><span class="hs-comment">-- called.  This will likely cause a segfault,  or return an error if memory</span><span>
</span><a name="line-26"></a><span class="hs-comment">-- has not yet been reused.  Other more bizarre behaviors are possible,</span><span>
</span><a name="line-27"></a><span class="hs-comment">-- though unlikely by chance.  Higher-level bindings need to be aware of</span><span>
</span><a name="line-28"></a><span class="hs-comment">-- this issue and need to ensure that application code cannot cause the</span><span>
</span><a name="line-29"></a><span class="hs-comment">-- functions in this module to be called on an 'finish'ed connection.</span><span>
</span><a name="line-30"></a><span class="hs-comment">--</span><span>
</span><a name="line-31"></a><span class="hs-comment">-- One possibility is to represent a connection in a higher-level interface</span><span>
</span><a name="line-32"></a><span class="hs-comment">-- as @MVar (Maybe Connection)@, using @Nothing@ to represent an explicitly</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- disconnected state.  This was done in an earlier incarnation of this</span><span>
</span><a name="line-34"></a><span class="hs-comment">-- library,  however this was removed because a higher level binding is</span><span>
</span><a name="line-35"></a><span class="hs-comment">-- likely to use a similar construct to deal with other issues.  Thus</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- incorporating that in this module results in extra layers of indirection</span><span>
</span><a name="line-37"></a><span class="hs-comment">-- for relatively little functionality.</span><span>
</span><a name="line-38"></a><span class="hs-comment">--</span><span>
</span><a name="line-39"></a><span class="hs-comment">-----------------------------------------------------------------------------</span><span>
</span><a name="line-40"></a><span>
</span><a name="line-41"></a><span class="hs-pragma">{-# LANGUAGE ForeignFunctionInterface   #-}</span><span>
</span><a name="line-42"></a><span class="hs-pragma">{-# LANGUAGE EmptyDataDecls             #-}</span><span>
</span><a name="line-43"></a><span class="hs-pragma">{-# LANGUAGE OverloadedStrings          #-}</span><span>
</span><a name="line-44"></a><span class="hs-pragma">{-# LANGUAGE ScopedTypeVariables        #-}</span><span>
</span><a name="line-45"></a><span class="hs-pragma">{-# LANGUAGE BangPatterns               #-}</span><span>
</span><a name="line-46"></a><span class="hs-pragma">{-# LANGUAGE GeneralizedNewtypeDeriving #-}</span><span>
</span><a name="line-47"></a><span class="hs-pragma">{-# LANGUAGE DeriveDataTypeable         #-}</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Database.PostgreSQL.LibPQ</span><span>
</span><a name="line-50"></a><span>    </span><span class="hs-special">(</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-comment">-- * Database Connection Control Functions</span><span>
</span><a name="line-52"></a><span>    </span><span class="hs-comment">-- $dbconn</span><span>
</span><a name="line-53"></a><span>      </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-54"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">connectdb</span><span>
</span><a name="line-55"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">connectStart</span><span>
</span><a name="line-56"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">connectPoll</span><span>
</span><a name="line-57"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">newNullConnection</span><span>
</span><a name="line-58"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isNullConnection</span><span>
</span><a name="line-59"></a><span>    </span><span class="hs-comment">--, conndefaults</span><span>
</span><a name="line-60"></a><span>    </span><span class="hs-comment">--, conninfoParse</span><span>
</span><a name="line-61"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">reset</span><span>
</span><a name="line-62"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resetStart</span><span>
</span><a name="line-63"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resetPoll</span><span>
</span><a name="line-64"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">PollingStatus</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-65"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">finish</span><span>
</span><a name="line-66"></a><span>
</span><a name="line-67"></a><span>    </span><span class="hs-comment">-- * Connection Status Functions</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-comment">-- $connstatus</span><span>
</span><a name="line-69"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">db</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">user</span><span>
</span><a name="line-71"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">pass</span><span>
</span><a name="line-72"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">host</span><span>
</span><a name="line-73"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">port</span><span>
</span><a name="line-74"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">options</span><span>
</span><a name="line-75"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ConnStatus</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">status</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">TransactionStatus</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">transactionStatus</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">parameterStatus</span><span>
</span><a name="line-80"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">protocolVersion</span><span>
</span><a name="line-81"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">serverVersion</span><span>
</span><a name="line-82"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">libpqVersion</span><span>
</span><a name="line-83"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">errorMessage</span><span>
</span><a name="line-84"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">socket</span><span>
</span><a name="line-85"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">backendPID</span><span>
</span><a name="line-86"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">connectionNeedsPassword</span><span>
</span><a name="line-87"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">connectionUsedPassword</span><span>
</span><a name="line-88"></a><span>    </span><span class="hs-comment">--, getssl</span><span>
</span><a name="line-89"></a><span>
</span><a name="line-90"></a><span>
</span><a name="line-91"></a><span>    </span><span class="hs-comment">-- * Command Execution Functions</span><span>
</span><a name="line-92"></a><span>    </span><span class="hs-comment">-- $commandexec</span><span>
</span><a name="line-93"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-94"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">exec</span><span>
</span><a name="line-95"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Format</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-96"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Oid</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-97"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">invalidOid</span><span>
</span><a name="line-98"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">execParams</span><span>
</span><a name="line-99"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">prepare</span><span>
</span><a name="line-100"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">execPrepared</span><span>
</span><a name="line-101"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">describePrepared</span><span>
</span><a name="line-102"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">describePortal</span><span>
</span><a name="line-103"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ExecStatus</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-104"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resultStatus</span><span>
</span><a name="line-105"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resStatus</span><span>
</span><a name="line-106"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resultErrorMessage</span><span>
</span><a name="line-107"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">FieldCode</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-108"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">resultErrorField</span><span>
</span><a name="line-109"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unsafeFreeResult</span><span>
</span><a name="line-110"></a><span>
</span><a name="line-111"></a><span>    </span><span class="hs-comment">-- * Retrieving Query Result Information</span><span>
</span><a name="line-112"></a><span>    </span><span class="hs-comment">-- $queryresultinfo</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ntuples</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nfields</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Row</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Column</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toRow</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">toColumn</span><span>
</span><a name="line-119"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fname</span><span>
</span><a name="line-120"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fnumber</span><span>
</span><a name="line-121"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ftable</span><span>
</span><a name="line-122"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ftablecol</span><span>
</span><a name="line-123"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fformat</span><span>
</span><a name="line-124"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ftype</span><span>
</span><a name="line-125"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fmod</span><span>
</span><a name="line-126"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">fsize</span><span>
</span><a name="line-127"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getvalue</span><span>
</span><a name="line-128"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getvalue'</span><span>
</span><a name="line-129"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getisnull</span><span>
</span><a name="line-130"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getlength</span><span>
</span><a name="line-131"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">nparams</span><span>
</span><a name="line-132"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">paramtype</span><span>
</span><a name="line-133"></a><span>
</span><a name="line-134"></a><span>    </span><span class="hs-comment">-- Retrieving Result Information for Other Commands</span><span>
</span><a name="line-135"></a><span>    </span><span class="hs-comment">-- $othercommands</span><span>
</span><a name="line-136"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cmdStatus</span><span>
</span><a name="line-137"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cmdTuples</span><span>
</span><a name="line-138"></a><span>
</span><a name="line-139"></a><span>    </span><span class="hs-comment">-- * Escaping Strings for Inclusion in SQL Commands</span><span>
</span><a name="line-140"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">escapeStringConn</span><span>
</span><a name="line-141"></a><span>
</span><a name="line-142"></a><span>    </span><span class="hs-comment">-- * Escaping Binary Strings for Inclusion in SQL Commands</span><span>
</span><a name="line-143"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">escapeByteaConn</span><span>
</span><a name="line-144"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">unescapeBytea</span><span>
</span><a name="line-145"></a><span>
</span><a name="line-146"></a><span>    </span><span class="hs-comment">-- * Escaping Identifiers for Inclusion in SQL Commands</span><span>
</span><a name="line-147"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">escapeIdentifier</span><span>
</span><a name="line-148"></a><span>
</span><a name="line-149"></a><span>    </span><span class="hs-comment">-- * Using COPY</span><span>
</span><a name="line-150"></a><span>    </span><span class="hs-comment">-- $copy</span><span>
</span><a name="line-151"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">CopyInResult</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">putCopyData</span><span>
</span><a name="line-153"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">putCopyEnd</span><span>
</span><a name="line-154"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">CopyOutResult</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-155"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getCopyData</span><span>
</span><a name="line-156"></a><span>
</span><a name="line-157"></a><span>    </span><span class="hs-comment">-- * Asynchronous Command Processing</span><span>
</span><a name="line-158"></a><span>    </span><span class="hs-comment">-- $asynccommand</span><span>
</span><a name="line-159"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sendQuery</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sendQueryParams</span><span>
</span><a name="line-161"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sendPrepare</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sendQueryPrepared</span><span>
</span><a name="line-163"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sendDescribePrepared</span><span>
</span><a name="line-164"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">sendDescribePortal</span><span>
</span><a name="line-165"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getResult</span><span>
</span><a name="line-166"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">consumeInput</span><span>
</span><a name="line-167"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isBusy</span><span>
</span><a name="line-168"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">setnonblocking</span><span>
</span><a name="line-169"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">isnonblocking</span><span>
</span><a name="line-170"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">setSingleRowMode</span><span>
</span><a name="line-171"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">FlushStatus</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">flush</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span>    </span><span class="hs-comment">-- * Cancelling Queries in Progress</span><span>
</span><a name="line-175"></a><span>    </span><span class="hs-comment">-- $cancel</span><span>
</span><a name="line-176"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Cancel</span><span>
</span><a name="line-177"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getCancel</span><span>
</span><a name="line-178"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">cancel</span><span>
</span><a name="line-179"></a><span>
</span><a name="line-180"></a><span>    </span><span class="hs-comment">-- * Asynchronous Notification</span><span>
</span><a name="line-181"></a><span>    </span><span class="hs-comment">-- $asyncnotification</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Notify</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">notifies</span><span>
</span><a name="line-184"></a><span>
</span><a name="line-185"></a><span>    </span><span class="hs-comment">-- * Control Functions</span><span>
</span><a name="line-186"></a><span>    </span><span class="hs-comment">-- $control</span><span>
</span><a name="line-187"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">clientEncoding</span><span>
</span><a name="line-188"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">setClientEncoding</span><span>
</span><a name="line-189"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Verbosity</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-190"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">setErrorVerbosity</span><span>
</span><a name="line-191"></a><span>
</span><a name="line-192"></a><span>    </span><span class="hs-comment">-- * Nonfatal Error Reporting</span><span>
</span><a name="line-193"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">disableNoticeReporting</span><span>
</span><a name="line-194"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">enableNoticeReporting</span><span>
</span><a name="line-195"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">getNotice</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span>    </span><span class="hs-comment">-- * Large Objects</span><span>
</span><a name="line-198"></a><span>    </span><span class="hs-comment">-- $largeobjects</span><span>
</span><a name="line-199"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">LoFd</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-200"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loCreat</span><span>
</span><a name="line-201"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loCreate</span><span>
</span><a name="line-202"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loImport</span><span>
</span><a name="line-203"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loImportWithOid</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loExport</span><span>
</span><a name="line-205"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loOpen</span><span>
</span><a name="line-206"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loWrite</span><span>
</span><a name="line-207"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loRead</span><span>
</span><a name="line-208"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loSeek</span><span>
</span><a name="line-209"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loTell</span><span>
</span><a name="line-210"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loTruncate</span><span>
</span><a name="line-211"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loClose</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">loUnlink</span><span>
</span><a name="line-213"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-214"></a><span class="hs-keyword">where</span><span>
</span><a name="line-215"></a><span>
</span><a name="line-216"></a><span>
</span><a name="line-217"></a><span>
</span><a name="line-218"></a><span>
</span><a name="line-219"></a><span>
</span><a name="line-220"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Prelude</span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">print</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign</span><span>
</span><a name="line-222"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.Types</span><span>
</span><a name="line-223"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Foreign.C.String</span><span>
</span><a name="line-224"></a><span>
</span><a name="line-225"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">224</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-226"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Foreign.ForeignPtr.Unsafe</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Unsafe</span><span>
</span><a name="line-227"></a><span>
</span><a name="line-228"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">226</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-229"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Foreign.Concurrent</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">FC</span><span>
</span><a name="line-230"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Posix.Types</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Fd</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-231"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">foldl'</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-232"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.IO</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">IOMode</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">SeekMode</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-233"></a><span>
</span><a name="line-234"></a><span>
</span><a name="line-235"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">232</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-236"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">GHC.Conc</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">closeFdWith</span><span> </span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- Won't work with GHC 7.0.1</span><span>
</span><a name="line-237"></a><span>
</span><a name="line-238"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">234</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-239"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Posix.Types</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">CPid</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-240"></a><span>
</span><a name="line-241"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.ByteString.Char8</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-242"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Unsafe</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-243"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString.Internal</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">fromForeignPtr</span><span>
</span><a name="line-244"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">c_strlen</span><span>
</span><a name="line-245"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">createAndTrim</span><span>
</span><a name="line-246"></a><span>                                               </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">ByteString</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><a name="line-247"></a><span>                                               </span><span class="hs-special">)</span><span>
</span><a name="line-248"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.ByteString</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">B</span><span>
</span><a name="line-249"></a><span>
</span><a name="line-250"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Concurrent.MVar</span><span>
</span><a name="line-251"></a><span>
</span><a name="line-252"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Typeable</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Database.PostgreSQL.LibPQ.Internal</span><span>
</span><a name="line-255"></a><span>
</span><a name="line-256"></a><span>
</span><a name="line-257"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">252</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-258"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">mask_</span><span class="hs-special">)</span><span>
</span><a name="line-259"></a><span>
</span><a name="line-260"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">257</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-261"></a><span>
</span><a name="line-262"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Exception</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">try</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">IOException</span><span class="hs-special">)</span><span>
</span><a name="line-263"></a><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">261</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-266"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Posix.DynamicLinker</span><span>
</span><a name="line-267"></a><span>
</span><a name="line-268"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">265</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-269"></a><span>
</span><a name="line-270"></a><span class="hs-comment">-- $dbconn</span><span>
</span><a name="line-271"></a><span class="hs-comment">-- The following functions deal with making a connection to a</span><span>
</span><a name="line-272"></a><span class="hs-comment">-- PostgreSQL backend server. An application program can have several</span><span>
</span><a name="line-273"></a><span class="hs-comment">-- backend connections open at one time. (One reason to do that is to</span><span>
</span><a name="line-274"></a><span class="hs-comment">-- access more than one database.) Each connection is represented by a</span><span>
</span><a name="line-275"></a><span class="hs-comment">-- 'Connection', which is obtained from the function 'connectdb', or</span><span>
</span><a name="line-276"></a><span class="hs-comment">-- 'connectStart'. The 'status' function should be called to check</span><span>
</span><a name="line-277"></a><span class="hs-comment">-- whether a connection was successfully made before queries are sent</span><span>
</span><a name="line-278"></a><span class="hs-comment">-- via the connection object.</span><span>
</span><a name="line-279"></a><span>
</span><a name="line-280"></a><span class="hs-comment">-- | Makes a new connection to the database server.</span><span>
</span><a name="line-281"></a><span class="hs-comment">--</span><span>
</span><a name="line-282"></a><span class="hs-comment">-- This function opens a new database connection using the parameters</span><span>
</span><a name="line-283"></a><span class="hs-comment">--  taken from the string conninfo. Its nonblocking analogues are</span><span>
</span><a name="line-284"></a><span class="hs-comment">--  'connectStart' and 'connectPoll'.</span><span>
</span><a name="line-285"></a><span class="hs-comment">--</span><span>
</span><a name="line-286"></a><span class="hs-comment">-- The passed string can be empty to use all default parameters, or it</span><span>
</span><a name="line-287"></a><span class="hs-comment">-- can contain one or more parameter settings separated by</span><span>
</span><a name="line-288"></a><span class="hs-comment">-- whitespace. Each parameter setting is in the form keyword =</span><span>
</span><a name="line-289"></a><span class="hs-comment">-- value. Spaces around the equal sign are optional. To write an empty</span><span>
</span><a name="line-290"></a><span class="hs-comment">-- value or a value containing spaces, surround it with single quotes,</span><span>
</span><a name="line-291"></a><span class="hs-comment">-- e.g., keyword = 'a value'. Single quotes and backslashes within the</span><span>
</span><a name="line-292"></a><span class="hs-comment">-- value must be escaped with a backslash, i.e., \' and \\.</span><span>
</span><a name="line-293"></a><span class="hs-identifier">connectdb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ Connection Info</span><span>
</span><a name="line-294"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-295"></a><span class="hs-identifier">connectdb</span><span> </span><span class="hs-identifier">conninfo</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-296"></a><span>    </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-297"></a><span>       </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">conninfo</span><span> </span><span class="hs-identifier">c_PQconnectdb</span><span>
</span><a name="line-298"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-299"></a><span>           </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-string">&quot;libpq failed to allocate a PGconn structure&quot;</span><span>
</span><a name="line-300"></a><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-301"></a><span>             </span><span class="hs-identifier">noticeBuffer</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newMVar</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-302"></a><span>             </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtrOnce</span><span> </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pqfinish</span><span> </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-identifier">noticeBuffer</span><span class="hs-special">)</span><span>
</span><a name="line-303"></a><span>             </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">noticeBuffer</span><span>
</span><a name="line-304"></a><span>
</span><a name="line-305"></a><span class="hs-comment">-- | Make a connection to the database server in a nonblocking manner.</span><span>
</span><a name="line-306"></a><span class="hs-identifier">connectStart</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ Connection Info</span><span>
</span><a name="line-307"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-308"></a><span class="hs-identifier">connectStart</span><span> </span><span class="hs-identifier">connStr</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-309"></a><span>    </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-310"></a><span>       </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">connStr</span><span> </span><span class="hs-identifier">c_PQconnectStart</span><span>
</span><a name="line-311"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-312"></a><span>           </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-string">&quot;libpq failed to allocate a PGconn structure&quot;</span><span>
</span><a name="line-313"></a><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-314"></a><span>             </span><span class="hs-identifier">noticeBuffer</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newMVar</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-315"></a><span>             </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtrOnce</span><span> </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">pqfinish</span><span> </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-identifier">noticeBuffer</span><span class="hs-special">)</span><span>
</span><a name="line-316"></a><span>             </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">noticeBuffer</span><span>
</span><a name="line-317"></a><span>
</span><a name="line-318"></a><span class="hs-identifier">pqfinish</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">MVar</span><span> </span><span class="hs-identifier">NoticeBuffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-319"></a><span class="hs-identifier">pqfinish</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">noticeBuffer</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-320"></a><span>
</span><a name="line-321"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">317</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-322"></a><span class="hs-comment">--   This covers the case when a connection is closed while other Haskell</span><span>
</span><a name="line-323"></a><span class="hs-comment">--   threads are using GHC's IO manager to wait on the descriptor.  This is</span><span>
</span><a name="line-324"></a><span class="hs-comment">--   commonly the case with asynchronous notifications, for example.  Since</span><span>
</span><a name="line-325"></a><span class="hs-comment">--   libpq is responsible for opening and closing the file descriptor, GHC's</span><span>
</span><a name="line-326"></a><span class="hs-comment">--   IO manager needs to be informed that the file descriptor has been</span><span>
</span><a name="line-327"></a><span class="hs-comment">--   closed.  The IO manager will then raise an exception in those threads.</span><span>
</span><a name="line-328"></a><span>   </span><span class="hs-identifier">mfd</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQsocket</span><span> </span><span class="hs-identifier">conn</span><span>
</span><a name="line-329"></a><span>   </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">mfd</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-330"></a><span>     </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-comment">-- This can happen if the connection is bad/lost</span><span>
</span><a name="line-331"></a><span>           </span><span class="hs-comment">-- This case may be worth investigating further</span><span>
</span><a name="line-332"></a><span>           </span><span class="hs-identifier">c_PQfinish</span><span> </span><span class="hs-identifier">conn</span><span>
</span><a name="line-333"></a><span>     </span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">closeFdWith</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQfinish</span><span> </span><span class="hs-identifier">conn</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Fd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><a name="line-334"></a><span>
</span><a name="line-335"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">332</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-336"></a><span>   </span><span class="hs-identifier">nb</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">swapMVar</span><span> </span><span class="hs-identifier">noticeBuffer</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-337"></a><span>   </span><span class="hs-identifier">c_free_noticebuffer</span><span> </span><span class="hs-identifier">nb</span><span>
</span><a name="line-338"></a><span>
</span><a name="line-339"></a><span class="hs-comment">-- | Workaround for bug in 'FC.newForeignPtr' before base 4.6.  Ensure the</span><span>
</span><a name="line-340"></a><span class="hs-comment">-- finalizer is only run once, to prevent a segfault.  See GHC ticket #7170</span><span>
</span><a name="line-341"></a><span class="hs-comment">--</span><span>
</span><a name="line-342"></a><span class="hs-comment">-- Note that 'getvalue' and 'maybeBsFromForeignPtr' do not need this</span><span>
</span><a name="line-343"></a><span class="hs-comment">-- workaround, since their finalizers are just 'touchForeignPtr' calls.</span><span>
</span><a name="line-344"></a><span class="hs-identifier">newForeignPtrOnce</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForeignPtr</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-345"></a><span class="hs-identifier">newForeignPtrOnce</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">fin</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-346"></a><span>    </span><span class="hs-identifier">mv</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newMVar</span><span> </span><span class="hs-identifier">fin</span><span>
</span><a name="line-347"></a><span>    </span><span class="hs-identifier">FC.newForeignPtr</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">tryTakeMVar</span><span> </span><span class="hs-identifier">mv</span><span> </span><span class="hs-operator">&gt;&gt;=</span><span> </span><span class="hs-identifier">maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">id</span><span>
</span><a name="line-348"></a><span>
</span><a name="line-349"></a><span class="hs-comment">-- | Allocate a Null Connection,  which all libpq functions</span><span>
</span><a name="line-350"></a><span class="hs-comment">-- should safely fail on.</span><span>
</span><a name="line-351"></a><span class="hs-identifier">newNullConnection</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-352"></a><span class="hs-identifier">newNullConnection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-353"></a><span>  </span><span class="hs-identifier">connection</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr_</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-354"></a><span>  </span><span class="hs-identifier">noticeBuffer</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newMVar</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-355"></a><span>  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">noticeBuffer</span><span>
</span><a name="line-356"></a><span>
</span><a name="line-357"></a><span class="hs-comment">-- | Test if a connection is the Null Connection.</span><span>
</span><a name="line-358"></a><span class="hs-identifier">isNullConnection</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-359"></a><span>
</span><a name="line-360"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">356</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-361"></a><span class="hs-identifier">isNullConnection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Unsafe.unsafeForeignPtrToPtr</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-362"></a><span>
</span><a name="line-363"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">360</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-364"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">isNullConnection</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-365"></a><span>
</span><a name="line-366"></a><span class="hs-comment">-- | If 'connectStart' succeeds, the next stage is to poll libpq so</span><span>
</span><a name="line-367"></a><span class="hs-comment">-- that it can proceed with the connection sequence. Use 'socket' to</span><span>
</span><a name="line-368"></a><span class="hs-comment">-- obtain the 'Fd' of the socket underlying the database</span><span>
</span><a name="line-369"></a><span class="hs-comment">-- connection. Loop thus: If 'connectPoll' last returned</span><span>
</span><a name="line-370"></a><span class="hs-comment">-- 'PollingReading', wait until the socket is ready to read (as</span><span>
</span><a name="line-371"></a><span class="hs-comment">-- indicated by select(), poll(), or similar system function). Then</span><span>
</span><a name="line-372"></a><span class="hs-comment">-- call 'connectPoll' again. Conversely, if 'connectPoll' last</span><span>
</span><a name="line-373"></a><span class="hs-comment">-- returned 'PollingWriting', wait until the socket is ready to write,</span><span>
</span><a name="line-374"></a><span class="hs-comment">-- then call 'connectPoll' again. If you have yet to call</span><span>
</span><a name="line-375"></a><span class="hs-comment">-- 'connectPoll', i.e., just after the call to 'connectStart', behave</span><span>
</span><a name="line-376"></a><span class="hs-comment">-- as if it last returned 'PollingWriting'. Continue this loop until</span><span>
</span><a name="line-377"></a><span class="hs-comment">-- 'connectPoll' returns 'PollingFailed', indicating the connection</span><span>
</span><a name="line-378"></a><span class="hs-comment">-- procedure has failed, or 'PollingOk', indicating the connection has</span><span>
</span><a name="line-379"></a><span class="hs-comment">-- been successfully made.</span><span>
</span><a name="line-380"></a><span class="hs-identifier">connectPoll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-381"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">PollingStatus</span><span>
</span><a name="line-382"></a><span class="hs-identifier">connectPoll</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pollHelper</span><span> </span><span class="hs-identifier">c_PQconnectPoll</span><span>
</span><a name="line-383"></a><span>
</span><a name="line-384"></a><span>
</span><a name="line-385"></a><span class="hs-comment">-- PQconndefaults</span><span>
</span><a name="line-386"></a><span class="hs-comment">-- Returns the default connection options.</span><span>
</span><a name="line-387"></a><span>
</span><a name="line-388"></a><span class="hs-comment">-- PQconninfoOption *PQconndefaults(void);</span><span>
</span><a name="line-389"></a><span>
</span><a name="line-390"></a><span class="hs-comment">-- typedef struct</span><span>
</span><a name="line-391"></a><span class="hs-comment">-- {</span><span>
</span><a name="line-392"></a><span class="hs-comment">--     char   *keyword;   /* The keyword of the option */</span><span>
</span><a name="line-393"></a><span class="hs-comment">--     char   *envvar;    /* Fallback environment variable name */</span><span>
</span><a name="line-394"></a><span class="hs-comment">--     char   *compiled;  /* Fallback compiled in default value */</span><span>
</span><a name="line-395"></a><span class="hs-comment">--     char   *val;       /* Option's current value, or NULL */</span><span>
</span><a name="line-396"></a><span class="hs-comment">--     char   *label;     /* Label for field in connect dialog */</span><span>
</span><a name="line-397"></a><span class="hs-comment">--     char   *dispchar;  /* Indicates how to display this field</span><span>
</span><a name="line-398"></a><span class="hs-comment">--                           in a connect dialog. Values are:</span><span>
</span><a name="line-399"></a><span class="hs-comment">--                           &quot;&quot;        Display entered value as is</span><span>
</span><a name="line-400"></a><span class="hs-comment">--                           &quot;*&quot;       Password field - hide value</span><span>
</span><a name="line-401"></a><span class="hs-comment">--                           &quot;D&quot;       Debug option - don't show by default */</span><span>
</span><a name="line-402"></a><span class="hs-comment">--     int     dispsize;  /* Field size in characters for dialog */</span><span>
</span><a name="line-403"></a><span class="hs-comment">-- } PQconninfoOption;</span><span>
</span><a name="line-404"></a><span class="hs-comment">-- Returns a connection options array. This can be used to determine all possible PQconnectdb options and their current default values. The return value points to an array of PQconninfoOption structures, which ends with an entry having a null keyword pointer. The null pointer is returned if memory could not be allocated. Note that the current default values (val fields) will depend on environment variables and other context. Callers must treat the connection options data as read-only.</span><span>
</span><a name="line-405"></a><span>
</span><a name="line-406"></a><span class="hs-comment">-- After processing the options array, free it by passing it to PQconninfoFree. If this is not done, a small amount of memory is leaked for each call to PQconndefaults.</span><span>
</span><a name="line-407"></a><span>
</span><a name="line-408"></a><span class="hs-comment">-- PQconninfoParse</span><span>
</span><a name="line-409"></a><span class="hs-comment">-- Returns parsed connection options from the provided connection string.</span><span>
</span><a name="line-410"></a><span>
</span><a name="line-411"></a><span class="hs-comment">-- PQconninfoOption *PQconninfoParse(const char *conninfo, char **errmsg);</span><span>
</span><a name="line-412"></a><span class="hs-comment">-- Parses a connection string and returns the resulting options as an array; or returns NULL if there is a problem with the connection string. This can be used to determine the PQconnectdb options in the provided connection string. The return value points to an array of PQconninfoOption structures, which ends with an entry having a null keyword pointer.</span><span>
</span><a name="line-413"></a><span>
</span><a name="line-414"></a><span class="hs-comment">-- Note that only options explicitly specified in the string will have values set in the result array; no defaults are inserted.</span><span>
</span><a name="line-415"></a><span>
</span><a name="line-416"></a><span class="hs-comment">-- If errmsg is not NULL, then *errmsg is set to NULL on success, else to a malloc'd error string explaining the problem. (It is also possible for *errmsg to be set to NULL even when NULL is returned; this indicates an out-of-memory situation.)</span><span>
</span><a name="line-417"></a><span>
</span><a name="line-418"></a><span class="hs-comment">-- After processing the options array, free it by passing it to PQconninfoFree. If this is not done, some memory is leaked for each call to PQconninfoParse. Conversely, if an error occurs and errmsg is not NULL, be sure to free the error string using PQfreemem.</span><span>
</span><a name="line-419"></a><span>
</span><a name="line-420"></a><span>
</span><a name="line-421"></a><span class="hs-comment">-- | Resets the communication channel to the server.</span><span>
</span><a name="line-422"></a><span class="hs-comment">--</span><span>
</span><a name="line-423"></a><span class="hs-comment">-- This function will close the connection to the server and attempt</span><span>
</span><a name="line-424"></a><span class="hs-comment">-- to reestablish a new connection to the same server, using all the</span><span>
</span><a name="line-425"></a><span class="hs-comment">-- same parameters previously used. This might be useful for error</span><span>
</span><a name="line-426"></a><span class="hs-comment">-- recovery if a working connection is lost.</span><span>
</span><a name="line-427"></a><span class="hs-identifier">reset</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-428"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-429"></a><span class="hs-identifier">reset</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQreset</span><span>
</span><a name="line-430"></a><span>
</span><a name="line-431"></a><span>
</span><a name="line-432"></a><span class="hs-comment">-- | Reset the communication channel to the server, in a nonblocking manner.</span><span>
</span><a name="line-433"></a><span class="hs-identifier">resetStart</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-434"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-435"></a><span class="hs-identifier">resetStart</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-436"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQresetStart</span><span>
</span><a name="line-437"></a><span>
</span><a name="line-438"></a><span>
</span><a name="line-439"></a><span class="hs-comment">-- | To initiate a connection reset, call 'resetStart'. If it returns</span><span>
</span><a name="line-440"></a><span class="hs-comment">-- 'False', the reset has failed. If it returns 'True', poll the reset</span><span>
</span><a name="line-441"></a><span class="hs-comment">-- using 'resetPoll' in exactly the same way as you would create the</span><span>
</span><a name="line-442"></a><span class="hs-comment">-- connection using 'connectPoll'.</span><span>
</span><a name="line-443"></a><span class="hs-identifier">resetPoll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-444"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">PollingStatus</span><span>
</span><a name="line-445"></a><span class="hs-identifier">resetPoll</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">pollHelper</span><span> </span><span class="hs-identifier">c_PQresetPoll</span><span>
</span><a name="line-446"></a><span>
</span><a name="line-447"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">PollingStatus</span><span>
</span><a name="line-448"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">PollingFailed</span><span>
</span><a name="line-449"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">PollingReading</span><span>
</span><a name="line-450"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">PollingWriting</span><span>
</span><a name="line-451"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">PollingOk</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-452"></a><span>
</span><a name="line-453"></a><span class="hs-identifier">pollHelper</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-special">)</span><span>
</span><a name="line-454"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-455"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">PollingStatus</span><span>
</span><a name="line-456"></a><span class="hs-identifier">pollHelper</span><span> </span><span class="hs-identifier">poller</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-457"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">code</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">poller</span><span>
</span><a name="line-458"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">code</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-459"></a><span>         </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">PollingReading</span><span>
</span><a name="line-460"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">456</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-461"></a><span>         </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">PollingOk</span><span>
</span><a name="line-462"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">457</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-463"></a><span>         </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">PollingWriting</span><span>
</span><a name="line-464"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">458</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-465"></a><span>         </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">PollingFailed</span><span>
</span><a name="line-466"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">459</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-467"></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;unexpected polling status &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">code</span><span>
</span><a name="line-468"></a><span>
</span><a name="line-469"></a><span>
</span><a name="line-470"></a><span class="hs-comment">-- | Closes the connection to the server.</span><span>
</span><a name="line-471"></a><span class="hs-comment">--</span><span>
</span><a name="line-472"></a><span class="hs-comment">-- Note that the 'Connection' must not be used again after 'finish'</span><span>
</span><a name="line-473"></a><span class="hs-comment">-- has been called.</span><span>
</span><a name="line-474"></a><span class="hs-identifier">finish</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-475"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-476"></a><span class="hs-identifier">finish</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-477"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">finalizeForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span>
</span><a name="line-478"></a><span>
</span><a name="line-479"></a><span>
</span><a name="line-480"></a><span class="hs-comment">-- $connstatus</span><span>
</span><a name="line-481"></a><span class="hs-comment">-- These functions can be used to interrogate the status of an</span><span>
</span><a name="line-482"></a><span class="hs-comment">-- existing database connection object.</span><span>
</span><a name="line-483"></a><span>
</span><a name="line-484"></a><span>
</span><a name="line-485"></a><span class="hs-comment">-- | Returns the database name of the connection.</span><span>
</span><a name="line-486"></a><span class="hs-identifier">db</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-487"></a><span>   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-488"></a><span class="hs-identifier">db</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">c_PQdb</span><span>
</span><a name="line-489"></a><span>
</span><a name="line-490"></a><span>
</span><a name="line-491"></a><span class="hs-comment">-- | Returns the user name of the connection.</span><span>
</span><a name="line-492"></a><span class="hs-identifier">user</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-493"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-494"></a><span class="hs-identifier">user</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">c_PQuser</span><span>
</span><a name="line-495"></a><span>
</span><a name="line-496"></a><span>
</span><a name="line-497"></a><span class="hs-comment">-- | Returns the password of the connection.</span><span>
</span><a name="line-498"></a><span class="hs-identifier">pass</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-499"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-500"></a><span class="hs-identifier">pass</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">c_PQpass</span><span>
</span><a name="line-501"></a><span>
</span><a name="line-502"></a><span>
</span><a name="line-503"></a><span class="hs-comment">-- | Returns the server host name of the connection.</span><span>
</span><a name="line-504"></a><span class="hs-identifier">host</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-505"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-506"></a><span class="hs-identifier">host</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">c_PQhost</span><span>
</span><a name="line-507"></a><span>
</span><a name="line-508"></a><span>
</span><a name="line-509"></a><span class="hs-comment">-- | Returns the port of the connection.</span><span>
</span><a name="line-510"></a><span class="hs-identifier">port</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-511"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-512"></a><span class="hs-identifier">port</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">c_PQport</span><span>
</span><a name="line-513"></a><span>
</span><a name="line-514"></a><span>
</span><a name="line-515"></a><span class="hs-comment">-- | Returns the command-line options passed in the connection request.</span><span>
</span><a name="line-516"></a><span class="hs-identifier">options</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-517"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-518"></a><span class="hs-identifier">options</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">c_PQoptions</span><span>
</span><a name="line-519"></a><span>
</span><a name="line-520"></a><span>
</span><a name="line-521"></a><span class="hs-comment">-- | Helper function that checks for nullPtrs and returns the empty</span><span>
</span><a name="line-522"></a><span class="hs-comment">-- string.</span><span>
</span><a name="line-523"></a><span class="hs-identifier">statusString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span class="hs-special">)</span><span>
</span><a name="line-524"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-525"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-526"></a><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-527"></a><span>    </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-528"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-529"></a><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-530"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-531"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">B.packCString</span><span> </span><span class="hs-identifier">cstr</span><span>
</span><a name="line-532"></a><span>
</span><a name="line-533"></a><span>
</span><a name="line-534"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">ConnStatus</span><span>
</span><a name="line-535"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ConnectionOk</span><span>                 </span><span class="hs-comment">-- ^ The 'Connection' is ready.</span><span>
</span><a name="line-536"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ConnectionBad</span><span>                </span><span class="hs-comment">-- ^ The connection procedure has failed.</span><span>
</span><a name="line-537"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ConnectionStarted</span><span>            </span><span class="hs-comment">-- ^ Waiting for connection to be made.</span><span>
</span><a name="line-538"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ConnectionMade</span><span>               </span><span class="hs-comment">-- ^ Connection OK; waiting to send.</span><span>
</span><a name="line-539"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ConnectionAwaitingResponse</span><span>   </span><span class="hs-comment">-- ^ Waiting for a response from the server.</span><span>
</span><a name="line-540"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ConnectionAuthOk</span><span>             </span><span class="hs-comment">-- ^ Received authentication;</span><span>
</span><a name="line-541"></a><span>                                   </span><span class="hs-comment">-- waiting for backend start-up to</span><span>
</span><a name="line-542"></a><span>                                   </span><span class="hs-comment">-- finish.</span><span>
</span><a name="line-543"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ConnectionSetEnv</span><span>             </span><span class="hs-comment">-- ^ Negotiating environment-driven</span><span>
</span><a name="line-544"></a><span>                                   </span><span class="hs-comment">-- parameter settings.</span><span>
</span><a name="line-545"></a><span>    </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ConnectionSSLStartup</span><span>         </span><span class="hs-comment">-- ^ Negotiating SSL encryption.</span><span>
</span><a name="line-546"></a><span>      </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-547"></a><span>
</span><a name="line-548"></a><span>
</span><a name="line-549"></a><span class="hs-comment">-- | Returns the status of the connection.</span><span>
</span><a name="line-550"></a><span class="hs-comment">--</span><span>
</span><a name="line-551"></a><span class="hs-comment">-- The status can be one of a number of values. However, only two of</span><span>
</span><a name="line-552"></a><span class="hs-comment">-- these are seen outside of an asynchronous connection procedure:</span><span>
</span><a name="line-553"></a><span class="hs-comment">-- 'ConnectionOk' and 'ConnectionBad'. A good connection to the</span><span>
</span><a name="line-554"></a><span class="hs-comment">-- database has the status 'ConnectionOk'. A failed connection attempt</span><span>
</span><a name="line-555"></a><span class="hs-comment">-- is signaled by status 'ConnectionBad'. Ordinarily, an OK status</span><span>
</span><a name="line-556"></a><span class="hs-comment">-- will remain so until 'finish', but a communications failure might</span><span>
</span><a name="line-557"></a><span class="hs-comment">-- result in the status changing to 'ConnectionBad' prematurely. In</span><span>
</span><a name="line-558"></a><span class="hs-comment">-- that case the application could try to recover by calling 'reset'.</span><span>
</span><a name="line-559"></a><span class="hs-comment">--</span><span>
</span><a name="line-560"></a><span class="hs-comment">-- See the entry for 'connectStart' and 'connectPoll' with regards to</span><span>
</span><a name="line-561"></a><span class="hs-comment">-- other status codes that might be seen.</span><span>
</span><a name="line-562"></a><span class="hs-identifier">status</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-563"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">ConnStatus</span><span>
</span><a name="line-564"></a><span class="hs-identifier">status</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-565"></a><span>  </span><span class="hs-identifier">stat</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQstatus</span><span>
</span><a name="line-566"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-567"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionOk</span><span>
</span><a name="line-568"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">560</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-569"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">)</span><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionBad</span><span>
</span><a name="line-570"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">561</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-571"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionStarted</span><span>
</span><a name="line-572"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">562</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-573"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">)</span><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionMade</span><span>
</span><a name="line-574"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">563</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-575"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">4</span><span class="hs-special">)</span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionAwaitingResponse</span><span>
</span><a name="line-576"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">564</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-577"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">5</span><span class="hs-special">)</span><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionAuthOk</span><span>
</span><a name="line-578"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">565</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-579"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">6</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionSetEnv</span><span>
</span><a name="line-580"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">566</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-581"></a><span>    </span><span class="hs-special">(</span><span class="hs-number">7</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">ConnectionSSLStartup</span><span>
</span><a name="line-582"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">567</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-583"></a><span>    </span><span class="hs-comment">--(#const CONNECTION_NEEDED)           -&gt; ConnectionNeeded</span><span>
</span><a name="line-584"></a><span>    </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;Unknown connection status &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">c</span><span>
</span><a name="line-585"></a><span>
</span><a name="line-586"></a><span>
</span><a name="line-587"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">TransactionStatus</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TransIdle</span><span>    </span><span class="hs-comment">-- ^ currently idle</span><span>
</span><a name="line-588"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TransActive</span><span>  </span><span class="hs-comment">-- ^ a command is in progress</span><span>
</span><a name="line-589"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TransInTrans</span><span> </span><span class="hs-comment">-- ^ idle, in a valid transaction block</span><span>
</span><a name="line-590"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TransInError</span><span> </span><span class="hs-comment">-- ^ idle, in a failed transaction block</span><span>
</span><a name="line-591"></a><span>                       </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TransUnknown</span><span> </span><span class="hs-comment">-- ^ the connection is bad</span><span>
</span><a name="line-592"></a><span>                         </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-593"></a><span>
</span><a name="line-594"></a><span class="hs-comment">-- | Returns the current in-transaction status of the server.</span><span>
</span><a name="line-595"></a><span class="hs-comment">--</span><span>
</span><a name="line-596"></a><span class="hs-comment">-- 'TransActive' is reported only when a query has been sent to the</span><span>
</span><a name="line-597"></a><span class="hs-comment">-- server and not yet completed.</span><span>
</span><a name="line-598"></a><span class="hs-identifier">transactionStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-599"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">TransactionStatus</span><span>
</span><a name="line-600"></a><span class="hs-identifier">transactionStatus</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-601"></a><span>    </span><span class="hs-identifier">stat</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQtransactionStatus</span><span>
</span><a name="line-602"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-603"></a><span>      </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">TransIdle</span><span>
</span><a name="line-604"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">588</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-605"></a><span>      </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">TransActive</span><span>
</span><a name="line-606"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">589</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-607"></a><span>      </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">TransInTrans</span><span>
</span><a name="line-608"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">590</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-609"></a><span>      </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">TransInError</span><span>
</span><a name="line-610"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">591</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-611"></a><span>      </span><span class="hs-special">(</span><span class="hs-number">4</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">TransUnknown</span><span>
</span><a name="line-612"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">592</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-613"></a><span>      </span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">fail</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-string">&quot;Unknown transaction status &quot;</span><span> </span><span class="hs-operator">++</span><span> </span><span class="hs-identifier">show</span><span> </span><span class="hs-identifier">c</span><span>
</span><a name="line-614"></a><span>
</span><a name="line-615"></a><span>
</span><a name="line-616"></a><span class="hs-comment">-- | Looks up a current parameter setting of the server.</span><span>
</span><a name="line-617"></a><span class="hs-comment">--</span><span>
</span><a name="line-618"></a><span class="hs-comment">-- Certain parameter values are reported by the server automatically</span><span>
</span><a name="line-619"></a><span class="hs-comment">-- at connection startup or whenever their values</span><span>
</span><a name="line-620"></a><span class="hs-comment">-- change. 'parameterStatus' can be used to interrogate these</span><span>
</span><a name="line-621"></a><span class="hs-comment">-- settings. It returns the current value of a parameter if known, or</span><span>
</span><a name="line-622"></a><span class="hs-comment">-- 'Nothing' if the parameter is not known.</span><span>
</span><a name="line-623"></a><span class="hs-identifier">parameterStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-624"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ paramName</span><span>
</span><a name="line-625"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-626"></a><span class="hs-identifier">parameterStatus</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">paramName</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-627"></a><span>    </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-628"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">paramName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">paramNamePtr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-629"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQparameterStatus</span><span> </span><span class="hs-identifier">connPtr</span><span> </span><span class="hs-identifier">paramNamePtr</span><span>
</span><a name="line-630"></a><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-631"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-632"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">B.packCString</span><span> </span><span class="hs-identifier">cstr</span><span>
</span><a name="line-633"></a><span>
</span><a name="line-634"></a><span>
</span><a name="line-635"></a><span class="hs-comment">-- | Interrogates the frontend/backend protocol being used.</span><span>
</span><a name="line-636"></a><span class="hs-comment">--</span><span>
</span><a name="line-637"></a><span class="hs-comment">-- Applications might wish to use this to determine whether certain</span><span>
</span><a name="line-638"></a><span class="hs-comment">-- features are supported. Currently, the possible values are 2 (2.0</span><span>
</span><a name="line-639"></a><span class="hs-comment">-- protocol), 3 (3.0 protocol), or zero (connection bad). This will</span><span>
</span><a name="line-640"></a><span class="hs-comment">-- not change after connection startup is complete, but it could</span><span>
</span><a name="line-641"></a><span class="hs-comment">-- theoretically change during a connection reset. The 3.0 protocol</span><span>
</span><a name="line-642"></a><span class="hs-comment">-- will normally be used when communicating with PostgreSQL 7.4 or</span><span>
</span><a name="line-643"></a><span class="hs-comment">-- later servers; pre-7.4 servers support only protocol 2.0. (Protocol</span><span>
</span><a name="line-644"></a><span class="hs-comment">-- 1.0 is obsolete and not supported by libpq.)</span><span>
</span><a name="line-645"></a><span class="hs-identifier">protocolVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-646"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-647"></a><span class="hs-identifier">protocolVersion</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-648"></a><span>    </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQprotocolVersion</span><span>
</span><a name="line-649"></a><span>
</span><a name="line-650"></a><span>
</span><a name="line-651"></a><span class="hs-comment">-- | Returns an integer representing the backend version.</span><span>
</span><a name="line-652"></a><span class="hs-comment">--</span><span>
</span><a name="line-653"></a><span class="hs-comment">-- Applications might use this to determine the version of the</span><span>
</span><a name="line-654"></a><span class="hs-comment">-- database server they are connected to. The number is formed by</span><span>
</span><a name="line-655"></a><span class="hs-comment">-- converting the major, minor, and revision numbers into</span><span>
</span><a name="line-656"></a><span class="hs-comment">-- two-decimal-digit numbers and appending them together. For example,</span><span>
</span><a name="line-657"></a><span class="hs-comment">-- version 8.1.5 will be returned as 80105, and version 8.2 will be</span><span>
</span><a name="line-658"></a><span class="hs-comment">-- returned as 80200 (leading zeroes are not shown). Zero is returned</span><span>
</span><a name="line-659"></a><span class="hs-comment">-- if the connection is bad.</span><span>
</span><a name="line-660"></a><span class="hs-identifier">serverVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-661"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-662"></a><span class="hs-identifier">serverVersion</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-663"></a><span>    </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQserverVersion</span><span>
</span><a name="line-664"></a><span>
</span><a name="line-665"></a><span class="hs-comment">-- | Return the version of libpq that is being used.</span><span>
</span><a name="line-666"></a><span class="hs-comment">--</span><span>
</span><a name="line-667"></a><span class="hs-comment">-- The result of this function can be used to determine, at</span><span>
</span><a name="line-668"></a><span class="hs-comment">-- run time, if specific functionality is available in the currently</span><span>
</span><a name="line-669"></a><span class="hs-comment">-- loaded version of libpq. The function can be used, for example,</span><span>
</span><a name="line-670"></a><span class="hs-comment">-- to determine which connection options are available for</span><span>
</span><a name="line-671"></a><span class="hs-comment">-- PQconnectdb or if the hex bytea output added in PostgreSQL 9.0 is supported.</span><span>
</span><a name="line-672"></a><span class="hs-comment">--</span><span>
</span><a name="line-673"></a><span class="hs-comment">-- This function appeared in PostgreSQL version 9.1, so</span><span>
</span><a name="line-674"></a><span class="hs-comment">-- it cannot be used to detect required functionality in earlier</span><span>
</span><a name="line-675"></a><span class="hs-comment">-- versions, since linking to it will create a link dependency on version 9.1.</span><span>
</span><a name="line-676"></a><span class="hs-identifier">libpqVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-677"></a><span class="hs-identifier">libpqVersion</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-678"></a><span>
</span><a name="line-679"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">658</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-680"></a><span>  </span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">try</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">dlsym</span><span> </span><span class="hs-identifier">Default</span><span> </span><span class="hs-string">&quot;PQlibVersion&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Either</span><span> </span><span class="hs-identifier">IOException</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-681"></a><span>
</span><a name="line-682"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">663</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-683"></a><span>  </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-684"></a><span>    </span><span class="hs-identifier">Left</span><span> </span><span class="hs-identifier">_</span><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;libpqVersion is not supported for libpq &lt; 9.1&quot;</span><span>
</span><a name="line-685"></a><span>    </span><span class="hs-identifier">Right</span><span> </span><span class="hs-identifier">funPtr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">mkLibpqVersion</span><span> </span><span class="hs-identifier">funPtr</span><span>
</span><a name="line-686"></a><span>
</span><a name="line-687"></a><span class="hs-comment">-- | Returns the error message most recently generated by an operation</span><span>
</span><a name="line-688"></a><span class="hs-comment">-- on the connection.</span><span>
</span><a name="line-689"></a><span class="hs-comment">--</span><span>
</span><a name="line-690"></a><span class="hs-comment">-- Nearly all libpq functions will set a message for 'errorMessage' if</span><span>
</span><a name="line-691"></a><span class="hs-comment">-- they fail. Note that by libpq convention, a nonempty 'errorMessage'</span><span>
</span><a name="line-692"></a><span class="hs-comment">-- result can be multiple lines, and will include a trailing</span><span>
</span><a name="line-693"></a><span class="hs-comment">-- newline. The result string should not be expected to remain the</span><span>
</span><a name="line-694"></a><span class="hs-comment">-- same across operations on the 'Connection'.</span><span>
</span><a name="line-695"></a><span class="hs-identifier">errorMessage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-696"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-697"></a><span class="hs-identifier">errorMessage</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">statusString</span><span> </span><span class="hs-identifier">c_PQerrorMessage</span><span>
</span><a name="line-698"></a><span>
</span><a name="line-699"></a><span class="hs-comment">-- | Obtains the file descriptor number of the connection socket to</span><span>
</span><a name="line-700"></a><span class="hs-comment">-- the server. (This will not change during normal operation, but</span><span>
</span><a name="line-701"></a><span class="hs-comment">-- could change during connection setup or reset.)</span><span>
</span><a name="line-702"></a><span class="hs-identifier">socket</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-703"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Fd</span><span class="hs-special">)</span><span>
</span><a name="line-704"></a><span class="hs-identifier">socket</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-705"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">cFd</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQsocket</span><span>
</span><a name="line-706"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">cFd</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-707"></a><span>         </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-708"></a><span>         </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Fd</span><span> </span><span class="hs-identifier">cFd</span><span>
</span><a name="line-709"></a><span>
</span><a name="line-710"></a><span>
</span><a name="line-711"></a><span class="hs-comment">-- | Returns the process 'CPid' of the backend server process</span><span>
</span><a name="line-712"></a><span class="hs-comment">-- handling this connection.</span><span>
</span><a name="line-713"></a><span class="hs-comment">--</span><span>
</span><a name="line-714"></a><span class="hs-comment">-- The backend PID is useful for debugging purposes and for comparison</span><span>
</span><a name="line-715"></a><span class="hs-comment">-- to NOTIFY messages (which include the PID of the notifying backend</span><span>
</span><a name="line-716"></a><span class="hs-comment">-- process). Note that the PID belongs to a process executing on the</span><span>
</span><a name="line-717"></a><span class="hs-comment">-- database server host, not the local host!</span><span>
</span><a name="line-718"></a><span class="hs-identifier">backendPID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-719"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CPid</span><span>
</span><a name="line-720"></a><span class="hs-identifier">backendPID</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-721"></a><span>    </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQbackendPID</span><span>
</span><a name="line-722"></a><span>
</span><a name="line-723"></a><span>
</span><a name="line-724"></a><span class="hs-comment">-- | Returns 'True' if the connection authentication method required a</span><span>
</span><a name="line-725"></a><span class="hs-comment">-- password, but none was available. Returns 'False' if not.</span><span>
</span><a name="line-726"></a><span class="hs-comment">--</span><span>
</span><a name="line-727"></a><span class="hs-comment">-- This function can be applied after a failed connection attempt to</span><span>
</span><a name="line-728"></a><span class="hs-comment">-- decide whether to prompt the user for a password.</span><span>
</span><a name="line-729"></a><span class="hs-identifier">connectionNeedsPassword</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-730"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-731"></a><span class="hs-identifier">connectionNeedsPassword</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-732"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQconnectionNeedsPassword</span><span>
</span><a name="line-733"></a><span>
</span><a name="line-734"></a><span>
</span><a name="line-735"></a><span class="hs-comment">-- | Returns 'True' if the connection authentication method used a</span><span>
</span><a name="line-736"></a><span class="hs-comment">-- password. Returns 'False' if not.</span><span>
</span><a name="line-737"></a><span class="hs-comment">--</span><span>
</span><a name="line-738"></a><span class="hs-comment">-- This function can be applied after either a failed or successful</span><span>
</span><a name="line-739"></a><span class="hs-comment">-- connection attempt to detect whether the server demanded a</span><span>
</span><a name="line-740"></a><span class="hs-comment">-- password.</span><span>
</span><a name="line-741"></a><span class="hs-identifier">connectionUsedPassword</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-742"></a><span>                       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-743"></a><span class="hs-identifier">connectionUsedPassword</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-744"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQconnectionUsedPassword</span><span>
</span><a name="line-745"></a><span>
</span><a name="line-746"></a><span>
</span><a name="line-747"></a><span class="hs-comment">-- TODO: getSSL :: Connection -&gt; IO SSL</span><span>
</span><a name="line-748"></a><span>
</span><a name="line-749"></a><span>
</span><a name="line-750"></a><span class="hs-comment">-- $commandexec</span><span>
</span><a name="line-751"></a><span class="hs-comment">-- Once a connection to a database server has been successfully</span><span>
</span><a name="line-752"></a><span class="hs-comment">-- established, the functions described here are used to perform SQL</span><span>
</span><a name="line-753"></a><span class="hs-comment">-- queries and commands.</span><span>
</span><a name="line-754"></a><span>
</span><a name="line-755"></a><span class="hs-comment">-- | 'Result' encapsulates the result of a query (or more precisely,</span><span>
</span><a name="line-756"></a><span class="hs-comment">-- of a single SQL command --- a query string given to 'sendQuery' can</span><span>
</span><a name="line-757"></a><span class="hs-comment">-- contain multiple commands and thus return multiple instances of</span><span>
</span><a name="line-758"></a><span class="hs-comment">-- 'Result'.</span><span>
</span><a name="line-759"></a><span class="hs-keyword">newtype</span><span> </span><span class="hs-identifier">Result</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForeignPtr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-760"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">PGresult</span><span>
</span><a name="line-761"></a><span>
</span><a name="line-762"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Format</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Text</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">Binary</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Enum</span><span class="hs-special">)</span><span>
</span><a name="line-763"></a><span>
</span><a name="line-764"></a><span class="hs-keyword">newtype</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-identifier">CUInt</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Read</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Storable</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Typeable</span><span class="hs-special">)</span><span>
</span><a name="line-765"></a><span>
</span><a name="line-766"></a><span class="hs-identifier">invalidOid</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-767"></a><span class="hs-identifier">invalidOid</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-768"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">748</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-769"></a><span>
</span><a name="line-770"></a><span class="hs-comment">-- | Submits a command to the server and waits for the result.</span><span>
</span><a name="line-771"></a><span class="hs-comment">--</span><span>
</span><a name="line-772"></a><span class="hs-comment">-- Returns a 'Result' or possibly 'Nothing'. A 'Result' will generally</span><span>
</span><a name="line-773"></a><span class="hs-comment">-- be returned except in out-of-memory conditions or serious errors</span><span>
</span><a name="line-774"></a><span class="hs-comment">-- such as inability to send the command to the server. If a 'Nothing'</span><span>
</span><a name="line-775"></a><span class="hs-comment">-- is returned, it should be treated like a 'FatalError' result. Use</span><span>
</span><a name="line-776"></a><span class="hs-comment">-- 'errorMessage' to get more information about such errors.</span><span>
</span><a name="line-777"></a><span class="hs-comment">--</span><span>
</span><a name="line-778"></a><span class="hs-comment">-- It is allowed to include multiple SQL commands (separated by</span><span>
</span><a name="line-779"></a><span class="hs-comment">-- semicolons) in the command string. Multiple queries sent in a</span><span>
</span><a name="line-780"></a><span class="hs-comment">-- single 'exec' call are processed in a single transaction, unless</span><span>
</span><a name="line-781"></a><span class="hs-comment">-- there are explicit BEGIN/COMMIT commands included in the query</span><span>
</span><a name="line-782"></a><span class="hs-comment">-- string to divide it into multiple transactions. Note however that</span><span>
</span><a name="line-783"></a><span class="hs-comment">-- the returned 'Result' structure describes only the result of the</span><span>
</span><a name="line-784"></a><span class="hs-comment">-- last command executed from the string. Should one of the commands</span><span>
</span><a name="line-785"></a><span class="hs-comment">-- fail, processing of the string stops with it and the returned</span><span>
</span><a name="line-786"></a><span class="hs-comment">-- 'Result' describes the error condition.</span><span>
</span><a name="line-787"></a><span class="hs-identifier">exec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>        </span><span class="hs-comment">-- ^ connection</span><span>
</span><a name="line-788"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>      </span><span class="hs-comment">-- ^ statement</span><span>
</span><a name="line-789"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ result</span><span>
</span><a name="line-790"></a><span class="hs-identifier">exec</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-791"></a><span>    </span><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-792"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">c_PQexec</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-793"></a><span>
</span><a name="line-794"></a><span>
</span><a name="line-795"></a><span class="hs-comment">-- | Submits a command to the server and waits for the result, with</span><span>
</span><a name="line-796"></a><span class="hs-comment">-- the ability to pass parameters separately from the SQL command</span><span>
</span><a name="line-797"></a><span class="hs-comment">-- text.</span><span>
</span><a name="line-798"></a><span class="hs-comment">--</span><span>
</span><a name="line-799"></a><span class="hs-comment">-- 'execParams' is like 'exec', but offers additional functionality:</span><span>
</span><a name="line-800"></a><span class="hs-comment">-- parameter values can be specified separately from the command</span><span>
</span><a name="line-801"></a><span class="hs-comment">-- string proper, and query results can be requested in either text or</span><span>
</span><a name="line-802"></a><span class="hs-comment">-- binary format. 'execParams' is supported only in protocol 3.0 and</span><span>
</span><a name="line-803"></a><span class="hs-comment">-- later connections; it will fail when using protocol 2.0.</span><span>
</span><a name="line-804"></a><span class="hs-comment">--</span><span>
</span><a name="line-805"></a><span class="hs-comment">-- The primary advantage of 'execParams' over 'exec' is that parameter</span><span>
</span><a name="line-806"></a><span class="hs-comment">-- values can be separated from the command string, thus avoiding the</span><span>
</span><a name="line-807"></a><span class="hs-comment">-- need for tedious and error-prone quoting and escaping.</span><span>
</span><a name="line-808"></a><span class="hs-comment">--</span><span>
</span><a name="line-809"></a><span class="hs-comment">-- Unlike 'exec', 'execParams' allows at most one SQL command in the</span><span>
</span><a name="line-810"></a><span class="hs-comment">-- given string. (There can be semicolons in it, but not more than one</span><span>
</span><a name="line-811"></a><span class="hs-comment">-- nonempty command.) This is a limitation of the underlying protocol,</span><span>
</span><a name="line-812"></a><span class="hs-comment">-- but has some usefulness as an extra defense against SQL-injection</span><span>
</span><a name="line-813"></a><span class="hs-comment">-- attacks.</span><span>
</span><a name="line-814"></a><span class="hs-comment">--</span><span>
</span><a name="line-815"></a><span class="hs-comment">-- Tip: Specifying parameter types via OIDs is tedious, particularly</span><span>
</span><a name="line-816"></a><span class="hs-comment">-- if you prefer not to hard-wire particular OID values into your</span><span>
</span><a name="line-817"></a><span class="hs-comment">-- program. However, you can avoid doing so even in cases where the</span><span>
</span><a name="line-818"></a><span class="hs-comment">-- server by itself cannot determine the type of the parameter, or</span><span>
</span><a name="line-819"></a><span class="hs-comment">-- chooses a different type than you want. In the SQL command text,</span><span>
</span><a name="line-820"></a><span class="hs-comment">-- attach an explicit cast to the parameter symbol to show what data</span><span>
</span><a name="line-821"></a><span class="hs-comment">-- type you will send. For example:</span><span>
</span><a name="line-822"></a><span class="hs-comment">-- SELECT * FROM mytable WHERE x = $1::bigint;</span><span>
</span><a name="line-823"></a><span class="hs-comment">-- This forces parameter $1 to be treated as bigint, whereas by</span><span>
</span><a name="line-824"></a><span class="hs-comment">-- default it would be assigned the same type as x. Forcing the</span><span>
</span><a name="line-825"></a><span class="hs-comment">-- parameter type decision, either this way or by specifying a numeric</span><span>
</span><a name="line-826"></a><span class="hs-comment">-- type OID, is strongly recommended when sending parameter values in</span><span>
</span><a name="line-827"></a><span class="hs-comment">-- binary format, because binary format has less redundancy than text</span><span>
</span><a name="line-828"></a><span class="hs-comment">-- format and so there is less chance that the server will detect a</span><span>
</span><a name="line-829"></a><span class="hs-comment">-- type mismatch mistake for you.</span><span>
</span><a name="line-830"></a><span class="hs-identifier">execParams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>                          </span><span class="hs-comment">-- ^ connection</span><span>
</span><a name="line-831"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>                        </span><span class="hs-comment">-- ^ statement</span><span>
</span><a name="line-832"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Oid</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Format</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ parameters</span><span>
</span><a name="line-833"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Format</span><span>                              </span><span class="hs-comment">-- ^ result format</span><span>
</span><a name="line-834"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span>                   </span><span class="hs-comment">-- ^ result</span><span>
</span><a name="line-835"></a><span class="hs-identifier">execParams</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">statement</span><span> </span><span class="hs-identifier">params</span><span> </span><span class="hs-identifier">rFmt</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-836"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">oids</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">values</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lengths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">formats</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-837"></a><span>               </span><span class="hs-identifier">foldl'</span><span> </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">reverse</span><span> </span><span class="hs-identifier">params</span><span>
</span><a name="line-838"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">lengths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">CInt</span><span class="hs-special">]</span><span>
</span><a name="line-839"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">params</span><span>
</span><a name="line-840"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">rFmt</span><span>
</span><a name="line-841"></a><span>       </span><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-842"></a><span>           </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">statement</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-843"></a><span>               </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">oids</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ts</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-844"></a><span>                   </span><span class="hs-identifier">withMany</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maybeWith</span><span> </span><span class="hs-identifier">B.useAsCString</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c_values</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-845"></a><span>                       </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">vs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-846"></a><span>                           </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ls</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-847"></a><span>                               </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">formats</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">fs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-848"></a><span>                                   </span><span class="hs-identifier">c_PQexecParams</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">ts</span><span> </span><span class="hs-identifier">vs</span><span> </span><span class="hs-identifier">ls</span><span> </span><span class="hs-identifier">fs</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-849"></a><span>
</span><a name="line-850"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-851"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">d</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">invalidOid</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-852"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-853"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-854"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">d</span><span>
</span><a name="line-855"></a><span>                                    </span><span class="hs-special">)</span><span>
</span><a name="line-856"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">d</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">t</span><span class="hs-special">,</span><span class="hs-identifier">v</span><span class="hs-special">,</span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">t</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-857"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-858"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.length</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-859"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">d</span><span>
</span><a name="line-860"></a><span>                                           </span><span class="hs-special">)</span><span>
</span><a name="line-861"></a><span>
</span><a name="line-862"></a><span>
</span><a name="line-863"></a><span class="hs-comment">-- | Submits a request to create a prepared statement with the given</span><span>
</span><a name="line-864"></a><span class="hs-comment">-- parameters, and waits for completion.</span><span>
</span><a name="line-865"></a><span class="hs-comment">--</span><span>
</span><a name="line-866"></a><span class="hs-comment">-- 'prepare' creates a prepared statement for later execution with</span><span>
</span><a name="line-867"></a><span class="hs-comment">-- 'execPrepared'. This feature allows commands that will be used</span><span>
</span><a name="line-868"></a><span class="hs-comment">-- repeatedly to be parsed and planned just once, rather than each</span><span>
</span><a name="line-869"></a><span class="hs-comment">-- time they are executed. 'prepare' is supported only in protocol 3.0</span><span>
</span><a name="line-870"></a><span class="hs-comment">-- and later connections; it will fail when using protocol 2.0.</span><span>
</span><a name="line-871"></a><span class="hs-comment">--</span><span>
</span><a name="line-872"></a><span class="hs-comment">-- The function creates a prepared statement named stmtName from the</span><span>
</span><a name="line-873"></a><span class="hs-comment">-- query string, which must contain a single SQL command. stmtName can</span><span>
</span><a name="line-874"></a><span class="hs-comment">-- be \&quot;\&quot; to create an unnamed statement, in which case any</span><span>
</span><a name="line-875"></a><span class="hs-comment">-- pre-existing unnamed statement is automatically replaced; otherwise</span><span>
</span><a name="line-876"></a><span class="hs-comment">-- it is an error if the statement name is already defined in the</span><span>
</span><a name="line-877"></a><span class="hs-comment">-- current session. If any parameters are used, they are referred to</span><span>
</span><a name="line-878"></a><span class="hs-comment">-- in the query as $1, $2, etc. paramTypes specifies, by 'Oid', the</span><span>
</span><a name="line-879"></a><span class="hs-comment">-- data types to be assigned to the parameter symbols. If paramTypes</span><span>
</span><a name="line-880"></a><span class="hs-comment">-- is 'Nothing', or any particular element in the array is zero, the</span><span>
</span><a name="line-881"></a><span class="hs-comment">-- server assigns a data type to the parameter symbol in the same way</span><span>
</span><a name="line-882"></a><span class="hs-comment">-- it would do for an untyped literal string. Also, the query can use</span><span>
</span><a name="line-883"></a><span class="hs-comment">-- parameter symbols with numbers higher than the length of</span><span>
</span><a name="line-884"></a><span class="hs-comment">-- paramTypes; data types will be inferred for these symbols as</span><span>
</span><a name="line-885"></a><span class="hs-comment">-- well. (See 'describePrepared' for a means to find out what data</span><span>
</span><a name="line-886"></a><span class="hs-comment">-- types were inferred.)</span><span>
</span><a name="line-887"></a><span class="hs-comment">--</span><span>
</span><a name="line-888"></a><span class="hs-comment">-- As with 'exec', the result is normally a 'Result' whose contents</span><span>
</span><a name="line-889"></a><span class="hs-comment">-- indicate server-side success or failure. A 'Nothing' result</span><span>
</span><a name="line-890"></a><span class="hs-comment">-- indicates out-of-memory or inability to send the command at</span><span>
</span><a name="line-891"></a><span class="hs-comment">-- all. Use 'errorMessage' to get more information about such errors.</span><span>
</span><a name="line-892"></a><span class="hs-comment">--</span><span>
</span><a name="line-893"></a><span class="hs-comment">-- Prepared statements for use with 'execPrepared' can also be created</span><span>
</span><a name="line-894"></a><span class="hs-comment">-- by executing SQL PREPARE statements. (But 'prepare' is more</span><span>
</span><a name="line-895"></a><span class="hs-comment">-- flexible since it does not require parameter types to be</span><span>
</span><a name="line-896"></a><span class="hs-comment">-- pre-specified.) Also, although there is no libpq function for</span><span>
</span><a name="line-897"></a><span class="hs-comment">-- deleting a prepared statement, the SQL DEALLOCATE statement can be</span><span>
</span><a name="line-898"></a><span class="hs-comment">-- used for that purpose.</span><span>
</span><a name="line-899"></a><span class="hs-identifier">prepare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>        </span><span class="hs-comment">-- ^ connection</span><span>
</span><a name="line-900"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>      </span><span class="hs-comment">-- ^ stmtName</span><span>
</span><a name="line-901"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>      </span><span class="hs-comment">-- ^ query</span><span>
</span><a name="line-902"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Oid</span><span class="hs-special">]</span><span>       </span><span class="hs-comment">-- ^ paramTypes</span><span>
</span><a name="line-903"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- ^ result</span><span>
</span><a name="line-904"></a><span class="hs-identifier">prepare</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-identifier">mParamTypes</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-905"></a><span>    </span><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-906"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-907"></a><span>            </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-908"></a><span>                </span><span class="hs-identifier">maybeWith</span><span> </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">mParamTypes</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">o</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-909"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">maybe</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">length</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">mParamTypes</span><span>
</span><a name="line-910"></a><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">c_PQprepare</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">o</span><span>
</span><a name="line-911"></a><span>
</span><a name="line-912"></a><span>
</span><a name="line-913"></a><span class="hs-comment">-- | Sends a request to execute a prepared statement with given</span><span>
</span><a name="line-914"></a><span class="hs-comment">-- parameters, and waits for the result.</span><span>
</span><a name="line-915"></a><span class="hs-comment">--</span><span>
</span><a name="line-916"></a><span class="hs-comment">-- 'execPrepared' is like 'execParams', but the command to be executed</span><span>
</span><a name="line-917"></a><span class="hs-comment">-- is specified by naming a previously-prepared statement, instead of</span><span>
</span><a name="line-918"></a><span class="hs-comment">-- giving a query string. This feature allows commands that will be</span><span>
</span><a name="line-919"></a><span class="hs-comment">-- used repeatedly to be parsed and planned just once, rather than</span><span>
</span><a name="line-920"></a><span class="hs-comment">-- each time they are executed. The statement must have been prepared</span><span>
</span><a name="line-921"></a><span class="hs-comment">-- previously in the current session. 'execPrepared' is supported only</span><span>
</span><a name="line-922"></a><span class="hs-comment">-- in protocol 3.0 and later connections; it will fail when using</span><span>
</span><a name="line-923"></a><span class="hs-comment">-- protocol 2.0.</span><span>
</span><a name="line-924"></a><span class="hs-comment">--</span><span>
</span><a name="line-925"></a><span class="hs-comment">-- The parameters are identical to 'execParams', except that the name</span><span>
</span><a name="line-926"></a><span class="hs-comment">-- of a prepared statement is given instead of a query string, and the</span><span>
</span><a name="line-927"></a><span class="hs-comment">-- paramTypes parameter is not present (it is not needed since the</span><span>
</span><a name="line-928"></a><span class="hs-comment">-- prepared statement's parameter types were determined when it was</span><span>
</span><a name="line-929"></a><span class="hs-comment">-- created).</span><span>
</span><a name="line-930"></a><span class="hs-identifier">execPrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>                     </span><span class="hs-comment">-- ^ connection</span><span>
</span><a name="line-931"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>                   </span><span class="hs-comment">-- ^ stmtName</span><span>
</span><a name="line-932"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Format</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ parameters</span><span>
</span><a name="line-933"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Format</span><span>                         </span><span class="hs-comment">-- ^ result format</span><span>
</span><a name="line-934"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span>              </span><span class="hs-comment">-- ^ result</span><span>
</span><a name="line-935"></a><span class="hs-identifier">execPrepared</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-identifier">mPairs</span><span> </span><span class="hs-identifier">rFmt</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-936"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">values</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lengths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">formats</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldl'</span><span> </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">reverse</span><span> </span><span class="hs-identifier">mPairs</span><span>
</span><a name="line-937"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">lengths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">CInt</span><span class="hs-special">]</span><span>
</span><a name="line-938"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">mPairs</span><span>
</span><a name="line-939"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">rFmt</span><span>
</span><a name="line-940"></a><span>       </span><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-941"></a><span>           </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-942"></a><span>               </span><span class="hs-identifier">withMany</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maybeWith</span><span> </span><span class="hs-identifier">B.useAsCString</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c_values</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-943"></a><span>                   </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">vs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-944"></a><span>                       </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ls</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-945"></a><span>                           </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">formats</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">fs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-946"></a><span>                               </span><span class="hs-identifier">c_PQexecPrepared</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">vs</span><span> </span><span class="hs-identifier">ls</span><span> </span><span class="hs-identifier">fs</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-947"></a><span>
</span><a name="line-948"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-949"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Nothing</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-950"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-951"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-952"></a><span>                                       </span><span class="hs-special">)</span><span>
</span><a name="line-953"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">v</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-954"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.length</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-955"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-956"></a><span>                                       </span><span class="hs-special">)</span><span>
</span><a name="line-957"></a><span>
</span><a name="line-958"></a><span>
</span><a name="line-959"></a><span class="hs-comment">-- | Submits a request to obtain information about the specified</span><span>
</span><a name="line-960"></a><span class="hs-comment">-- prepared statement, and waits for completion.</span><span>
</span><a name="line-961"></a><span class="hs-comment">--</span><span>
</span><a name="line-962"></a><span class="hs-comment">-- 'describePrepared' allows an application to obtain information</span><span>
</span><a name="line-963"></a><span class="hs-comment">-- about a previously prepared statement. 'describePrepared' is</span><span>
</span><a name="line-964"></a><span class="hs-comment">-- supported only in protocol 3.0 and later connections; it will fail</span><span>
</span><a name="line-965"></a><span class="hs-comment">-- when using protocol 2.0.</span><span>
</span><a name="line-966"></a><span class="hs-comment">--</span><span>
</span><a name="line-967"></a><span class="hs-comment">-- stmtName can be empty to reference the unnamed statement, otherwise</span><span>
</span><a name="line-968"></a><span class="hs-comment">-- it must be the name of an existing prepared statement. On success,</span><span>
</span><a name="line-969"></a><span class="hs-comment">-- a 'Result' with status 'CommandOk' is returned. The functions</span><span>
</span><a name="line-970"></a><span class="hs-comment">-- 'nparams' and 'paramtype' can be applied to this 'Result' to obtain</span><span>
</span><a name="line-971"></a><span class="hs-comment">-- information about the parameters of the prepared statement, and the</span><span>
</span><a name="line-972"></a><span class="hs-comment">-- functions 'nfields', 'fname', 'ftype', etc provide information</span><span>
</span><a name="line-973"></a><span class="hs-comment">-- about the result columns (if any) of the statement.</span><span>
</span><a name="line-974"></a><span class="hs-identifier">describePrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-975"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ stmtName</span><span>
</span><a name="line-976"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span>
</span><a name="line-977"></a><span class="hs-identifier">describePrepared</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-978"></a><span>    </span><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-979"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQdescribePrepared</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-980"></a><span>
</span><a name="line-981"></a><span>
</span><a name="line-982"></a><span class="hs-comment">-- | Submits a request to obtain information about the specified</span><span>
</span><a name="line-983"></a><span class="hs-comment">-- portal, and waits for completion.</span><span>
</span><a name="line-984"></a><span class="hs-comment">--</span><span>
</span><a name="line-985"></a><span class="hs-comment">-- 'describePortal' allows an application to obtain information about</span><span>
</span><a name="line-986"></a><span class="hs-comment">-- a previously created portal. (libpq does not provide any direct</span><span>
</span><a name="line-987"></a><span class="hs-comment">-- access to portals, but you can use this function to inspect the</span><span>
</span><a name="line-988"></a><span class="hs-comment">-- properties of a cursor created with a DECLARE CURSOR SQL command.)</span><span>
</span><a name="line-989"></a><span class="hs-comment">-- 'describePortal' is supported only in protocol 3.0 and later</span><span>
</span><a name="line-990"></a><span class="hs-comment">-- connections; it will fail when using protocol 2.0.</span><span>
</span><a name="line-991"></a><span class="hs-comment">--</span><span>
</span><a name="line-992"></a><span class="hs-comment">-- portalName can be empty to reference the unnamed portal, otherwise</span><span>
</span><a name="line-993"></a><span class="hs-comment">-- it must be the name of an existing portal. On success, a 'Result'</span><span>
</span><a name="line-994"></a><span class="hs-comment">-- with status 'CommandOk' is returned. The functions 'nfields',</span><span>
</span><a name="line-995"></a><span class="hs-comment">-- 'fname', 'ftype', etc can be applied to the 'Result' to obtain</span><span>
</span><a name="line-996"></a><span class="hs-comment">-- information about the result columns (if any) of the portal.</span><span>
</span><a name="line-997"></a><span class="hs-identifier">describePortal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-998"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ portalName</span><span>
</span><a name="line-999"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span>
</span><a name="line-1000"></a><span class="hs-identifier">describePortal</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">portalName</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1001"></a><span>    </span><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1002"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">portalName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1003"></a><span>            </span><span class="hs-identifier">c_PQdescribePortal</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1004"></a><span>
</span><a name="line-1005"></a><span>
</span><a name="line-1006"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">ExecStatus</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">EmptyQuery</span><span>    </span><span class="hs-comment">-- ^ The string sent to the server was empty.</span><span>
</span><a name="line-1007"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CommandOk</span><span>     </span><span class="hs-comment">-- ^ Successful completion of a</span><span>
</span><a name="line-1008"></a><span>                                </span><span class="hs-comment">-- command returning no data.</span><span>
</span><a name="line-1009"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">TuplesOk</span><span>      </span><span class="hs-comment">-- ^ Successful completion of a</span><span>
</span><a name="line-1010"></a><span>                                </span><span class="hs-comment">-- command returning data (such as a</span><span>
</span><a name="line-1011"></a><span>                                </span><span class="hs-comment">-- SELECT or SHOW).</span><span>
</span><a name="line-1012"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyOut</span><span>       </span><span class="hs-comment">-- ^ Copy Out (from server) data</span><span>
</span><a name="line-1013"></a><span>                                </span><span class="hs-comment">-- transfer started.</span><span>
</span><a name="line-1014"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyIn</span><span>        </span><span class="hs-comment">-- ^ Copy In (to server) data transfer</span><span>
</span><a name="line-1015"></a><span>                                </span><span class="hs-comment">-- started.</span><span>
</span><a name="line-1016"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyBoth</span><span>      </span><span class="hs-comment">-- ^ Copy In/Out data transfer started.</span><span>
</span><a name="line-1017"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">BadResponse</span><span>   </span><span class="hs-comment">-- ^ The server's response was not understood.</span><span>
</span><a name="line-1018"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">NonfatalError</span><span> </span><span class="hs-comment">-- ^ A nonfatal error (a notice or</span><span>
</span><a name="line-1019"></a><span>                                </span><span class="hs-comment">-- warning) occurred.</span><span>
</span><a name="line-1020"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">FatalError</span><span>    </span><span class="hs-comment">-- ^ A fatal error occurred.</span><span>
</span><a name="line-1021"></a><span>                </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">SingleTuple</span><span>   </span><span class="hs-comment">-- ^ The PGresult contains a single result tuple</span><span>
</span><a name="line-1022"></a><span>                                </span><span class="hs-comment">-- from the current command. This status occurs</span><span>
</span><a name="line-1023"></a><span>                                </span><span class="hs-comment">-- only when single-row mode has been selected</span><span>
</span><a name="line-1024"></a><span>                                </span><span class="hs-comment">-- for the query.</span><span>
</span><a name="line-1025"></a><span>                  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-1026"></a><span>
</span><a name="line-1027"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-identifier">ExecStatus</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1028"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">EmptyQuery</span><span>
</span><a name="line-1029"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1008</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1030"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CommandOk</span><span>
</span><a name="line-1031"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1009</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1032"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">TuplesOk</span><span>
</span><a name="line-1033"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1010</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1034"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CopyOut</span><span>
</span><a name="line-1035"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1011</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1036"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">4</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CopyIn</span><span>
</span><a name="line-1037"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1012</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1038"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">8</span><span class="hs-special">)</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CopyBoth</span><span>
</span><a name="line-1039"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1013</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1040"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">5</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">BadResponse</span><span>
</span><a name="line-1041"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1014</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1042"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">6</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NonfatalError</span><span>
</span><a name="line-1043"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1015</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1044"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">7</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">FatalError</span><span>
</span><a name="line-1045"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1016</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1046"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">9</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">SingleTuple</span><span>
</span><a name="line-1047"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1017</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1048"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;Database.PQ.Enum.ExecStatus.toEnum: bad argument&quot;</span><span>
</span><a name="line-1049"></a><span>
</span><a name="line-1050"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">EmptyQuery</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-1051"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1020</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1052"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">CommandOk</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1053"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1021</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1054"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">TuplesOk</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-1055"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1022</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1056"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">CopyOut</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">3</span><span class="hs-special">)</span><span>
</span><a name="line-1057"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1023</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1058"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">CopyIn</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">4</span><span class="hs-special">)</span><span>
</span><a name="line-1059"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1024</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1060"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">CopyBoth</span><span>      </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">8</span><span class="hs-special">)</span><span>
</span><a name="line-1061"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1025</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1062"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">BadResponse</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">5</span><span class="hs-special">)</span><span>
</span><a name="line-1063"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1026</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1064"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">NonfatalError</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">6</span><span class="hs-special">)</span><span>
</span><a name="line-1065"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1027</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1066"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">FatalError</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">7</span><span class="hs-special">)</span><span>
</span><a name="line-1067"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1028</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1068"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">SingleTuple</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">9</span><span class="hs-special">)</span><span>
</span><a name="line-1069"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1029</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1070"></a><span>
</span><a name="line-1071"></a><span class="hs-comment">-- | Returns the result status of the command.</span><span>
</span><a name="line-1072"></a><span class="hs-identifier">resultStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1073"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">ExecStatus</span><span>
</span><a name="line-1074"></a><span class="hs-identifier">resultStatus</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">enumFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-identifier">c_PQresultStatus</span><span>
</span><a name="line-1075"></a><span>
</span><a name="line-1076"></a><span>
</span><a name="line-1077"></a><span class="hs-comment">-- | Converts the 'ExecStatus' returned by 'resultStatus' into a</span><span>
</span><a name="line-1078"></a><span class="hs-comment">-- string describing the status code. The caller should not</span><span>
</span><a name="line-1079"></a><span class="hs-comment">-- free the result.</span><span>
</span><a name="line-1080"></a><span class="hs-identifier">resStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">ExecStatus</span><span>
</span><a name="line-1081"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1082"></a><span class="hs-identifier">resStatus</span><span> </span><span class="hs-identifier">es</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1083"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQresStatus</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">es</span><span>
</span><a name="line-1084"></a><span>       </span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.c_strlen</span><span> </span><span class="hs-identifier">cstr</span><span>
</span><a name="line-1085"></a><span>       </span><span class="hs-identifier">fp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">cstr</span><span>
</span><a name="line-1086"></a><span>       </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span>
</span><a name="line-1087"></a><span>
</span><a name="line-1088"></a><span>
</span><a name="line-1089"></a><span class="hs-comment">-- | Returns the error message most recently generated by an operation</span><span>
</span><a name="line-1090"></a><span class="hs-comment">-- on the connection.</span><span>
</span><a name="line-1091"></a><span class="hs-identifier">resultErrorMessage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1092"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1093"></a><span class="hs-identifier">resultErrorMessage</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">flip</span><span> </span><span class="hs-identifier">maybeBsFromResult</span><span> </span><span class="hs-identifier">c_PQresultErrorMessage</span><span>
</span><a name="line-1094"></a><span>
</span><a name="line-1095"></a><span class="hs-comment">-- | Frees the memory associated with a result.  Note that using this</span><span>
</span><a name="line-1096"></a><span class="hs-comment">-- function correctly is especially tricky;  you need to ensure that</span><span>
</span><a name="line-1097"></a><span class="hs-comment">-- no references to the result.   This means no references to a value</span><span>
</span><a name="line-1098"></a><span class="hs-comment">-- returned by 'getvalue',  no references hiding inside an unevaluated</span><span>
</span><a name="line-1099"></a><span class="hs-comment">-- thunk,  etc.    Improper use of this function is likely to cause a</span><span>
</span><a name="line-1100"></a><span class="hs-comment">-- segfault.   Also,  the use of this function is not strictly necessary;</span><span>
</span><a name="line-1101"></a><span class="hs-comment">-- the memory will get freed by the garbage collector when there are no</span><span>
</span><a name="line-1102"></a><span class="hs-comment">-- more references to the result.</span><span>
</span><a name="line-1103"></a><span>
</span><a name="line-1104"></a><span class="hs-identifier">unsafeFreeResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1105"></a><span class="hs-identifier">unsafeFreeResult</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Result</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">finalizeForeignPtr</span><span> </span><span class="hs-identifier">x</span><span>
</span><a name="line-1106"></a><span>
</span><a name="line-1107"></a><span>
</span><a name="line-1108"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">FieldCode</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagSeverity</span><span>
</span><a name="line-1109"></a><span>               </span><span class="hs-comment">-- ^ The severity; the field contents are ERROR, FATAL,</span><span>
</span><a name="line-1110"></a><span>               </span><span class="hs-comment">-- or PANIC (in an error message), or WARNING, NOTICE,</span><span>
</span><a name="line-1111"></a><span>               </span><span class="hs-comment">-- DEBUG, INFO, or LOG (in a notice message), or a</span><span>
</span><a name="line-1112"></a><span>               </span><span class="hs-comment">-- localized translation of one of these. Always</span><span>
</span><a name="line-1113"></a><span>               </span><span class="hs-comment">-- present.</span><span>
</span><a name="line-1114"></a><span>
</span><a name="line-1115"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagSqlstate</span><span>
</span><a name="line-1116"></a><span>               </span><span class="hs-comment">-- ^ The SQLSTATE code for the error. The SQLSTATE code</span><span>
</span><a name="line-1117"></a><span>               </span><span class="hs-comment">-- identifies the type of error that has occurred; it</span><span>
</span><a name="line-1118"></a><span>               </span><span class="hs-comment">-- can be used by front-end applications to perform</span><span>
</span><a name="line-1119"></a><span>               </span><span class="hs-comment">-- specific operations (such as error handling) in</span><span>
</span><a name="line-1120"></a><span>               </span><span class="hs-comment">-- response to a particular database error. For a list</span><span>
</span><a name="line-1121"></a><span>               </span><span class="hs-comment">-- of the possible SQLSTATE codes, see Appendix A. This</span><span>
</span><a name="line-1122"></a><span>               </span><span class="hs-comment">-- field is not localizable, and is always present.</span><span>
</span><a name="line-1123"></a><span>
</span><a name="line-1124"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagMessagePrimary</span><span>
</span><a name="line-1125"></a><span>               </span><span class="hs-comment">-- ^ The primary human-readable error message</span><span>
</span><a name="line-1126"></a><span>               </span><span class="hs-comment">-- (typically one line). Always present.</span><span>
</span><a name="line-1127"></a><span>
</span><a name="line-1128"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagMessageDetail</span><span>
</span><a name="line-1129"></a><span>               </span><span class="hs-comment">-- ^ Detail: an optional secondary error message</span><span>
</span><a name="line-1130"></a><span>               </span><span class="hs-comment">-- carrying more detail about the problem. Might run to</span><span>
</span><a name="line-1131"></a><span>               </span><span class="hs-comment">-- multiple lines.</span><span>
</span><a name="line-1132"></a><span>
</span><a name="line-1133"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagMessageHint</span><span>
</span><a name="line-1134"></a><span>               </span><span class="hs-comment">-- ^ Hint: an optional suggestion what to do about the</span><span>
</span><a name="line-1135"></a><span>               </span><span class="hs-comment">-- problem. This is intended to differ from detail in</span><span>
</span><a name="line-1136"></a><span>               </span><span class="hs-comment">-- that it offers advice (potentially inappropriate)</span><span>
</span><a name="line-1137"></a><span>               </span><span class="hs-comment">-- rather than hard facts. Might run to multiple lines.</span><span>
</span><a name="line-1138"></a><span>
</span><a name="line-1139"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagStatementPosition</span><span>
</span><a name="line-1140"></a><span>               </span><span class="hs-comment">-- ^ A string containing a decimal integer indicating</span><span>
</span><a name="line-1141"></a><span>               </span><span class="hs-comment">-- an error cursor position as an index into the</span><span>
</span><a name="line-1142"></a><span>               </span><span class="hs-comment">-- original statement string. The first character has</span><span>
</span><a name="line-1143"></a><span>               </span><span class="hs-comment">-- index 1, and positions are measured in characters</span><span>
</span><a name="line-1144"></a><span>               </span><span class="hs-comment">-- not bytes.</span><span>
</span><a name="line-1145"></a><span>
</span><a name="line-1146"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagInternalPosition</span><span>
</span><a name="line-1147"></a><span>               </span><span class="hs-comment">-- ^ This is defined the same as the</span><span>
</span><a name="line-1148"></a><span>               </span><span class="hs-comment">-- 'DiagStatementPosition' field, but it is used when</span><span>
</span><a name="line-1149"></a><span>               </span><span class="hs-comment">-- the cursor position refers to an internally</span><span>
</span><a name="line-1150"></a><span>               </span><span class="hs-comment">-- generated command rather than the one submitted by</span><span>
</span><a name="line-1151"></a><span>               </span><span class="hs-comment">-- the client. The 'DiagInternalQuery' field will</span><span>
</span><a name="line-1152"></a><span>               </span><span class="hs-comment">-- always appear when this field appears.</span><span>
</span><a name="line-1153"></a><span>
</span><a name="line-1154"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagInternalQuery</span><span>
</span><a name="line-1155"></a><span>               </span><span class="hs-comment">-- ^ The text of a failed internally-generated</span><span>
</span><a name="line-1156"></a><span>               </span><span class="hs-comment">-- command. This could be, for example, a SQL query</span><span>
</span><a name="line-1157"></a><span>               </span><span class="hs-comment">-- issued by a PL/pgSQL function.</span><span>
</span><a name="line-1158"></a><span>
</span><a name="line-1159"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagContext</span><span>
</span><a name="line-1160"></a><span>               </span><span class="hs-comment">-- ^ An indication of the context in which the error</span><span>
</span><a name="line-1161"></a><span>               </span><span class="hs-comment">-- occurred. Presently this includes a call stack</span><span>
</span><a name="line-1162"></a><span>               </span><span class="hs-comment">-- traceback of active procedural language functions</span><span>
</span><a name="line-1163"></a><span>               </span><span class="hs-comment">-- and internally-generated queries. The trace is one</span><span>
</span><a name="line-1164"></a><span>               </span><span class="hs-comment">-- entry per line, most recent first.</span><span>
</span><a name="line-1165"></a><span>
</span><a name="line-1166"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagSourceFile</span><span>
</span><a name="line-1167"></a><span>               </span><span class="hs-comment">-- ^ The file name of the source-code location where</span><span>
</span><a name="line-1168"></a><span>               </span><span class="hs-comment">-- the error was reported.</span><span>
</span><a name="line-1169"></a><span>
</span><a name="line-1170"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagSourceLine</span><span>
</span><a name="line-1171"></a><span>               </span><span class="hs-comment">-- ^ The line number of the source-code location where</span><span>
</span><a name="line-1172"></a><span>               </span><span class="hs-comment">-- the error was reported.</span><span>
</span><a name="line-1173"></a><span>
</span><a name="line-1174"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">DiagSourceFunction</span><span>
</span><a name="line-1175"></a><span>               </span><span class="hs-comment">-- ^ The name of the source-code function reporting the</span><span>
</span><a name="line-1176"></a><span>               </span><span class="hs-comment">-- error.</span><span>
</span><a name="line-1177"></a><span>
</span><a name="line-1178"></a><span>                 </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-1179"></a><span>
</span><a name="line-1180"></a><span>
</span><a name="line-1181"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-identifier">FieldCode</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-1182"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">83</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagSeverity</span><span>
</span><a name="line-1183"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1142</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1184"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">67</span><span class="hs-special">)</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagSqlstate</span><span>
</span><a name="line-1185"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1143</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1186"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">77</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagMessagePrimary</span><span>
</span><a name="line-1187"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1144</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1188"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">68</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagMessageDetail</span><span>
</span><a name="line-1189"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1145</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1190"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">72</span><span class="hs-special">)</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagMessageHint</span><span>
</span><a name="line-1191"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1146</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1192"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">80</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagStatementPosition</span><span>
</span><a name="line-1193"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1147</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1194"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">112</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagInternalPosition</span><span>
</span><a name="line-1195"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1148</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1196"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">113</span><span class="hs-special">)</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagInternalQuery</span><span>
</span><a name="line-1197"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1149</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1198"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">87</span><span class="hs-special">)</span><span>            </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagContext</span><span>
</span><a name="line-1199"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1150</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1200"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">70</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagSourceFile</span><span>
</span><a name="line-1201"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1151</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1202"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">76</span><span class="hs-special">)</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagSourceLine</span><span>
</span><a name="line-1203"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1152</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1204"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">82</span><span class="hs-special">)</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">DiagSourceFunction</span><span>
</span><a name="line-1205"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1153</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1206"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;Database.PQ.Enum.FieldCode.toEnum: bad argument&quot;</span><span>
</span><a name="line-1207"></a><span>
</span><a name="line-1208"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagSeverity</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">83</span><span class="hs-special">)</span><span>
</span><a name="line-1209"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1156</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1210"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagSqlstate</span><span>          </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">67</span><span class="hs-special">)</span><span>
</span><a name="line-1211"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1157</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1212"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagMessagePrimary</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">77</span><span class="hs-special">)</span><span>
</span><a name="line-1213"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1158</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1214"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagMessageDetail</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">68</span><span class="hs-special">)</span><span>
</span><a name="line-1215"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1159</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1216"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagMessageHint</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">72</span><span class="hs-special">)</span><span>
</span><a name="line-1217"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1160</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1218"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagStatementPosition</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">80</span><span class="hs-special">)</span><span>
</span><a name="line-1219"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1161</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1220"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagInternalPosition</span><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">112</span><span class="hs-special">)</span><span>
</span><a name="line-1221"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1162</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1222"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagInternalQuery</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">113</span><span class="hs-special">)</span><span>
</span><a name="line-1223"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1163</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1224"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagContext</span><span>           </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">87</span><span class="hs-special">)</span><span>
</span><a name="line-1225"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1164</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1226"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagSourceFile</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">70</span><span class="hs-special">)</span><span>
</span><a name="line-1227"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1165</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1228"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagSourceLine</span><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">76</span><span class="hs-special">)</span><span>
</span><a name="line-1229"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1166</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1230"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">DiagSourceFunction</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">82</span><span class="hs-special">)</span><span>
</span><a name="line-1231"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1167</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-1232"></a><span>
</span><a name="line-1233"></a><span>
</span><a name="line-1234"></a><span class="hs-comment">-- | Returns an individual field of an error report.</span><span>
</span><a name="line-1235"></a><span class="hs-comment">--</span><span>
</span><a name="line-1236"></a><span class="hs-comment">-- fieldcode is an error field identifier; see the symbols listed</span><span>
</span><a name="line-1237"></a><span class="hs-comment">-- below. 'Nothing' is returned if the PGresult is not an error or</span><span>
</span><a name="line-1238"></a><span class="hs-comment">-- warning result, or does not include the specified field. Field</span><span>
</span><a name="line-1239"></a><span class="hs-comment">-- values will normally not include a trailing newline.</span><span>
</span><a name="line-1240"></a><span class="hs-comment">--</span><span>
</span><a name="line-1241"></a><span class="hs-comment">-- The client is responsible for formatting displayed information to</span><span>
</span><a name="line-1242"></a><span class="hs-comment">-- meet its needs; in particular it should break long lines as</span><span>
</span><a name="line-1243"></a><span class="hs-comment">-- needed. Newline characters appearing in the error message fields</span><span>
</span><a name="line-1244"></a><span class="hs-comment">-- should be treated as paragraph breaks, not line breaks.</span><span>
</span><a name="line-1245"></a><span class="hs-comment">--</span><span>
</span><a name="line-1246"></a><span class="hs-comment">-- Errors generated internally by libpq will have severity and primary</span><span>
</span><a name="line-1247"></a><span class="hs-comment">-- message, but typically no other fields. Errors returned by a</span><span>
</span><a name="line-1248"></a><span class="hs-comment">-- pre-3.0-protocol server will include severity and primary message,</span><span>
</span><a name="line-1249"></a><span class="hs-comment">-- and sometimes a detail message, but no other fields.</span><span>
</span><a name="line-1250"></a><span class="hs-comment">--</span><span>
</span><a name="line-1251"></a><span class="hs-comment">-- Note that error fields are only available from 'Result' objects,</span><span>
</span><a name="line-1252"></a><span class="hs-comment">-- not 'Connection' objects; there is no errorField function.</span><span>
</span><a name="line-1253"></a><span class="hs-identifier">resultErrorField</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1254"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FieldCode</span><span>
</span><a name="line-1255"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1256"></a><span class="hs-identifier">resultErrorField</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Result</span><span> </span><span class="hs-identifier">fp</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">fieldcode</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1257"></a><span>    </span><span class="hs-identifier">maybeBsFromForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1258"></a><span>        </span><span class="hs-identifier">c_PQresultErrorField</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">fieldcode</span><span>
</span><a name="line-1259"></a><span>
</span><a name="line-1260"></a><span>
</span><a name="line-1261"></a><span class="hs-comment">-- $queryresultinfo</span><span>
</span><a name="line-1262"></a><span class="hs-comment">-- These functions are used to extract information from a 'Result'</span><span>
</span><a name="line-1263"></a><span class="hs-comment">-- that represents a successful query result (that is, one that has</span><span>
</span><a name="line-1264"></a><span class="hs-comment">-- status 'TuplesOk'). They can also be used to extract information</span><span>
</span><a name="line-1265"></a><span class="hs-comment">-- from a successful Describe operation: a Describe's result has all</span><span>
</span><a name="line-1266"></a><span class="hs-comment">-- the same column information that actual execution of the query</span><span>
</span><a name="line-1267"></a><span class="hs-comment">-- would provide, but it has zero rows. For objects with other status</span><span>
</span><a name="line-1268"></a><span class="hs-comment">-- values, these functions will act as though the result has zero rows</span><span>
</span><a name="line-1269"></a><span class="hs-comment">-- and zero columns.</span><span>
</span><a name="line-1270"></a><span>
</span><a name="line-1271"></a><span class="hs-comment">-- | Returns the number of rows (tuples) in the query result. Because</span><span>
</span><a name="line-1272"></a><span class="hs-comment">-- it returns an integer result, large result sets might overflow the</span><span>
</span><a name="line-1273"></a><span class="hs-comment">-- return value on 32-bit operating systems.</span><span>
</span><a name="line-1274"></a><span class="hs-identifier">ntuples</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1275"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Row</span><span>
</span><a name="line-1276"></a><span class="hs-identifier">ntuples</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">toRow</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">c_PQntuples</span><span class="hs-special">)</span><span>
</span><a name="line-1277"></a><span>
</span><a name="line-1278"></a><span>
</span><a name="line-1279"></a><span class="hs-comment">-- | Returns the number of columns (fields) in each row of the query</span><span>
</span><a name="line-1280"></a><span class="hs-comment">-- result.</span><span>
</span><a name="line-1281"></a><span class="hs-identifier">nfields</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1282"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1283"></a><span class="hs-identifier">nfields</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">toColumn</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">c_PQnfields</span><span class="hs-special">)</span><span>
</span><a name="line-1284"></a><span>
</span><a name="line-1285"></a><span>
</span><a name="line-1286"></a><span class="hs-keyword">newtype</span><span> </span><span class="hs-identifier">Column</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">CInt</span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Num</span><span class="hs-special">)</span><span>
</span><a name="line-1287"></a><span class="hs-keyword">newtype</span><span> </span><span class="hs-identifier">Row</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Row</span><span> </span><span class="hs-identifier">CInt</span><span>  </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Enum</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Num</span><span class="hs-special">)</span><span>
</span><a name="line-1288"></a><span>
</span><a name="line-1289"></a><span class="hs-identifier">toColumn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integral</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1290"></a><span class="hs-identifier">toColumn</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Col</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">fromIntegral</span><span>
</span><a name="line-1291"></a><span>
</span><a name="line-1292"></a><span class="hs-identifier">toRow</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integral</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Row</span><span>
</span><a name="line-1293"></a><span class="hs-identifier">toRow</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Row</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">fromIntegral</span><span>
</span><a name="line-1294"></a><span>
</span><a name="line-1295"></a><span>
</span><a name="line-1296"></a><span class="hs-comment">-- | Returns the column name associated with the given 'Column'</span><span>
</span><a name="line-1297"></a><span class="hs-comment">-- number. Column numbers start at 0.</span><span>
</span><a name="line-1298"></a><span class="hs-identifier">fname</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1299"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1300"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1301"></a><span class="hs-identifier">fname</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1302"></a><span>    </span><span class="hs-identifier">maybeBsFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">fp</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1303"></a><span>        </span><span class="hs-identifier">c_PQfname</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1304"></a><span>
</span><a name="line-1305"></a><span>
</span><a name="line-1306"></a><span class="hs-comment">-- | Returns the column number associated with the given column name.</span><span>
</span><a name="line-1307"></a><span class="hs-identifier">fnumber</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1308"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1309"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Column</span><span class="hs-special">)</span><span>
</span><a name="line-1310"></a><span class="hs-identifier">fnumber</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-identifier">columnName</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1311"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">num</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">resPtr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1312"></a><span>              </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">columnName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">columnNamePtr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1313"></a><span>                  </span><span class="hs-identifier">c_PQfnumber</span><span> </span><span class="hs-identifier">resPtr</span><span> </span><span class="hs-identifier">columnNamePtr</span><span>
</span><a name="line-1314"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">num</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span>
</span><a name="line-1315"></a><span>         </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1316"></a><span>         </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">toColumn</span><span> </span><span class="hs-identifier">num</span><span>
</span><a name="line-1317"></a><span>
</span><a name="line-1318"></a><span>
</span><a name="line-1319"></a><span class="hs-comment">-- | Returns the OID of the table from which the given column was</span><span>
</span><a name="line-1320"></a><span class="hs-comment">-- fetched. Column numbers start at 0.</span><span>
</span><a name="line-1321"></a><span class="hs-identifier">ftable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1322"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1323"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-1324"></a><span class="hs-identifier">ftable</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQftable</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1325"></a><span>
</span><a name="line-1326"></a><span>
</span><a name="line-1327"></a><span class="hs-comment">-- | Returns the column number (within its table) of the column making</span><span>
</span><a name="line-1328"></a><span class="hs-comment">-- up the specified query result column. Query-result column numbers</span><span>
</span><a name="line-1329"></a><span class="hs-comment">-- start at 0, but table columns have nonzero numbers.</span><span>
</span><a name="line-1330"></a><span class="hs-identifier">ftablecol</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1331"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1332"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1333"></a><span class="hs-identifier">ftablecol</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1334"></a><span>    </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">Col</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQftablecol</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1335"></a><span>
</span><a name="line-1336"></a><span>
</span><a name="line-1337"></a><span class="hs-comment">-- | Returns the 'Format' of the given column. Column numbers start at</span><span>
</span><a name="line-1338"></a><span class="hs-comment">-- 0.</span><span>
</span><a name="line-1339"></a><span class="hs-identifier">fformat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1340"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1341"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Format</span><span>
</span><a name="line-1342"></a><span class="hs-identifier">fformat</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1343"></a><span>    </span><span class="hs-identifier">enumFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQfformat</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1344"></a><span>
</span><a name="line-1345"></a><span>
</span><a name="line-1346"></a><span class="hs-comment">-- | Returns the data type associated with the given column</span><span>
</span><a name="line-1347"></a><span class="hs-comment">-- number. The 'Oid' returned is the internal OID number of the</span><span>
</span><a name="line-1348"></a><span class="hs-comment">-- type. Column numbers start at 0.</span><span>
</span><a name="line-1349"></a><span class="hs-comment">--</span><span>
</span><a name="line-1350"></a><span class="hs-comment">-- You can query the system table pg_type to obtain the names and</span><span>
</span><a name="line-1351"></a><span class="hs-comment">-- properties of the various data types. The OIDs of the built-in data</span><span>
</span><a name="line-1352"></a><span class="hs-comment">-- types are defined in the file src/include/catalog/pg_type.h in the</span><span>
</span><a name="line-1353"></a><span class="hs-comment">-- source tree.</span><span>
</span><a name="line-1354"></a><span class="hs-identifier">ftype</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1355"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1356"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-1357"></a><span class="hs-identifier">ftype</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQftype</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1358"></a><span>
</span><a name="line-1359"></a><span>
</span><a name="line-1360"></a><span class="hs-comment">-- | Returns the type modifier of the column associated with the given</span><span>
</span><a name="line-1361"></a><span class="hs-comment">-- column number. Column numbers start at 0.</span><span>
</span><a name="line-1362"></a><span class="hs-comment">--</span><span>
</span><a name="line-1363"></a><span class="hs-comment">-- The interpretation of modifier values is type-specific; they</span><span>
</span><a name="line-1364"></a><span class="hs-comment">-- typically indicate precision or size limits. The value -1 is used</span><span>
</span><a name="line-1365"></a><span class="hs-comment">-- to indicate &quot;no information available&quot;. Most data types do not use</span><span>
</span><a name="line-1366"></a><span class="hs-comment">-- modifiers, in which case the value is always -1.</span><span>
</span><a name="line-1367"></a><span class="hs-identifier">fmod</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1368"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1369"></a><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-1370"></a><span class="hs-identifier">fmod</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQfmod</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1371"></a><span>
</span><a name="line-1372"></a><span>
</span><a name="line-1373"></a><span class="hs-comment">-- | Returns the size in bytes of the column associated with the given</span><span>
</span><a name="line-1374"></a><span class="hs-comment">-- column number. Column numbers start at 0.</span><span>
</span><a name="line-1375"></a><span class="hs-comment">--</span><span>
</span><a name="line-1376"></a><span class="hs-comment">-- 'fsize' returns the space allocated for this column in a database</span><span>
</span><a name="line-1377"></a><span class="hs-comment">-- row, in other words the size of the server's internal</span><span>
</span><a name="line-1378"></a><span class="hs-comment">-- representation of the data type. (Accordingly, it is not really</span><span>
</span><a name="line-1379"></a><span class="hs-comment">-- very useful to clients.) A negative value indicates the data type</span><span>
</span><a name="line-1380"></a><span class="hs-comment">-- is variable-length.</span><span>
</span><a name="line-1381"></a><span class="hs-identifier">fsize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1382"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1383"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-1384"></a><span class="hs-identifier">fsize</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQfsize</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1385"></a><span>
</span><a name="line-1386"></a><span>
</span><a name="line-1387"></a><span class="hs-comment">-- | Returns a single field value of one row of a PGresult. Row and</span><span>
</span><a name="line-1388"></a><span class="hs-comment">-- column numbers start at 0.</span><span>
</span><a name="line-1389"></a><span class="hs-comment">--</span><span>
</span><a name="line-1390"></a><span class="hs-comment">-- For convenience, this binding uses 'getisnull' and 'getlength' to</span><span>
</span><a name="line-1391"></a><span class="hs-comment">-- help construct the result.</span><span>
</span><a name="line-1392"></a><span class="hs-comment">--</span><span>
</span><a name="line-1393"></a><span class="hs-comment">-- Note: The 'ByteString' returned holds a reference to the Result. As</span><span>
</span><a name="line-1394"></a><span class="hs-comment">-- long as ByteString is live, the Result will not be garbage</span><span>
</span><a name="line-1395"></a><span class="hs-comment">-- collected. 'getvalue'' returns a copy of the data.</span><span>
</span><a name="line-1396"></a><span class="hs-identifier">getvalue</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1397"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Row</span><span>
</span><a name="line-1398"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1399"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1400"></a><span class="hs-identifier">getvalue</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Result</span><span> </span><span class="hs-identifier">fp</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Row</span><span> </span><span class="hs-identifier">rowNum</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1401"></a><span>    </span><span class="hs-identifier">withForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1402"></a><span>      </span><span class="hs-identifier">isnull</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQgetisnull</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1403"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">isnull</span><span>
</span><a name="line-1404"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1405"></a><span>
</span><a name="line-1406"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQgetvalue</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1407"></a><span>                </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQgetlength</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1408"></a><span>                </span><span class="hs-identifier">fp'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">FC.newForeignPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">cstr</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">finalizer</span><span>
</span><a name="line-1409"></a><span>                </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">fp'</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-1410"></a><span>
</span><a name="line-1411"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1412"></a><span>      </span><span class="hs-identifier">finalizer</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">touchForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span>
</span><a name="line-1413"></a><span>
</span><a name="line-1414"></a><span>
</span><a name="line-1415"></a><span class="hs-comment">-- | Returns a copy of a single field value of one row of a</span><span>
</span><a name="line-1416"></a><span class="hs-comment">-- PGresult. Row and column numbers start at 0.</span><span>
</span><a name="line-1417"></a><span class="hs-comment">--</span><span>
</span><a name="line-1418"></a><span class="hs-comment">-- For convenience, this binding uses 'getisnull' and 'getlength' to</span><span>
</span><a name="line-1419"></a><span class="hs-comment">-- help construct the result.</span><span>
</span><a name="line-1420"></a><span class="hs-identifier">getvalue'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1421"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Row</span><span>
</span><a name="line-1422"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1423"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1424"></a><span class="hs-identifier">getvalue'</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Row</span><span> </span><span class="hs-identifier">rowNum</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1425"></a><span>    </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1426"></a><span>      </span><span class="hs-identifier">isnull</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQgetisnull</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1427"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">isnull</span><span>
</span><a name="line-1428"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1429"></a><span>
</span><a name="line-1430"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQgetvalue</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1431"></a><span>                </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">c_PQgetlength</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1432"></a><span>                </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">B.packCStringLen</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">cstr</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span>
</span><a name="line-1433"></a><span>
</span><a name="line-1434"></a><span>
</span><a name="line-1435"></a><span class="hs-comment">-- | Tests a field for a null value. Row and column numbers start at</span><span>
</span><a name="line-1436"></a><span class="hs-comment">-- 0.</span><span>
</span><a name="line-1437"></a><span class="hs-identifier">getisnull</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1438"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Row</span><span>
</span><a name="line-1439"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1440"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1441"></a><span class="hs-identifier">getisnull</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Row</span><span> </span><span class="hs-identifier">rowNum</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1442"></a><span>    </span><span class="hs-identifier">enumFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1443"></a><span>        </span><span class="hs-identifier">c_PQgetisnull</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1444"></a><span>
</span><a name="line-1445"></a><span>
</span><a name="line-1446"></a><span class="hs-comment">-- | Returns the actual length of a field value in bytes. Row and</span><span>
</span><a name="line-1447"></a><span class="hs-comment">-- column numbers start at 0.</span><span>
</span><a name="line-1448"></a><span class="hs-comment">--</span><span>
</span><a name="line-1449"></a><span class="hs-comment">-- This is the actual data length for the particular data value, that</span><span>
</span><a name="line-1450"></a><span class="hs-comment">-- is, the size of the object pointed to by 'getvalue'. For text data</span><span>
</span><a name="line-1451"></a><span class="hs-comment">-- format this is the same as strlen(). For binary format this is</span><span>
</span><a name="line-1452"></a><span class="hs-comment">-- essential information. Note that one should not rely on 'fsize' to</span><span>
</span><a name="line-1453"></a><span class="hs-comment">-- obtain the actual data length.</span><span>
</span><a name="line-1454"></a><span class="hs-identifier">getlength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1455"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Row</span><span>
</span><a name="line-1456"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Column</span><span>
</span><a name="line-1457"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-1458"></a><span class="hs-identifier">getlength</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Row</span><span> </span><span class="hs-identifier">rowNum</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Col</span><span> </span><span class="hs-identifier">colNum</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1459"></a><span>    </span><span class="hs-identifier">numFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1460"></a><span>      </span><span class="hs-identifier">c_PQgetlength</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">rowNum</span><span> </span><span class="hs-identifier">colNum</span><span>
</span><a name="line-1461"></a><span>
</span><a name="line-1462"></a><span>
</span><a name="line-1463"></a><span class="hs-comment">-- | Returns the number of parameters of a prepared statement.</span><span>
</span><a name="line-1464"></a><span class="hs-comment">--</span><span>
</span><a name="line-1465"></a><span class="hs-comment">-- This function is only useful when inspecting the result of</span><span>
</span><a name="line-1466"></a><span class="hs-comment">-- PQdescribePrepared. For other types of queries it will return zero.</span><span>
</span><a name="line-1467"></a><span class="hs-identifier">nparams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1468"></a><span>        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-1469"></a><span class="hs-identifier">nparams</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">numFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-identifier">c_PQnparams</span><span>
</span><a name="line-1470"></a><span>
</span><a name="line-1471"></a><span>
</span><a name="line-1472"></a><span class="hs-comment">-- | Returns the data type of the indicated statement</span><span>
</span><a name="line-1473"></a><span class="hs-comment">-- parameter. Parameter numbers start at 0.</span><span>
</span><a name="line-1474"></a><span class="hs-comment">--</span><span>
</span><a name="line-1475"></a><span class="hs-comment">-- This function is only useful when inspecting the result of</span><span>
</span><a name="line-1476"></a><span class="hs-comment">-- 'describePrepared'. For other types of queries it will return zero.</span><span>
</span><a name="line-1477"></a><span class="hs-identifier">paramtype</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1478"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-comment">-- ^ param_number</span><span>
</span><a name="line-1479"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-1480"></a><span class="hs-identifier">paramtype</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-identifier">param_number</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1481"></a><span>    </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQparamtype</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">param_number</span><span>
</span><a name="line-1482"></a><span>
</span><a name="line-1483"></a><span>
</span><a name="line-1484"></a><span class="hs-comment">-- $othercommands</span><span>
</span><a name="line-1485"></a><span class="hs-comment">-- These functions are used to extract other information from PGresult</span><span>
</span><a name="line-1486"></a><span class="hs-comment">-- objects.</span><span>
</span><a name="line-1487"></a><span>
</span><a name="line-1488"></a><span class="hs-comment">-- | Returns the command status tag from the SQL command that</span><span>
</span><a name="line-1489"></a><span class="hs-comment">-- generated the PGresult.</span><span>
</span><a name="line-1490"></a><span class="hs-comment">--</span><span>
</span><a name="line-1491"></a><span class="hs-comment">-- Commonly this is just the name of the command, but it might include</span><span>
</span><a name="line-1492"></a><span class="hs-comment">-- additional data such as the number of rows processed.</span><span>
</span><a name="line-1493"></a><span class="hs-identifier">cmdStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1494"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1495"></a><span class="hs-identifier">cmdStatus</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">flip</span><span> </span><span class="hs-identifier">maybeBsFromResult</span><span> </span><span class="hs-identifier">c_PQcmdStatus</span><span>
</span><a name="line-1496"></a><span>
</span><a name="line-1497"></a><span>
</span><a name="line-1498"></a><span class="hs-comment">-- | Returns the number of rows affected by the SQL command.</span><span>
</span><a name="line-1499"></a><span class="hs-comment">--</span><span>
</span><a name="line-1500"></a><span class="hs-comment">-- This function returns a string containing the number of rows</span><span>
</span><a name="line-1501"></a><span class="hs-comment">-- affected by the SQL statement that generated the 'Result'. This</span><span>
</span><a name="line-1502"></a><span class="hs-comment">-- function can only be used following the execution of a SELECT,</span><span>
</span><a name="line-1503"></a><span class="hs-comment">-- CREATE TABLE AS, INSERT, UPDATE, DELETE, MOVE, FETCH, or COPY</span><span>
</span><a name="line-1504"></a><span class="hs-comment">-- statement, or an EXECUTE of a prepared query that contains an</span><span>
</span><a name="line-1505"></a><span class="hs-comment">-- INSERT, UPDATE, or DELETE statement. If the command that generated</span><span>
</span><a name="line-1506"></a><span class="hs-comment">-- the 'Result' was anything else, 'cmdTuples' returns an empty</span><span>
</span><a name="line-1507"></a><span class="hs-comment">-- string.</span><span>
</span><a name="line-1508"></a><span class="hs-identifier">cmdTuples</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-1509"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1510"></a><span class="hs-identifier">cmdTuples</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">flip</span><span> </span><span class="hs-identifier">maybeBsFromResult</span><span> </span><span class="hs-identifier">c_PQcmdTuples</span><span>
</span><a name="line-1511"></a><span>
</span><a name="line-1512"></a><span class="hs-comment">-- | Escapes a string for use within an SQL command. This is useful</span><span>
</span><a name="line-1513"></a><span class="hs-comment">-- when inserting data values as literal constants in SQL</span><span>
</span><a name="line-1514"></a><span class="hs-comment">-- commands. Certain characters (such as quotes and backslashes) must</span><span>
</span><a name="line-1515"></a><span class="hs-comment">-- be escaped to prevent them from being interpreted specially by the</span><span>
</span><a name="line-1516"></a><span class="hs-comment">-- SQL parser.</span><span>
</span><a name="line-1517"></a><span class="hs-identifier">escapeStringConn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1518"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1519"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1520"></a><span class="hs-identifier">escapeStringConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1521"></a><span>  </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">conn</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1522"></a><span>    </span><span class="hs-identifier">B.unsafeUseAsCStringLen</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">from</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bslen</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1523"></a><span>      </span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">err</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1524"></a><span>        </span><span class="hs-identifier">xs</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.createAndTrim</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">bslen</span><span class="hs-operator">*</span><span class="hs-number">2</span><span class="hs-operator">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">to</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1525"></a><span>                 </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span>
</span><a name="line-1526"></a><span>                   </span><span class="hs-identifier">c_PQescapeStringConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">bslen</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">err</span><span>
</span><a name="line-1527"></a><span>        </span><span class="hs-identifier">stat</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">err</span><span>
</span><a name="line-1528"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1529"></a><span>          </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">xs</span><span>
</span><a name="line-1530"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1531"></a><span>
</span><a name="line-1532"></a><span>
</span><a name="line-1533"></a><span class="hs-comment">-- | Escapes binary data for use within an SQL command with the type</span><span>
</span><a name="line-1534"></a><span class="hs-comment">-- bytea. As with 'escapeStringConn', this is only used when inserting</span><span>
</span><a name="line-1535"></a><span class="hs-comment">-- data directly into an SQL command string.</span><span>
</span><a name="line-1536"></a><span class="hs-identifier">escapeByteaConn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1537"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1538"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1539"></a><span class="hs-identifier">escapeByteaConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1540"></a><span>    </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">conn</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1541"></a><span>        </span><span class="hs-identifier">B.unsafeUseAsCStringLen</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">from</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bslen</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1542"></a><span>            </span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">to_length</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1543"></a><span>              </span><span class="hs-identifier">to</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQescapeByteaConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">bslen</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">to_length</span><span>
</span><a name="line-1544"></a><span>              </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-1545"></a><span>                </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1546"></a><span>                </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">tofp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">p_PQfreemem</span><span> </span><span class="hs-identifier">to</span><span>
</span><a name="line-1547"></a><span>                        </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">to_length</span><span>
</span><a name="line-1548"></a><span>                        </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">tofp</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">l</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-1549"></a><span>
</span><a name="line-1550"></a><span>
</span><a name="line-1551"></a><span class="hs-comment">-- | Converts a 'ByteString' representation of binary data into binary</span><span>
</span><a name="line-1552"></a><span class="hs-comment">-- data - the reverse of 'PQescapeByteaConn'. This is needed when</span><span>
</span><a name="line-1553"></a><span class="hs-comment">-- retrieving bytea data in text format, but not when retrieving it in</span><span>
</span><a name="line-1554"></a><span class="hs-comment">-- binary format.</span><span>
</span><a name="line-1555"></a><span class="hs-comment">--</span><span>
</span><a name="line-1556"></a><span class="hs-comment">-- The parameter points to a string such as might be returned by</span><span>
</span><a name="line-1557"></a><span class="hs-comment">-- 'getvalue' when applied to a bytea column. 'unescapeBytea' converts</span><span>
</span><a name="line-1558"></a><span class="hs-comment">-- this string representation into its binary representation. It</span><span>
</span><a name="line-1559"></a><span class="hs-comment">-- returns a 'ByteString', or 'Nothing' on error.</span><span>
</span><a name="line-1560"></a><span class="hs-comment">--</span><span>
</span><a name="line-1561"></a><span class="hs-comment">-- This conversion is not exactly the inverse of 'escapeByteaConn',</span><span>
</span><a name="line-1562"></a><span class="hs-comment">-- because the string is not expected to be &quot;escaped&quot; when received</span><span>
</span><a name="line-1563"></a><span class="hs-comment">-- from 'getvalue'. In particular this means there is no need for</span><span>
</span><a name="line-1564"></a><span class="hs-comment">-- string quoting considerations, and so no need for a 'Connection'</span><span>
</span><a name="line-1565"></a><span class="hs-comment">-- parameter.</span><span>
</span><a name="line-1566"></a><span class="hs-identifier">unescapeBytea</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1567"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1568"></a><span class="hs-identifier">unescapeBytea</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1569"></a><span>    </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">from</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1570"></a><span>        </span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">to_length</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1571"></a><span>          </span><span class="hs-identifier">to</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQunescapeBytea</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-identifier">to_length</span><span>
</span><a name="line-1572"></a><span>          </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">to</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-1573"></a><span>            </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1574"></a><span>            </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">tofp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">p_PQfreemem</span><span> </span><span class="hs-identifier">to</span><span>
</span><a name="line-1575"></a><span>                    </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">to_length</span><span>
</span><a name="line-1576"></a><span>                    </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">tofp</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-1577"></a><span>
</span><a name="line-1578"></a><span class="hs-comment">-- | @escapeIdentifier@ escapes a string for use as an SQL identifier, such</span><span>
</span><a name="line-1579"></a><span class="hs-comment">--   as a table, column, or function name. This is useful when a user-supplied</span><span>
</span><a name="line-1580"></a><span class="hs-comment">--   identifier might contain special characters that would otherwise not be</span><span>
</span><a name="line-1581"></a><span class="hs-comment">--   interpreted as part of the identifier by the SQL parser, or when the</span><span>
</span><a name="line-1582"></a><span class="hs-comment">--   identifier might contain upper case characters whose case should be</span><span>
</span><a name="line-1583"></a><span class="hs-comment">--   preserved.</span><span>
</span><a name="line-1584"></a><span class="hs-comment">--</span><span>
</span><a name="line-1585"></a><span class="hs-comment">--   The return string has all special characters replaced so that it will</span><span>
</span><a name="line-1586"></a><span class="hs-comment">--   be properly processed as an SQL identifier. The return string will also</span><span>
</span><a name="line-1587"></a><span class="hs-comment">--   be surrounded by double quotes.</span><span>
</span><a name="line-1588"></a><span class="hs-comment">--</span><span>
</span><a name="line-1589"></a><span class="hs-comment">--   On error, @escapeIdentifier@ returns 'Nothing' and a suitable message</span><span>
</span><a name="line-1590"></a><span class="hs-comment">--   is stored in the conn object.</span><span>
</span><a name="line-1591"></a><span>
</span><a name="line-1592"></a><span class="hs-identifier">escapeIdentifier</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1593"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1594"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-1595"></a><span class="hs-identifier">escapeIdentifier</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1596"></a><span>  </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">conn</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1597"></a><span>    </span><span class="hs-identifier">B.unsafeUseAsCStringLen</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">from</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">bslen</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1598"></a><span>      </span><span class="hs-identifier">bs'ptr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQescapeIdentifier</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">from</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">bslen</span><span class="hs-special">)</span><span>
</span><a name="line-1599"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">bs'ptr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-1600"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1601"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1602"></a><span>            </span><span class="hs-identifier">bs'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.packCString</span><span> </span><span class="hs-identifier">bs'ptr</span><span>
</span><a name="line-1603"></a><span>            </span><span class="hs-identifier">c_PQfreemem</span><span> </span><span class="hs-identifier">bs'ptr</span><span>
</span><a name="line-1604"></a><span>            </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">bs'</span><span>
</span><a name="line-1605"></a><span>
</span><a name="line-1606"></a><span class="hs-comment">-- $copy</span><span>
</span><a name="line-1607"></a><span class="hs-comment">--</span><span>
</span><a name="line-1608"></a><span class="hs-comment">-- This provides support for PostgreSQL's @COPY FROM@ facility.</span><span>
</span><a name="line-1609"></a><span class="hs-comment">--</span><span>
</span><a name="line-1610"></a><span class="hs-comment">-- For more information, see:</span><span>
</span><a name="line-1611"></a><span class="hs-comment">--</span><span>
</span><a name="line-1612"></a><span class="hs-comment">--  * &lt;http://www.postgresql.org/docs/current/static/sql-copy.html&gt;</span><span>
</span><a name="line-1613"></a><span class="hs-comment">--</span><span>
</span><a name="line-1614"></a><span class="hs-comment">--  * &lt;http://www.postgresql.org/docs/current/static/libpq-copy.html&gt;</span><span>
</span><a name="line-1615"></a><span class="hs-comment">--</span><span>
</span><a name="line-1616"></a><span>
</span><a name="line-1617"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">CopyInResult</span><span>
</span><a name="line-1618"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CopyInOk</span><span>          </span><span class="hs-comment">-- ^ The data was sent.</span><span>
</span><a name="line-1619"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyInError</span><span>       </span><span class="hs-comment">-- ^ An error occurred (use 'errorMessage'</span><span>
</span><a name="line-1620"></a><span>                       </span><span class="hs-comment">--   to retrieve details).</span><span>
</span><a name="line-1621"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyInWouldBlock</span><span>  </span><span class="hs-comment">-- ^ The data was not sent because the</span><span>
</span><a name="line-1622"></a><span>                       </span><span class="hs-comment">--   attempt would block (this case is only</span><span>
</span><a name="line-1623"></a><span>                       </span><span class="hs-comment">--   possible if the connection is in</span><span>
</span><a name="line-1624"></a><span>                       </span><span class="hs-comment">--   nonblocking mode)  Wait for</span><span>
</span><a name="line-1625"></a><span>                       </span><span class="hs-comment">--   write-ready (e.g. by using</span><span>
</span><a name="line-1626"></a><span>                       </span><span class="hs-comment">--   'Control.Concurrent.threadWaitWrite'</span><span>
</span><a name="line-1627"></a><span>                       </span><span class="hs-comment">--   on the 'socket') and try again.</span><span>
</span><a name="line-1628"></a><span>     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-1629"></a><span>
</span><a name="line-1630"></a><span>
</span><a name="line-1631"></a><span class="hs-identifier">toCopyInResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CopyInResult</span><span>
</span><a name="line-1632"></a><span class="hs-identifier">toCopyInResult</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span>     </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">CopyInError</span><span>
</span><a name="line-1633"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">CopyInWouldBlock</span><span>
</span><a name="line-1634"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">CopyInOk</span><span>
</span><a name="line-1635"></a><span>
</span><a name="line-1636"></a><span>
</span><a name="line-1637"></a><span class="hs-comment">-- | Send raw @COPY@ data to the server during the 'CopyIn' state.</span><span>
</span><a name="line-1638"></a><span class="hs-identifier">putCopyData</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CopyInResult</span><span>
</span><a name="line-1639"></a><span class="hs-identifier">putCopyData</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1640"></a><span>    </span><span class="hs-identifier">B.unsafeUseAsCStringLen</span><span> </span><span class="hs-identifier">bs</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">putCopyCString</span><span> </span><span class="hs-identifier">conn</span><span>
</span><a name="line-1641"></a><span>
</span><a name="line-1642"></a><span>
</span><a name="line-1643"></a><span class="hs-identifier">putCopyCString</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CStringLen</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CopyInResult</span><span>
</span><a name="line-1644"></a><span class="hs-identifier">putCopyCString</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">str</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1645"></a><span>    </span><span class="hs-identifier">toCopyInResult</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span>
</span><a name="line-1646"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQputCopyData</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">str</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1647"></a><span>
</span><a name="line-1648"></a><span>
</span><a name="line-1649"></a><span class="hs-comment">-- | Send end-of-data indication to the server during the 'CopyIn' state.</span><span>
</span><a name="line-1650"></a><span class="hs-comment">--</span><span>
</span><a name="line-1651"></a><span class="hs-comment">--  * @putCopyEnd conn Nothing@ ends the 'CopyIn' operation successfully.</span><span>
</span><a name="line-1652"></a><span class="hs-comment">--</span><span>
</span><a name="line-1653"></a><span class="hs-comment">--  * @putCopyEnd conn (Just errormsg)@ forces the @COPY@ to fail, with</span><span>
</span><a name="line-1654"></a><span class="hs-comment">--    @errormsg@ used as the error message.</span><span>
</span><a name="line-1655"></a><span class="hs-comment">--</span><span>
</span><a name="line-1656"></a><span class="hs-comment">-- After 'putCopyEnd' returns 'CopyOk', call 'getResult' to obtain the final</span><span>
</span><a name="line-1657"></a><span class="hs-comment">-- result status of the @COPY@ command.  Then return to normal operation.</span><span>
</span><a name="line-1658"></a><span class="hs-identifier">putCopyEnd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CopyInResult</span><span>
</span><a name="line-1659"></a><span class="hs-identifier">putCopyEnd</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1660"></a><span>    </span><span class="hs-identifier">toCopyInResult</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span>
</span><a name="line-1661"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQputCopyEnd</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">nullPtr</span><span class="hs-special">)</span><span>
</span><a name="line-1662"></a><span class="hs-identifier">putCopyEnd</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">errormsg</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1663"></a><span>    </span><span class="hs-identifier">toCopyInResult</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span>
</span><a name="line-1664"></a><span>        </span><span class="hs-special">(</span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">errormsg</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">errormsg_cstr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1665"></a><span>            </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQputCopyEnd</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">errormsg_cstr</span><span class="hs-special">)</span><span>
</span><a name="line-1666"></a><span>
</span><a name="line-1667"></a><span>
</span><a name="line-1668"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">CopyOutResult</span><span>
</span><a name="line-1669"></a><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CopyOutRow</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ Data representing a single row of the result</span><span>
</span><a name="line-1670"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyOutWouldBlock</span><span>        </span><span class="hs-comment">-- ^ A complete row is not yet available.  This</span><span>
</span><a name="line-1671"></a><span>                              </span><span class="hs-comment">--   case is only possible when 'getCopyData' is</span><span>
</span><a name="line-1672"></a><span>                              </span><span class="hs-comment">--   has the async parameter set to 'True'.</span><span>
</span><a name="line-1673"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyOutDone</span><span>              </span><span class="hs-comment">-- ^ No more rows are available</span><span>
</span><a name="line-1674"></a><span>   </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">CopyOutError</span><span>             </span><span class="hs-comment">-- ^ An error occurred (e.g. the connection is</span><span>
</span><a name="line-1675"></a><span>                              </span><span class="hs-comment">--   not in the 'CopyOut' state).  Call</span><span>
</span><a name="line-1676"></a><span>                              </span><span class="hs-comment">--   'errorMessage' for more information.</span><span>
</span><a name="line-1677"></a><span>     </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier">Show</span><span>
</span><a name="line-1678"></a><span>
</span><a name="line-1679"></a><span class="hs-comment">-- | Receive raw @COPY@ data from the server during the 'CopyOut' state.</span><span>
</span><a name="line-1680"></a><span class="hs-comment">--   The boolean parameter determines whether or not the call will block</span><span>
</span><a name="line-1681"></a><span class="hs-comment">--   while waiting for data.</span><span>
</span><a name="line-1682"></a><span class="hs-identifier">getCopyData</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CopyOutResult</span><span>
</span><a name="line-1683"></a><span class="hs-identifier">getCopyData</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-identifier">async</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">alloca</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">strp</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1684"></a><span>    </span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQgetCopyData</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">strp</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">async</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1685"></a><span>    </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-operator">&lt;=</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1686"></a><span>      </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">compare</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1687"></a><span>             </span><span class="hs-identifier">LT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">CopyOutError</span><span>
</span><a name="line-1688"></a><span>             </span><span class="hs-identifier">EQ</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">CopyOutDone</span><span>
</span><a name="line-1689"></a><span>             </span><span class="hs-identifier">GT</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">CopyOutWouldBlock</span><span>
</span><a name="line-1690"></a><span>      </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1691"></a><span>        </span><span class="hs-identifier">fp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">p_PQfreemem</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">strp</span><span>
</span><a name="line-1692"></a><span>        </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">CopyOutRow</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1693"></a><span>
</span><a name="line-1694"></a><span>
</span><a name="line-1695"></a><span class="hs-comment">-- $asynccommand</span><span>
</span><a name="line-1696"></a><span class="hs-comment">-- The 'exec' function is adequate for submitting commands in normal,</span><span>
</span><a name="line-1697"></a><span class="hs-comment">-- synchronous applications. It has a couple of deficiencies, however,</span><span>
</span><a name="line-1698"></a><span class="hs-comment">-- that can be of importance to some users:</span><span>
</span><a name="line-1699"></a><span class="hs-comment">--</span><span>
</span><a name="line-1700"></a><span class="hs-comment">--   * 'exec' waits for the command to be completed. The application</span><span>
</span><a name="line-1701"></a><span class="hs-comment">--   might have other work to do (such as maintaining a user</span><span>
</span><a name="line-1702"></a><span class="hs-comment">--   interface), in which case it won't want to block waiting for the</span><span>
</span><a name="line-1703"></a><span class="hs-comment">--   response.</span><span>
</span><a name="line-1704"></a><span class="hs-comment">--</span><span>
</span><a name="line-1705"></a><span class="hs-comment">--   * Since the execution of the client application is suspended</span><span>
</span><a name="line-1706"></a><span class="hs-comment">--   while it waits for the result, it is hard for the application to</span><span>
</span><a name="line-1707"></a><span class="hs-comment">--   decide that it would like to try to cancel the ongoing</span><span>
</span><a name="line-1708"></a><span class="hs-comment">--   command. (It can be done from a signal handler, but not</span><span>
</span><a name="line-1709"></a><span class="hs-comment">--   otherwise.)</span><span>
</span><a name="line-1710"></a><span class="hs-comment">--</span><span>
</span><a name="line-1711"></a><span class="hs-comment">--   * 'exec' can return only one 'Result'. If the submitted command</span><span>
</span><a name="line-1712"></a><span class="hs-comment">--   string contains multiple SQL commands, all but the last 'Result'</span><span>
</span><a name="line-1713"></a><span class="hs-comment">--   are discarded by 'exec'.</span><span>
</span><a name="line-1714"></a><span class="hs-comment">--</span><span>
</span><a name="line-1715"></a><span class="hs-comment">-- Applications that do not like these limitations can instead use the</span><span>
</span><a name="line-1716"></a><span class="hs-comment">-- underlying functions that 'exec' is built from: 'sendQuery' and</span><span>
</span><a name="line-1717"></a><span class="hs-comment">-- 'getResult'. There are also 'sendQueryParams', 'sendPrepare',</span><span>
</span><a name="line-1718"></a><span class="hs-comment">-- 'sendQueryPrepared', 'sendDescribePrepared', and</span><span>
</span><a name="line-1719"></a><span class="hs-comment">-- 'sendDescribePortal', which can be used with 'getResult' to</span><span>
</span><a name="line-1720"></a><span class="hs-comment">-- duplicate the functionality of 'execParams', 'prepare',</span><span>
</span><a name="line-1721"></a><span class="hs-comment">-- 'execPrepared', 'describePrepared', and 'describePortal'</span><span>
</span><a name="line-1722"></a><span class="hs-comment">-- respectively.</span><span>
</span><a name="line-1723"></a><span>
</span><a name="line-1724"></a><span class="hs-comment">-- | Submits a command to the server without waiting for the</span><span>
</span><a name="line-1725"></a><span class="hs-comment">-- result(s). 'True' is returned if the command was successfully</span><span>
</span><a name="line-1726"></a><span class="hs-comment">-- dispatched and 'False' if not (in which case, use 'errorMessage' to</span><span>
</span><a name="line-1727"></a><span class="hs-comment">-- get more information about the failure).</span><span>
</span><a name="line-1728"></a><span class="hs-identifier">sendQuery</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1729"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1730"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1731"></a><span class="hs-identifier">sendQuery</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1732"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1733"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">c_PQsendQuery</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1734"></a><span>
</span><a name="line-1735"></a><span>
</span><a name="line-1736"></a><span class="hs-comment">-- | Submits a command and separate parameters to the server without</span><span>
</span><a name="line-1737"></a><span class="hs-comment">-- waiting for the result(s).</span><span>
</span><a name="line-1738"></a><span class="hs-identifier">sendQueryParams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1739"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1740"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Oid</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Format</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1741"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Format</span><span>
</span><a name="line-1742"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1743"></a><span class="hs-identifier">sendQueryParams</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">statement</span><span> </span><span class="hs-identifier">params</span><span> </span><span class="hs-identifier">rFmt</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1744"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">oids</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">values</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lengths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">formats</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1745"></a><span>               </span><span class="hs-identifier">foldl'</span><span> </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">reverse</span><span> </span><span class="hs-identifier">params</span><span>
</span><a name="line-1746"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">lengths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">CInt</span><span class="hs-special">]</span><span>
</span><a name="line-1747"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">params</span><span>
</span><a name="line-1748"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">rFmt</span><span>
</span><a name="line-1749"></a><span>       </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1750"></a><span>           </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">statement</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1751"></a><span>               </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">oids</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ts</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1752"></a><span>                   </span><span class="hs-identifier">withMany</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maybeWith</span><span> </span><span class="hs-identifier">B.useAsCString</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c_values</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1753"></a><span>                       </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">vs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1754"></a><span>                           </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ls</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1755"></a><span>                               </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">formats</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">fs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1756"></a><span>                                   </span><span class="hs-identifier">c_PQsendQueryParams</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">ts</span><span> </span><span class="hs-identifier">vs</span><span> </span><span class="hs-identifier">ls</span><span> </span><span class="hs-identifier">fs</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-1757"></a><span>
</span><a name="line-1758"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1759"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">d</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">invalidOid</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-1760"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-1761"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-1762"></a><span>                                    </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">d</span><span>
</span><a name="line-1763"></a><span>                                    </span><span class="hs-special">)</span><span>
</span><a name="line-1764"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">d</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">t</span><span class="hs-special">,</span><span class="hs-identifier">v</span><span class="hs-special">,</span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">t</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-1765"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-1766"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.length</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-1767"></a><span>                                           </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">d</span><span>
</span><a name="line-1768"></a><span>                                           </span><span class="hs-special">)</span><span>
</span><a name="line-1769"></a><span>
</span><a name="line-1770"></a><span>
</span><a name="line-1771"></a><span class="hs-comment">-- | Sends a request to create a prepared statement with the given</span><span>
</span><a name="line-1772"></a><span class="hs-comment">-- parameters, without waiting for completion.</span><span>
</span><a name="line-1773"></a><span class="hs-identifier">sendPrepare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1774"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1775"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1776"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Oid</span><span class="hs-special">]</span><span>
</span><a name="line-1777"></a><span>            </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1778"></a><span class="hs-identifier">sendPrepare</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-identifier">mParamTypes</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1779"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1780"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1781"></a><span>            </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">query</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">q</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1782"></a><span>                </span><span class="hs-identifier">maybeWith</span><span> </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">mParamTypes</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">o</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1783"></a><span>                    </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">maybe</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">length</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">mParamTypes</span><span>
</span><a name="line-1784"></a><span>                    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier">c_PQsendPrepare</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">q</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-identifier">o</span><span>
</span><a name="line-1785"></a><span>
</span><a name="line-1786"></a><span>
</span><a name="line-1787"></a><span class="hs-comment">-- | Sends a request to execute a prepared statement with given</span><span>
</span><a name="line-1788"></a><span class="hs-comment">-- parameters, without waiting for the result(s).</span><span>
</span><a name="line-1789"></a><span class="hs-identifier">sendQueryPrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1790"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-1791"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.ByteString</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Format</span><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-1792"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Format</span><span>
</span><a name="line-1793"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1794"></a><span class="hs-identifier">sendQueryPrepared</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-identifier">mPairs</span><span> </span><span class="hs-identifier">rFmt</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1795"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">values</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">lengths</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">formats</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">foldl'</span><span> </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">reverse</span><span> </span><span class="hs-identifier">mPairs</span><span>
</span><a name="line-1796"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">map</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">lengths</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier">CInt</span><span class="hs-special">]</span><span>
</span><a name="line-1797"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">n</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">length</span><span> </span><span class="hs-identifier">mPairs</span><span>
</span><a name="line-1798"></a><span>           </span><span class="hs-glyph">!</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">rFmt</span><span>
</span><a name="line-1799"></a><span>       </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1800"></a><span>           </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1801"></a><span>               </span><span class="hs-identifier">withMany</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">maybeWith</span><span> </span><span class="hs-identifier">B.useAsCString</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c_values</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1802"></a><span>                   </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_values</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">vs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1803"></a><span>                       </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">c_lengths</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ls</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1804"></a><span>                           </span><span class="hs-identifier">withArray</span><span> </span><span class="hs-identifier">formats</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">fs</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1805"></a><span>                               </span><span class="hs-identifier">c_PQsendQueryPrepared</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">n</span><span> </span><span class="hs-identifier">vs</span><span> </span><span class="hs-identifier">ls</span><span> </span><span class="hs-identifier">fs</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-1806"></a><span>
</span><a name="line-1807"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1808"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">Nothing</span><span>       </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-identifier">Nothing</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-1809"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-1810"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-number">0</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-1811"></a><span>                                       </span><span class="hs-special">)</span><span>
</span><a name="line-1812"></a><span>      </span><span class="hs-identifier">accum</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">!</span><span class="hs-identifier">a</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">b</span><span class="hs-special">,</span><span class="hs-glyph">!</span><span class="hs-identifier">c</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">v</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">a</span><span>
</span><a name="line-1813"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">B.length</span><span> </span><span class="hs-identifier">v</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">b</span><span>
</span><a name="line-1814"></a><span>                                       </span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">f</span><span class="hs-special">)</span><span class="hs-glyph">:</span><span class="hs-identifier">c</span><span>
</span><a name="line-1815"></a><span>                                       </span><span class="hs-special">)</span><span>
</span><a name="line-1816"></a><span>
</span><a name="line-1817"></a><span>
</span><a name="line-1818"></a><span class="hs-comment">-- | Submits a request to obtain information about the specified</span><span>
</span><a name="line-1819"></a><span class="hs-comment">-- prepared statement, without waiting for completion.</span><span>
</span><a name="line-1820"></a><span class="hs-comment">--</span><span>
</span><a name="line-1821"></a><span class="hs-comment">-- This is an asynchronous version of 'describePrepared': it returns</span><span>
</span><a name="line-1822"></a><span class="hs-comment">-- 'True' if it was able to dispatch the request, and 'False' if</span><span>
</span><a name="line-1823"></a><span class="hs-comment">-- not. After a successful call, call 'getResult' to obtain the</span><span>
</span><a name="line-1824"></a><span class="hs-comment">-- results. The function's parameters are handled identically to</span><span>
</span><a name="line-1825"></a><span class="hs-comment">-- 'describePrepared'. Like 'describePrepared', it will not work on</span><span>
</span><a name="line-1826"></a><span class="hs-comment">-- 2.0-protocol connections.</span><span>
</span><a name="line-1827"></a><span class="hs-identifier">sendDescribePrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1828"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ stmtName</span><span>
</span><a name="line-1829"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1830"></a><span class="hs-identifier">sendDescribePrepared</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1831"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1832"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">stmtName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1833"></a><span>            </span><span class="hs-identifier">c_PQsendDescribePrepared</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-1834"></a><span>
</span><a name="line-1835"></a><span>
</span><a name="line-1836"></a><span class="hs-comment">-- | Submits a request to obtain information about the specified</span><span>
</span><a name="line-1837"></a><span class="hs-comment">-- portal, without waiting for completion.</span><span>
</span><a name="line-1838"></a><span class="hs-comment">--</span><span>
</span><a name="line-1839"></a><span class="hs-comment">-- This is an asynchronous version of 'describePortal': it returns</span><span>
</span><a name="line-1840"></a><span class="hs-comment">-- 'True' if it was able to dispatch the request, and 'False' if</span><span>
</span><a name="line-1841"></a><span class="hs-comment">-- not. After a successful call, call 'getResult' to obtain the</span><span>
</span><a name="line-1842"></a><span class="hs-comment">-- results. The function's parameters are handled identically to</span><span>
</span><a name="line-1843"></a><span class="hs-comment">-- 'describePortal'. Like 'describePortal', it will not work on</span><span>
</span><a name="line-1844"></a><span class="hs-comment">-- 2.0-protocol connections.</span><span>
</span><a name="line-1845"></a><span class="hs-identifier">sendDescribePortal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1846"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ portalName</span><span>
</span><a name="line-1847"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1848"></a><span class="hs-identifier">sendDescribePortal</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">portalName</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1849"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1850"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">portalName</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1851"></a><span>            </span><span class="hs-identifier">c_PQsendDescribePortal</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-1852"></a><span>
</span><a name="line-1853"></a><span>
</span><a name="line-1854"></a><span class="hs-comment">-- | Waits for the next result from a prior 'sendQuery',</span><span>
</span><a name="line-1855"></a><span class="hs-comment">-- 'sendQueryParams', 'sendPrepare', or 'sendQueryPrepared' call, and</span><span>
</span><a name="line-1856"></a><span class="hs-comment">-- returns it. A null pointer is returned when the command is complete</span><span>
</span><a name="line-1857"></a><span class="hs-comment">-- and there will be no more results.</span><span>
</span><a name="line-1858"></a><span class="hs-identifier">getResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1859"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span>
</span><a name="line-1860"></a><span class="hs-identifier">getResult</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1861"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">resPtr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQgetResult</span><span>
</span><a name="line-1862"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">resPtr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-1863"></a><span>           </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1864"></a><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">p_PQclear</span><span> </span><span class="hs-identifier">resPtr</span><span>
</span><a name="line-1865"></a><span>
</span><a name="line-1866"></a><span>
</span><a name="line-1867"></a><span class="hs-comment">-- | If input is available from the server, consume it.</span><span>
</span><a name="line-1868"></a><span class="hs-comment">--</span><span>
</span><a name="line-1869"></a><span class="hs-comment">-- 'consumeInput' normally returns 'True' indicating &quot;no error&quot;, but</span><span>
</span><a name="line-1870"></a><span class="hs-comment">-- returns 'False' if there was some kind of trouble (in which case</span><span>
</span><a name="line-1871"></a><span class="hs-comment">-- 'errorMessage' can be consulted). Note that the result does not say</span><span>
</span><a name="line-1872"></a><span class="hs-comment">-- whether any input data was actually collected. After calling</span><span>
</span><a name="line-1873"></a><span class="hs-comment">-- 'consumeInput', the application can check 'isBusy' and/or</span><span>
</span><a name="line-1874"></a><span class="hs-comment">-- 'notifies' to see if their state has changed.</span><span>
</span><a name="line-1875"></a><span class="hs-identifier">consumeInput</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1876"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1877"></a><span class="hs-identifier">consumeInput</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQconsumeInput</span><span>
</span><a name="line-1878"></a><span>
</span><a name="line-1879"></a><span>
</span><a name="line-1880"></a><span class="hs-comment">-- | Returns True if a command is busy, that is, getResult would block</span><span>
</span><a name="line-1881"></a><span class="hs-comment">-- waiting for input. A False return indicates that getResult can be</span><span>
</span><a name="line-1882"></a><span class="hs-comment">-- called with assurance of not blocking.</span><span>
</span><a name="line-1883"></a><span class="hs-comment">--</span><span>
</span><a name="line-1884"></a><span class="hs-comment">-- 'isBusy' will not itself attempt to read data from the server;</span><span>
</span><a name="line-1885"></a><span class="hs-comment">-- therefore 'consumeInput' must be invoked first, or the busy state</span><span>
</span><a name="line-1886"></a><span class="hs-comment">-- will never end.</span><span>
</span><a name="line-1887"></a><span class="hs-identifier">isBusy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1888"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1889"></a><span class="hs-identifier">isBusy</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQisBusy</span><span>
</span><a name="line-1890"></a><span>
</span><a name="line-1891"></a><span>
</span><a name="line-1892"></a><span class="hs-comment">-- | Sets the nonblocking status of the connection.</span><span>
</span><a name="line-1893"></a><span class="hs-identifier">setnonblocking</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1894"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1895"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1896"></a><span class="hs-identifier">setnonblocking</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">blocking</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1897"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">arg</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">blocking</span><span>
</span><a name="line-1898"></a><span>       </span><span class="hs-identifier">stat</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQsetnonblocking</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">arg</span><span>
</span><a name="line-1899"></a><span>       </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-1900"></a><span>
</span><a name="line-1901"></a><span>
</span><a name="line-1902"></a><span class="hs-comment">-- | Returns the blocking status of the database connection.</span><span>
</span><a name="line-1903"></a><span class="hs-identifier">isnonblocking</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1904"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1905"></a><span class="hs-identifier">isnonblocking</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQisnonblocking</span><span>
</span><a name="line-1906"></a><span>
</span><a name="line-1907"></a><span>
</span><a name="line-1908"></a><span class="hs-comment">-- | Select single-row mode for the currently-executing query.</span><span>
</span><a name="line-1909"></a><span class="hs-comment">--</span><span>
</span><a name="line-1910"></a><span class="hs-comment">-- This function can only be called immediately after PQsendQuery or one of its</span><span>
</span><a name="line-1911"></a><span class="hs-comment">-- sibling functions, before any other operation on the connection such as</span><span>
</span><a name="line-1912"></a><span class="hs-comment">-- PQconsumeInput or PQgetResult. If called at the correct time, the function</span><span>
</span><a name="line-1913"></a><span class="hs-comment">-- activates single-row mode for the current query and returns 1. Otherwise the</span><span>
</span><a name="line-1914"></a><span class="hs-comment">-- mode stays unchanged and the function returns 0. In any case, the mode</span><span>
</span><a name="line-1915"></a><span class="hs-comment">-- reverts to normal after completion of the current query.</span><span>
</span><a name="line-1916"></a><span class="hs-identifier">setSingleRowMode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1917"></a><span>                 </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-1918"></a><span class="hs-identifier">setSingleRowMode</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQsetSingleRowMode</span><span>
</span><a name="line-1919"></a><span>
</span><a name="line-1920"></a><span>
</span><a name="line-1921"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">FlushStatus</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">FlushOk</span><span>
</span><a name="line-1922"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">FlushFailed</span><span>
</span><a name="line-1923"></a><span>                 </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">FlushWriting</span><span>
</span><a name="line-1924"></a><span>                   </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-1925"></a><span>
</span><a name="line-1926"></a><span class="hs-comment">-- | Attempts to flush any queued output data to the server. Returns</span><span>
</span><a name="line-1927"></a><span class="hs-comment">-- 'FlushOk' if successful (or if the send queue is empty),</span><span>
</span><a name="line-1928"></a><span class="hs-comment">-- 'FlushFailed' if it failed for some reason, or 'FlushWriting' if it</span><span>
</span><a name="line-1929"></a><span class="hs-comment">-- was unable to send all the data in the send queue yet (this case</span><span>
</span><a name="line-1930"></a><span class="hs-comment">-- can only occur if the connection is nonblocking).</span><span>
</span><a name="line-1931"></a><span class="hs-identifier">flush</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1932"></a><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">FlushStatus</span><span>
</span><a name="line-1933"></a><span class="hs-identifier">flush</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1934"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">c_PQflush</span><span>
</span><a name="line-1935"></a><span>       </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1936"></a><span>         </span><span class="hs-number">0</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">FlushOk</span><span>
</span><a name="line-1937"></a><span>         </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">FlushWriting</span><span>
</span><a name="line-1938"></a><span>         </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">FlushFailed</span><span>
</span><a name="line-1939"></a><span>
</span><a name="line-1940"></a><span>
</span><a name="line-1941"></a><span class="hs-comment">-- $cancel</span><span>
</span><a name="line-1942"></a><span class="hs-comment">-- A client application can request cancellation of a command that is</span><span>
</span><a name="line-1943"></a><span class="hs-comment">-- still being processed by the server, using the functions described</span><span>
</span><a name="line-1944"></a><span class="hs-comment">-- in this section.</span><span>
</span><a name="line-1945"></a><span>
</span><a name="line-1946"></a><span class="hs-comment">-- | Contains the information needed to cancel a command issued</span><span>
</span><a name="line-1947"></a><span class="hs-comment">-- through a particular database connection.</span><span>
</span><a name="line-1948"></a><span class="hs-keyword">newtype</span><span> </span><span class="hs-identifier">Cancel</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Cancel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">ForeignPtr</span><span> </span><span class="hs-identifier">PGcancel</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-1949"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">PGcancel</span><span>
</span><a name="line-1950"></a><span>
</span><a name="line-1951"></a><span>
</span><a name="line-1952"></a><span class="hs-comment">-- | Creates a data structure containing the information needed to</span><span>
</span><a name="line-1953"></a><span class="hs-comment">-- cancel a command issued through a particular database connection.</span><span>
</span><a name="line-1954"></a><span class="hs-comment">--</span><span>
</span><a name="line-1955"></a><span class="hs-comment">-- 'getCancel' creates a 'Cancel' object given a 'Connection'. It will</span><span>
</span><a name="line-1956"></a><span class="hs-comment">-- return 'Nothing' if the given conn is an invalid connection.</span><span>
</span><a name="line-1957"></a><span>
</span><a name="line-1958"></a><span class="hs-identifier">getCancel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-1959"></a><span>          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Cancel</span><span class="hs-special">)</span><span>
</span><a name="line-1960"></a><span class="hs-identifier">getCancel</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1961"></a><span>    </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">conn</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-1962"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQgetCancel</span><span> </span><span class="hs-identifier">conn</span><span>
</span><a name="line-1963"></a><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-1964"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-1965"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">p_PQfreeCancel</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-1966"></a><span>                     </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Cancel</span><span> </span><span class="hs-identifier">fp</span><span>
</span><a name="line-1967"></a><span>
</span><a name="line-1968"></a><span>
</span><a name="line-1969"></a><span class="hs-comment">-- | Requests that the server abandon processing of the current</span><span>
</span><a name="line-1970"></a><span class="hs-comment">-- command.</span><span>
</span><a name="line-1971"></a><span class="hs-comment">--</span><span>
</span><a name="line-1972"></a><span class="hs-comment">-- The return value is 'Right ()' if the cancel request was</span><span>
</span><a name="line-1973"></a><span class="hs-comment">-- successfully dispatched and if not, 'Left B.ByteString' containing</span><span>
</span><a name="line-1974"></a><span class="hs-comment">-- an error message explaining why not.</span><span>
</span><a name="line-1975"></a><span class="hs-comment">--</span><span>
</span><a name="line-1976"></a><span class="hs-comment">-- Successful dispatch is no guarantee that the request will have any</span><span>
</span><a name="line-1977"></a><span class="hs-comment">-- effect, however. If the cancellation is effective, the current</span><span>
</span><a name="line-1978"></a><span class="hs-comment">-- command will terminate early and return an error result. If the</span><span>
</span><a name="line-1979"></a><span class="hs-comment">-- cancellation fails (say, because the server was already done</span><span>
</span><a name="line-1980"></a><span class="hs-comment">-- processing the command), then there will be no visible result at</span><span>
</span><a name="line-1981"></a><span class="hs-comment">-- all.</span><span>
</span><a name="line-1982"></a><span class="hs-identifier">cancel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Cancel</span><span>
</span><a name="line-1983"></a><span>       </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Either</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-1984"></a><span class="hs-identifier">cancel</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Cancel</span><span> </span><span class="hs-identifier">fp</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-1985"></a><span>    </span><span class="hs-identifier">withForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1986"></a><span>        </span><span class="hs-identifier">allocaBytes</span><span> </span><span class="hs-identifier">errbufsize</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">errbuf</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-1987"></a><span>            </span><span class="hs-identifier">res</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQcancel</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">errbuf</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">errbufsize</span><span>
</span><a name="line-1988"></a><span>            </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-1989"></a><span>              </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">Right</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-1990"></a><span>              </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Left</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">B.packCString</span><span> </span><span class="hs-identifier">errbuf</span><span>
</span><a name="line-1991"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-1992"></a><span>      </span><span class="hs-identifier">errbufsize</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">256</span><span>
</span><a name="line-1993"></a><span>
</span><a name="line-1994"></a><span>
</span><a name="line-1995"></a><span class="hs-comment">-- $asyncnotification</span><span>
</span><a name="line-1996"></a><span class="hs-comment">-- PostgreSQL offers asynchronous notification via the LISTEN and</span><span>
</span><a name="line-1997"></a><span class="hs-comment">-- NOTIFY commands. A client session registers its interest in a</span><span>
</span><a name="line-1998"></a><span class="hs-comment">-- particular notification channel with the LISTEN command (and can</span><span>
</span><a name="line-1999"></a><span class="hs-comment">-- stop listening with the UNLISTEN command). All sessions listening</span><span>
</span><a name="line-2000"></a><span class="hs-comment">-- on a particular channel will be notified asynchronously when a</span><span>
</span><a name="line-2001"></a><span class="hs-comment">-- NOTIFY command with that channel name is executed by any session. A</span><span>
</span><a name="line-2002"></a><span class="hs-comment">-- \&quot;payload\&quot; string can be passed to communicate additional data to</span><span>
</span><a name="line-2003"></a><span class="hs-comment">-- the listeners.</span><span>
</span><a name="line-2004"></a><span class="hs-comment">--</span><span>
</span><a name="line-2005"></a><span class="hs-comment">-- libpq applications submit LISTEN, UNLISTEN, and NOTIFY commands as</span><span>
</span><a name="line-2006"></a><span class="hs-comment">-- ordinary SQL commands. The arrival of NOTIFY messages can</span><span>
</span><a name="line-2007"></a><span class="hs-comment">-- subsequently be detected by calling 'notifies'.</span><span>
</span><a name="line-2008"></a><span>
</span><a name="line-2009"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Notify</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">Notify</span><span> </span><span class="hs-special">{</span><span>
</span><a name="line-2010"></a><span>      </span><span class="hs-identifier">notifyRelname</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ notification channel name</span><span>
</span><a name="line-2011"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">notifyBePid</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">CPid</span><span>         </span><span class="hs-comment">-- ^ process ID of notifying server process</span><span>
</span><a name="line-2012"></a><span>    </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">notifyExtra</span><span>   </span><span class="hs-glyph">::</span><span> </span><span class="hs-pragma">{-# UNPACK</span><span> </span><span class="hs-pragma">#-}</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-comment">-- ^ notification payload string</span><span>
</span><a name="line-2013"></a><span>    </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier">Show</span><span>
</span><a name="line-2014"></a><span>
</span><a name="line-2015"></a><span>
</span><a name="line-2016"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1953</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2017"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Storable</span><span> </span><span class="hs-identifier">Notify</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2018"></a><span>  </span><span class="hs-identifier">sizeOf</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">32</span><span class="hs-special">)</span><span>
</span><a name="line-2019"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1955</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2020"></a><span>
</span><a name="line-2021"></a><span>  </span><span class="hs-identifier">alignment</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-2022"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1957</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2023"></a><span>
</span><a name="line-2024"></a><span>  </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2025"></a><span>      </span><span class="hs-identifier">relname</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.packCString</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">peekByteOff</span><span> </span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-2026"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1960</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2027"></a><span>      </span><span class="hs-identifier">extra</span><span>   </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.packCString</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">peekByteOff</span><span> </span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-2028"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1961</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2029"></a><span>      </span><span class="hs-identifier">be_pid</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">peekByteOff</span><span> </span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-2030"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1962</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2031"></a><span>      </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Notify</span><span> </span><span class="hs-identifier">relname</span><span> </span><span class="hs-identifier">be_pid</span><span> </span><span class="hs-identifier">extra</span><span>
</span><a name="line-2032"></a><span>      </span><span class="hs-keyword">where</span><span>
</span><a name="line-2033"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CPid</span><span>
</span><a name="line-2034"></a><span>        </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span>
</span><a name="line-2035"></a><span>
</span><a name="line-2036"></a><span>  </span><span class="hs-identifier">poke</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Notify</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-identifier">c</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2037"></a><span>      </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">a'</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2038"></a><span>        </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c'</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2039"></a><span>            </span><span class="hs-keyword">do</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pokeByteOff</span><span> </span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">a'</span><span>
</span><a name="line-2040"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1971</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2041"></a><span>               </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pokeByteOff</span><span> </span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span>  </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">b</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span class="hs-special">)</span><span>
</span><a name="line-2042"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1972</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2043"></a><span>               </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">pokeByteOff</span><span> </span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-number">16</span><span class="hs-special">)</span><span>   </span><span class="hs-identifier">ptr</span><span> </span><span class="hs-identifier">c'</span><span>
</span><a name="line-2044"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">1973</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2045"></a><span>
</span><a name="line-2046"></a><span>
</span><a name="line-2047"></a><span class="hs-comment">-- | Returns the next notification from a list of unhandled</span><span>
</span><a name="line-2048"></a><span class="hs-comment">-- notification messages received from the server. It returns a</span><span>
</span><a name="line-2049"></a><span class="hs-comment">-- 'Nothing' if there are no pending notifications. Once a</span><span>
</span><a name="line-2050"></a><span class="hs-comment">-- notification is returned from notifies, it is considered handled</span><span>
</span><a name="line-2051"></a><span class="hs-comment">-- and will be removed from the list of notifications.</span><span>
</span><a name="line-2052"></a><span class="hs-identifier">notifies</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-2053"></a><span>         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Notify</span><span class="hs-special">)</span><span>
</span><a name="line-2054"></a><span class="hs-identifier">notifies</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2055"></a><span>    </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2056"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">mn</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQnotifies</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-2057"></a><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">mn</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-2058"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2059"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2060"></a><span>                     </span><span class="hs-identifier">result</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">peek</span><span> </span><span class="hs-identifier">mn</span><span>
</span><a name="line-2061"></a><span>                     </span><span class="hs-identifier">c_PQfreemem</span><span> </span><span class="hs-identifier">mn</span><span>
</span><a name="line-2062"></a><span>                     </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">result</span><span>
</span><a name="line-2063"></a><span>
</span><a name="line-2064"></a><span>
</span><a name="line-2065"></a><span class="hs-comment">-- $control</span><span>
</span><a name="line-2066"></a><span class="hs-comment">-- These functions control miscellaneous details of libpq's behavior.</span><span>
</span><a name="line-2067"></a><span>
</span><a name="line-2068"></a><span class="hs-comment">-- | Returns the client encoding.</span><span>
</span><a name="line-2069"></a><span class="hs-identifier">clientEncoding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-2070"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">B.ByteString</span><span>
</span><a name="line-2071"></a><span class="hs-identifier">clientEncoding</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2072"></a><span>    </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2073"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">i</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_PQclientEncoding</span><span> </span><span class="hs-identifier">ptr</span><span>
</span><a name="line-2074"></a><span>           </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_pg_encoding_to_char</span><span> </span><span class="hs-identifier">i</span><span>
</span><a name="line-2075"></a><span>           </span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">B.c_strlen</span><span> </span><span class="hs-identifier">cstr</span><span>
</span><a name="line-2076"></a><span>           </span><span class="hs-identifier">fp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">cstr</span><span>
</span><a name="line-2077"></a><span>           </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span>
</span><a name="line-2078"></a><span>
</span><a name="line-2079"></a><span>
</span><a name="line-2080"></a><span class="hs-comment">-- | Sets the client encoding.</span><span>
</span><a name="line-2081"></a><span class="hs-identifier">setClientEncoding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Bool</span><span>
</span><a name="line-2082"></a><span class="hs-identifier">setClientEncoding</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">enc</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2083"></a><span>    </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2084"></a><span>               </span><span class="hs-identifier">B.useAsCString</span><span> </span><span class="hs-identifier">enc</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">s</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2085"></a><span>                   </span><span class="hs-identifier">c_PQsetClientEncoding</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">s</span><span>
</span><a name="line-2086"></a><span>
</span><a name="line-2087"></a><span>       </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">stat</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2088"></a><span>
</span><a name="line-2089"></a><span>
</span><a name="line-2090"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">Verbosity</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ErrorsTerse</span><span>
</span><a name="line-2091"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ErrorsDefault</span><span>
</span><a name="line-2092"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">ErrorsVerbose</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-2093"></a><span>
</span><a name="line-2094"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-identifier">Verbosity</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-2095"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ErrorsTerse</span><span>
</span><a name="line-2096"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2024</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2097"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ErrorsDefault</span><span>
</span><a name="line-2098"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2025</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2099"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">ErrorsVerbose</span><span>
</span><a name="line-2100"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2026</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2101"></a><span>    </span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">error</span><span> </span><span class="hs-string">&quot;Database.PQ.Enum.Verbosity.toEnum: bad argument&quot;</span><span>
</span><a name="line-2102"></a><span>
</span><a name="line-2103"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">ErrorsTerse</span><span>   </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-2104"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2029</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2105"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">ErrorsDefault</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-2106"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2030</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2107"></a><span>    </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">ErrorsVerbose</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-2108"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2031</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2109"></a><span>
</span><a name="line-2110"></a><span>
</span><a name="line-2111"></a><span class="hs-comment">-- | Determines the verbosity of messages returned by 'errorMessage'</span><span>
</span><a name="line-2112"></a><span class="hs-comment">-- and 'resultErrorMessage'.</span><span>
</span><a name="line-2113"></a><span class="hs-comment">--</span><span>
</span><a name="line-2114"></a><span class="hs-comment">-- 'setErrorVerbosity' sets the verbosity mode, returning the</span><span>
</span><a name="line-2115"></a><span class="hs-comment">-- connection's previous setting. In 'ErrorsTerse' mode, returned</span><span>
</span><a name="line-2116"></a><span class="hs-comment">-- messages include severity, primary text, and position only; this</span><span>
</span><a name="line-2117"></a><span class="hs-comment">-- will normally fit on a single line. The default mode produces</span><span>
</span><a name="line-2118"></a><span class="hs-comment">-- messages that include the above plus any detail, hint, or context</span><span>
</span><a name="line-2119"></a><span class="hs-comment">-- fields (these might span multiple lines). The 'ErrorsVerbose' mode</span><span>
</span><a name="line-2120"></a><span class="hs-comment">-- includes all available fields. Changing the verbosity does not</span><span>
</span><a name="line-2121"></a><span class="hs-comment">-- affect the messages available from already-existing 'Result'</span><span>
</span><a name="line-2122"></a><span class="hs-comment">-- objects, only subsequently-created ones.</span><span>
</span><a name="line-2123"></a><span class="hs-identifier">setErrorVerbosity</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-2124"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Verbosity</span><span>
</span><a name="line-2125"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Verbosity</span><span>
</span><a name="line-2126"></a><span class="hs-identifier">setErrorVerbosity</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">verbosity</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2127"></a><span>    </span><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2128"></a><span>        </span><span class="hs-identifier">c_PQsetErrorVerbosity</span><span> </span><span class="hs-identifier">p</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">fromEnum</span><span> </span><span class="hs-identifier">verbosity</span><span>
</span><a name="line-2129"></a><span>
</span><a name="line-2130"></a><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integral</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-2131"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-2132"></a><span>             </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span>
</span><a name="line-2133"></a><span class="hs-identifier">enumFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">fromIntegral</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2134"></a><span>
</span><a name="line-2135"></a><span>
</span><a name="line-2136"></a><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span>
</span><a name="line-2137"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2138"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span>
</span><a name="line-2139"></a><span class="hs-identifier">resultFromConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2140"></a><span>    </span><span class="hs-identifier">mask_</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2141"></a><span>       </span><span class="hs-identifier">resPtr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2142"></a><span>       </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">resPtr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-2143"></a><span>           </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2144"></a><span>           </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">Result</span><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">p_PQclear</span><span> </span><span class="hs-identifier">resPtr</span><span>
</span><a name="line-2145"></a><span>
</span><a name="line-2146"></a><span>
</span><a name="line-2147"></a><span class="hs-identifier">withResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-2148"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span>
</span><a name="line-2149"></a><span>           </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span>
</span><a name="line-2150"></a><span class="hs-identifier">withResult</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Result</span><span> </span><span class="hs-identifier">fp</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2151"></a><span>
</span><a name="line-2152"></a><span>
</span><a name="line-2153"></a><span class="hs-identifier">numFromResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integral</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Num</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-2154"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-2155"></a><span>              </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span>
</span><a name="line-2156"></a><span class="hs-identifier">numFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2157"></a><span>
</span><a name="line-2158"></a><span>
</span><a name="line-2159"></a><span class="hs-identifier">enumFromResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Integral</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Enum</span><span> </span><span class="hs-identifier">b</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-2160"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">a</span><span class="hs-special">)</span><span>
</span><a name="line-2161"></a><span>               </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">b</span><span>
</span><a name="line-2162"></a><span class="hs-identifier">enumFromResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">toEnum</span><span> </span><span class="hs-operator">.</span><span> </span><span class="hs-identifier">fromIntegral</span><span class="hs-special">)</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-identifier">withResult</span><span> </span><span class="hs-identifier">result</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2163"></a><span>
</span><a name="line-2164"></a><span>
</span><a name="line-2165"></a><span class="hs-comment">-- | Returns a ByteString with a finalizer that touches the ForeignPtr</span><span>
</span><a name="line-2166"></a><span class="hs-comment">-- PGresult that \&quot;owns\&quot; the CString to keep it alive.</span><span>
</span><a name="line-2167"></a><span class="hs-comment">--</span><span>
</span><a name="line-2168"></a><span class="hs-comment">-- The CString must be a null terminated c string. nullPtrs are</span><span>
</span><a name="line-2169"></a><span class="hs-comment">-- treated as 'Nothing'.</span><span>
</span><a name="line-2170"></a><span class="hs-identifier">maybeBsFromResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Result</span><span>
</span><a name="line-2171"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span class="hs-special">)</span><span>
</span><a name="line-2172"></a><span>                  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-2173"></a><span class="hs-identifier">maybeBsFromResult</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Result</span><span> </span><span class="hs-identifier">res</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">maybeBsFromForeignPtr</span><span> </span><span class="hs-identifier">res</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2174"></a><span>
</span><a name="line-2175"></a><span class="hs-comment">-- | Returns a ByteString with a finalizer that touches the ForeignPtr</span><span>
</span><a name="line-2176"></a><span class="hs-comment">-- that \&quot;owns\&quot; the CString to keep it alive.</span><span>
</span><a name="line-2177"></a><span class="hs-comment">--</span><span>
</span><a name="line-2178"></a><span class="hs-comment">-- The CString must be a null terminated c string. nullPtrs are</span><span>
</span><a name="line-2179"></a><span class="hs-comment">-- treated as 'Nothing'.</span><span>
</span><a name="line-2180"></a><span class="hs-identifier">maybeBsFromForeignPtr</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">ForeignPtr</span><span> </span><span class="hs-identifier">a</span><span>
</span><a name="line-2181"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span class="hs-special">)</span><span>
</span><a name="line-2182"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-2183"></a><span class="hs-identifier">maybeBsFromForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2184"></a><span>    </span><span class="hs-identifier">withForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">p</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-2185"></a><span>        </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">p</span><span>
</span><a name="line-2186"></a><span>           </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">cstr</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-2187"></a><span>             </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2188"></a><span>             </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span> </span><span class="hs-identifier">l</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-special">`</span><span class="hs-identifier">fmap</span><span class="hs-special">`</span><span> </span><span class="hs-identifier">B.c_strlen</span><span> </span><span class="hs-identifier">cstr</span><span>
</span><a name="line-2189"></a><span>                     </span><span class="hs-identifier">fp'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">FC.newForeignPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">cstr</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">finalizer</span><span>
</span><a name="line-2190"></a><span>                     </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">fp'</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">l</span><span>
</span><a name="line-2191"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-2192"></a><span>      </span><span class="hs-identifier">finalizer</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">touchForeignPtr</span><span> </span><span class="hs-identifier">fp</span><span>
</span><a name="line-2193"></a><span>
</span><a name="line-2194"></a><span class="hs-comment">-- -- | Returns a ByteString with a finalizer that touches the ForeignPtr</span><span>
</span><a name="line-2195"></a><span class="hs-comment">-- -- that \&quot;owns\&quot; the CStringLen to keep it alive.</span><span>
</span><a name="line-2196"></a><span class="hs-comment">-- bsFromForeignPtrLen :: ForeignPtr a</span><span>
</span><a name="line-2197"></a><span class="hs-comment">--                     -&gt; (Ptr a -&gt; IO CStringLen)</span><span>
</span><a name="line-2198"></a><span class="hs-comment">--                     -&gt; IO B.ByteString</span><span>
</span><a name="line-2199"></a><span class="hs-comment">-- bsFromForeignPtrLen fp f =</span><span>
</span><a name="line-2200"></a><span class="hs-comment">--     withForeignPtr fp $ \p -&gt;</span><span>
</span><a name="line-2201"></a><span class="hs-comment">--         do (cstr, l) &lt;- f p</span><span>
</span><a name="line-2202"></a><span class="hs-comment">--            if cstr == nullPtr</span><span>
</span><a name="line-2203"></a><span class="hs-comment">--              then return &quot;&quot;</span><span>
</span><a name="line-2204"></a><span class="hs-comment">--              else do fp' &lt;- FC.newForeignPtr (castPtr cstr) finalizer</span><span>
</span><a name="line-2205"></a><span class="hs-comment">--                      return $ B.fromForeignPtr fp' 0 l</span><span>
</span><a name="line-2206"></a><span class="hs-comment">--     where</span><span>
</span><a name="line-2207"></a><span class="hs-comment">--       finalizer = touchForeignPtr fp</span><span>
</span><a name="line-2208"></a><span>
</span><a name="line-2209"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">NoticeReceiver</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">NoticeBuffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2210"></a><span>
</span><a name="line-2211"></a><span class="hs-keyword">data</span><span> </span><span class="hs-identifier">PGnotice</span><span>
</span><a name="line-2212"></a><span>
</span><a name="line-2213"></a><span class="hs-comment">-- | Upon connection initialization, any notices received from the server are</span><span>
</span><a name="line-2214"></a><span class="hs-comment">--   normally written to the console.  Notices are akin to warnings, and</span><span>
</span><a name="line-2215"></a><span class="hs-comment">--   are distinct from notifications.  This function suppresses notices.</span><span>
</span><a name="line-2216"></a><span class="hs-comment">--   You may later call 'enableNoticeReporting' after calling this function.</span><span>
</span><a name="line-2217"></a><span class="hs-identifier">disableNoticeReporting</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2218"></a><span class="hs-identifier">disableNoticeReporting</span><span> </span><span class="hs-identifier">conn</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">nbRef</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2219"></a><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQsetNoticeReceiver</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">p_discard_notices</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-2220"></a><span>    </span><span class="hs-identifier">nb</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">swapMVar</span><span> </span><span class="hs-identifier">nbRef</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-2221"></a><span>    </span><span class="hs-identifier">c_free_noticebuffer</span><span> </span><span class="hs-identifier">nb</span><span>
</span><a name="line-2222"></a><span>
</span><a name="line-2223"></a><span class="hs-comment">-- | Upon connection initialization, any notices received from the server are</span><span>
</span><a name="line-2224"></a><span class="hs-comment">--   normally written to the console.  Notices are akin to warnings, and</span><span>
</span><a name="line-2225"></a><span class="hs-comment">--   are distinct from notifications.  This function enables notices to be</span><span>
</span><a name="line-2226"></a><span class="hs-comment">--   programmatically retreived using the 'getNotice' function.   You may</span><span>
</span><a name="line-2227"></a><span class="hs-comment">--   later call 'disableNoticeReporting' after calling this function.</span><span>
</span><a name="line-2228"></a><span class="hs-identifier">enableNoticeReporting</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2229"></a><span class="hs-identifier">enableNoticeReporting</span><span> </span><span class="hs-identifier">conn</span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">nbRef</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2230"></a><span>  </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">isNullConnection</span><span> </span><span class="hs-identifier">conn</span><span>
</span><a name="line-2231"></a><span>    </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2232"></a><span>    </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2233"></a><span>      </span><span class="hs-identifier">nb'</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_malloc_noticebuffer</span><span>
</span><a name="line-2234"></a><span>      </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">conn</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">c_PQsetNoticeReceiver</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">p_store_notices</span><span> </span><span class="hs-identifier">nb'</span><span>
</span><a name="line-2235"></a><span>      </span><span class="hs-identifier">nb</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">swapMVar</span><span> </span><span class="hs-identifier">nbRef</span><span> </span><span class="hs-identifier">nb'</span><span>
</span><a name="line-2236"></a><span>      </span><span class="hs-identifier">c_free_noticebuffer</span><span> </span><span class="hs-identifier">nb</span><span>
</span><a name="line-2237"></a><span>
</span><a name="line-2238"></a><span class="hs-comment">-- |  This function retrieves any notices received from the backend.</span><span>
</span><a name="line-2239"></a><span class="hs-comment">--    Because multiple notices can be received at a time,  you will</span><span>
</span><a name="line-2240"></a><span class="hs-comment">--    typically want to call this function in a loop until you get</span><span>
</span><a name="line-2241"></a><span class="hs-comment">--    back a 'Nothing'.</span><span>
</span><a name="line-2242"></a><span class="hs-identifier">getNotice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-2243"></a><span class="hs-identifier">getNotice</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Conn</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">nbRef</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-2244"></a><span>    </span><span class="hs-identifier">withMVar</span><span> </span><span class="hs-identifier">nbRef</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">nb</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2245"></a><span>      </span><span class="hs-identifier">np</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_get_notice</span><span> </span><span class="hs-identifier">nb</span><span>
</span><a name="line-2246"></a><span>      </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">np</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">nullPtr</span><span>
</span><a name="line-2247"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2248"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2249"></a><span>          </span><span class="hs-identifier">fp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">finalizerFree</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">castPtr</span><span> </span><span class="hs-identifier">np</span><span class="hs-special">)</span><span>
</span><a name="line-2250"></a><span>          </span><span class="hs-identifier">len</span><span>  </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">peekByteOff</span><span> </span><span class="hs-identifier">hsc_ptr</span><span> </span><span class="hs-number">8</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">np</span><span>
</span><a name="line-2251"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2173</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2252"></a><span>          </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">B.PS</span><span> </span><span class="hs-identifier">fp</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-number">16</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">len</span><span>
</span><a name="line-2253"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2174</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2254"></a><span>
</span><a name="line-2255"></a><span class="hs-comment">-- $largeobjects</span><span>
</span><a name="line-2256"></a><span>
</span><a name="line-2257"></a><span class="hs-comment">-- | LoFd is a Large Object (pseudo) File Descriptor.  It is understood by</span><span>
</span><a name="line-2258"></a><span class="hs-comment">-- libpq but not by operating system calls.</span><span>
</span><a name="line-2259"></a><span>
</span><a name="line-2260"></a><span class="hs-keyword">newtype</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Eq</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Ord</span><span class="hs-special">,</span><span> </span><span class="hs-identifier">Show</span><span class="hs-special">)</span><span>
</span><a name="line-2261"></a><span>
</span><a name="line-2262"></a><span class="hs-identifier">loMode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IOMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2263"></a><span class="hs-identifier">loMode</span><span> </span><span class="hs-identifier">mode</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">mode</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2264"></a><span>                </span><span class="hs-identifier">ReadMode</span><span>      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">262144</span><span class="hs-special">)</span><span>
</span><a name="line-2265"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2185</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2266"></a><span>                </span><span class="hs-identifier">WriteMode</span><span>     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">131072</span><span class="hs-special">)</span><span>
</span><a name="line-2267"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2186</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2268"></a><span>                </span><span class="hs-identifier">ReadWriteMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">262144</span><span class="hs-special">)</span><span> </span><span class="hs-operator">.|.</span><span> </span><span class="hs-special">(</span><span class="hs-number">131072</span><span class="hs-special">)</span><span>
</span><a name="line-2269"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2187</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2270"></a><span>                </span><span class="hs-identifier">AppendMode</span><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-number">131072</span><span class="hs-special">)</span><span>
</span><a name="line-2271"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2188</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2272"></a><span>
</span><a name="line-2273"></a><span class="hs-identifier">toMaybeOid</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Oid</span><span class="hs-special">)</span><span>
</span><a name="line-2274"></a><span class="hs-identifier">toMaybeOid</span><span> </span><span class="hs-identifier">oid</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">oid</span><span> </span><span class="hs-operator">==</span><span> </span><span class="hs-identifier">invalidOid</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2275"></a><span>               </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span>         </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-identifier">oid</span><span class="hs-special">)</span><span>
</span><a name="line-2276"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">toMaybeOid</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2277"></a><span>
</span><a name="line-2278"></a><span class="hs-identifier">nonnegInt</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span>
</span><a name="line-2279"></a><span class="hs-identifier">nonnegInt</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">x</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2280"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">nonnegInt</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2281"></a><span>
</span><a name="line-2282"></a><span class="hs-identifier">negError</span><span>  </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2283"></a><span class="hs-identifier">negError</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">x</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2284"></a><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">negError</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2285"></a><span>
</span><a name="line-2286"></a><span class="hs-comment">-- | Creates a new large object,  returns the Object ID of the newly created</span><span>
</span><a name="line-2287"></a><span class="hs-comment">-- object.</span><span>
</span><a name="line-2288"></a><span>
</span><a name="line-2289"></a><span class="hs-identifier">loCreat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Oid</span><span class="hs-special">)</span><span>
</span><a name="line-2290"></a><span class="hs-identifier">loCreat</span><span> </span><span class="hs-identifier">connection</span><span>
</span><a name="line-2291"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2292"></a><span>        </span><span class="hs-identifier">toMaybeOid</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_creat</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">loMode</span><span> </span><span class="hs-identifier">ReadMode</span><span class="hs-special">)</span><span>
</span><a name="line-2293"></a><span>
</span><a name="line-2294"></a><span class="hs-comment">-- | Creates a new large object with a particular Object ID.  Returns</span><span>
</span><a name="line-2295"></a><span class="hs-comment">-- 'Nothing' if the requested Object ID is already in use by some other</span><span>
</span><a name="line-2296"></a><span class="hs-comment">-- large object or other failure.  If 'invalidOid' is used as a parameter,</span><span>
</span><a name="line-2297"></a><span class="hs-comment">-- then 'loCreate' will assign an unused 'Oid'.</span><span>
</span><a name="line-2298"></a><span>
</span><a name="line-2299"></a><span class="hs-identifier">loCreate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Oid</span><span class="hs-special">)</span><span>
</span><a name="line-2300"></a><span class="hs-identifier">loCreate</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">oid</span><span>
</span><a name="line-2301"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2302"></a><span>        </span><span class="hs-identifier">toMaybeOid</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_create</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">oid</span><span>
</span><a name="line-2303"></a><span>
</span><a name="line-2304"></a><span class="hs-comment">-- | Imports an operating system file as a large object.  Note that the</span><span>
</span><a name="line-2305"></a><span class="hs-comment">-- file is read by the client interface library, not by the server; so it</span><span>
</span><a name="line-2306"></a><span class="hs-comment">-- must exist in the client file system and be readable by the client</span><span>
</span><a name="line-2307"></a><span class="hs-comment">-- application.</span><span>
</span><a name="line-2308"></a><span>
</span><a name="line-2309"></a><span class="hs-identifier">loImport</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Oid</span><span class="hs-special">)</span><span>
</span><a name="line-2310"></a><span class="hs-identifier">loImport</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">filepath</span><span>
</span><a name="line-2311"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2312"></a><span>        </span><span class="hs-identifier">withCString</span><span> </span><span class="hs-identifier">filepath</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2313"></a><span>          </span><span class="hs-identifier">toMaybeOid</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_import</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2314"></a><span>
</span><a name="line-2315"></a><span class="hs-comment">-- | Imports an operating system file as a large object with the given</span><span>
</span><a name="line-2316"></a><span class="hs-comment">-- Object ID.  Combines the behavior of 'loImport' and 'loCreate'</span><span>
</span><a name="line-2317"></a><span>
</span><a name="line-2318"></a><span class="hs-identifier">loImportWithOid</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Oid</span><span class="hs-special">)</span><span>
</span><a name="line-2319"></a><span class="hs-identifier">loImportWithOid</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">filepath</span><span> </span><span class="hs-identifier">oid</span><span>
</span><a name="line-2320"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2321"></a><span>        </span><span class="hs-identifier">withCString</span><span> </span><span class="hs-identifier">filepath</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2322"></a><span>          </span><span class="hs-identifier">toMaybeOid</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_import_with_oid</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">f</span><span> </span><span class="hs-identifier">oid</span><span>
</span><a name="line-2323"></a><span>
</span><a name="line-2324"></a><span class="hs-comment">-- | Exports a large object into a operating system file.  Note that</span><span>
</span><a name="line-2325"></a><span class="hs-comment">-- the file is written by the client interface library, not the server.</span><span>
</span><a name="line-2326"></a><span class="hs-comment">-- Returns 'Just ()' on success,  'Nothing' on failure.</span><span>
</span><a name="line-2327"></a><span>
</span><a name="line-2328"></a><span class="hs-identifier">loExport</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FilePath</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2329"></a><span class="hs-identifier">loExport</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">oid</span><span> </span><span class="hs-identifier">filepath</span><span>
</span><a name="line-2330"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2331"></a><span>        </span><span class="hs-identifier">withCString</span><span> </span><span class="hs-identifier">filepath</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">f</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2332"></a><span>          </span><span class="hs-identifier">negError</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_export</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">oid</span><span> </span><span class="hs-identifier">f</span><span>
</span><a name="line-2333"></a><span>
</span><a name="line-2334"></a><span class="hs-comment">-- | Opens an existing large object for reading or writing.  The Oid specifies</span><span>
</span><a name="line-2335"></a><span class="hs-comment">-- the large object to open.  A large object cannot be opened before it is</span><span>
</span><a name="line-2336"></a><span class="hs-comment">-- created.  A large object descriptor is returned for later use in 'loRead',</span><span>
</span><a name="line-2337"></a><span class="hs-comment">-- 'loWrite', 'loSeek', 'loTell', and 'loClose'.   The descriptor is only valid</span><span>
</span><a name="line-2338"></a><span class="hs-comment">-- for the duration of the current transation.   On failure,  'Nothing' is</span><span>
</span><a name="line-2339"></a><span class="hs-comment">-- returned.</span><span>
</span><a name="line-2340"></a><span class="hs-comment">--</span><span>
</span><a name="line-2341"></a><span class="hs-comment">-- The server currently does not distinguish between 'WriteMode' and</span><span>
</span><a name="line-2342"></a><span class="hs-comment">-- 'ReadWriteMode';  write-only modes are not enforced.  However there</span><span>
</span><a name="line-2343"></a><span class="hs-comment">-- is a significant difference between 'ReadMode' and the other modes:</span><span>
</span><a name="line-2344"></a><span class="hs-comment">-- with 'ReadMode' you cannot write on the descriptor,  and the data read</span><span>
</span><a name="line-2345"></a><span class="hs-comment">-- from it will reflect the contents of the large object at the time of</span><span>
</span><a name="line-2346"></a><span class="hs-comment">-- the transaction snapshot that was active when 'loOpen' was executed,</span><span>
</span><a name="line-2347"></a><span class="hs-comment">-- regardless of later writes by this or other transactions.   Reading from</span><span>
</span><a name="line-2348"></a><span class="hs-comment">-- a descriptor opened in 'WriteMode', 'ReadWriteMode', or 'AppendMode'</span><span>
</span><a name="line-2349"></a><span class="hs-comment">-- returns data that reflects all writes of other committed transactions</span><span>
</span><a name="line-2350"></a><span class="hs-comment">-- as well as the writes of the current transaction.   This is similar to</span><span>
</span><a name="line-2351"></a><span class="hs-comment">-- the behavior of @REPEATABLE READ@ versus @READ COMMITTED@ transaction</span><span>
</span><a name="line-2352"></a><span class="hs-comment">-- modes for ordinary SQL @SELECT@ commands.</span><span>
</span><a name="line-2353"></a><span>
</span><a name="line-2354"></a><span class="hs-identifier">loOpen</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IOMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">LoFd</span><span class="hs-special">)</span><span>
</span><a name="line-2355"></a><span class="hs-identifier">loOpen</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">oid</span><span> </span><span class="hs-identifier">mode</span><span>
</span><a name="line-2356"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2357"></a><span>        </span><span class="hs-identifier">fd</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_lo_open</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">oid</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">loMode</span><span> </span><span class="hs-identifier">mode</span><span class="hs-special">)</span><span>
</span><a name="line-2358"></a><span>        </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2359"></a><span>          </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2360"></a><span>          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">mode</span><span> </span><span class="hs-operator">/=</span><span> </span><span class="hs-identifier">AppendMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2361"></a><span>            </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier">otherwise</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2362"></a><span>                </span><span class="hs-comment">-- The Large Object API does not directly support AppendMode,</span><span>
</span><a name="line-2363"></a><span>                </span><span class="hs-comment">-- so we emulate it.</span><span>
</span><a name="line-2364"></a><span>
</span><a name="line-2365"></a><span>                </span><span class="hs-comment">-- FIXME:  review this emulation as it and/or the error</span><span>
</span><a name="line-2366"></a><span>                </span><span class="hs-comment">--         handling is likely to be slightly wrong.  Start by</span><span>
</span><a name="line-2367"></a><span>                </span><span class="hs-comment">--         reading the source of lo_open, lo_lseek, and</span><span>
</span><a name="line-2368"></a><span>                </span><span class="hs-comment">--         lo_close.</span><span>
</span><a name="line-2369"></a><span>                </span><span class="hs-identifier">err</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_lo_lseek</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-special">)</span><span>
</span><a name="line-2370"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2286</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2371"></a><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">err</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2372"></a><span>                  </span><span class="hs-glyph">-</span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2373"></a><span>                          </span><span class="hs-comment">-- the lo_lseek failed, so we try to close the fd</span><span>
</span><a name="line-2374"></a><span>
</span><a name="line-2375"></a><span>                          </span><span class="hs-comment">-- I'm  not sure what to do if lo_close fails so I am</span><span>
</span><a name="line-2376"></a><span>                          </span><span class="hs-comment">-- ignoring it.  This might obscure the error message</span><span>
</span><a name="line-2377"></a><span>                          </span><span class="hs-comment">-- available from PQerrorMessage</span><span>
</span><a name="line-2378"></a><span>                          </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_lo_close</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span>
</span><a name="line-2379"></a><span>                          </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2380"></a><span>                  </span><span class="hs-identifier">_</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">return</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Just</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2381"></a><span>
</span><a name="line-2382"></a><span class="hs-comment">-- | @loWrite conn fd buf@ writes the bytestring @buf@ to the large object</span><span>
</span><a name="line-2383"></a><span class="hs-comment">-- descriptor @fd@.  The number of bytes actually written is returned.</span><span>
</span><a name="line-2384"></a><span class="hs-comment">-- In the event of an error, 'Nothing' is returned.</span><span>
</span><a name="line-2385"></a><span>
</span><a name="line-2386"></a><span class="hs-identifier">loWrite</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">B.ByteString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span>
</span><a name="line-2387"></a><span class="hs-identifier">loWrite</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">bytes</span><span>
</span><a name="line-2388"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2389"></a><span>        </span><span class="hs-identifier">B.unsafeUseAsCStringLen</span><span> </span><span class="hs-identifier">bytes</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">byteptr</span><span class="hs-special">,</span><span class="hs-identifier">len</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2390"></a><span>          </span><span class="hs-identifier">nonnegInt</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_write</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">byteptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len</span><span class="hs-special">)</span><span>
</span><a name="line-2391"></a><span>
</span><a name="line-2392"></a><span class="hs-comment">-- | @loRead conn fd len@ reads up to @len@ bytes from the large object</span><span>
</span><a name="line-2393"></a><span class="hs-comment">-- descriptor @fd@.  In the event of an error,  'Nothing' is returned.</span><span>
</span><a name="line-2394"></a><span>
</span><a name="line-2395"></a><span class="hs-identifier">loRead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">B.ByteString</span><span class="hs-special">)</span><span>
</span><a name="line-2396"></a><span class="hs-identifier">loRead</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">!</span><span class="hs-identifier">maxlen</span><span>
</span><a name="line-2397"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2398"></a><span>        </span><span class="hs-identifier">buf</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">mallocBytes</span><span> </span><span class="hs-identifier">maxlen</span><span>
</span><a name="line-2399"></a><span>        </span><span class="hs-identifier">len_</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_lo_read</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">maxlen</span><span class="hs-special">)</span><span>
</span><a name="line-2400"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">len_</span><span>
</span><a name="line-2401"></a><span>        </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier">len</span><span> </span><span class="hs-operator">&lt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2402"></a><span>          </span><span class="hs-keyword">then</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2403"></a><span>                  </span><span class="hs-identifier">free</span><span> </span><span class="hs-identifier">buf</span><span>
</span><a name="line-2404"></a><span>                  </span><span class="hs-identifier">return</span><span> </span><span class="hs-identifier">Nothing</span><span>
</span><a name="line-2405"></a><span>          </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2406"></a><span>                  </span><span class="hs-identifier">bufre</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">reallocBytes</span><span> </span><span class="hs-identifier">buf</span><span> </span><span class="hs-identifier">len</span><span>
</span><a name="line-2407"></a><span>                  </span><span class="hs-identifier">buffp</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">newForeignPtr</span><span> </span><span class="hs-identifier">finalizerFree</span><span> </span><span class="hs-identifier">bufre</span><span>
</span><a name="line-2408"></a><span>                  </span><span class="hs-identifier">return</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">Just</span><span> </span><span class="hs-operator">$!</span><span> </span><span class="hs-identifier">B.fromForeignPtr</span><span> </span><span class="hs-identifier">buffp</span><span> </span><span class="hs-number">0</span><span> </span><span class="hs-identifier">len</span><span>
</span><a name="line-2409"></a><span>
</span><a name="line-2410"></a><span class="hs-comment">-- | Changes the current read or write location associated with</span><span>
</span><a name="line-2411"></a><span class="hs-comment">-- a large object descriptor.    The return value is the new location</span><span>
</span><a name="line-2412"></a><span class="hs-comment">-- pointer,  or 'Nothing' on error.</span><span>
</span><a name="line-2413"></a><span>
</span><a name="line-2414"></a><span class="hs-identifier">loSeek</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">SeekMode</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span>
</span><a name="line-2415"></a><span class="hs-identifier">loSeek</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">seekmode</span><span> </span><span class="hs-identifier">delta</span><span>
</span><a name="line-2416"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2417"></a><span>        </span><span class="hs-keyword">let</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">delta</span><span>
</span><a name="line-2418"></a><span>        </span><span class="hs-identifier">pos</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-identifier">c_lo_lseek</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-identifier">d</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">seekmode</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-2419"></a><span>                                     </span><span class="hs-identifier">AbsoluteSeek</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-2420"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2335</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2421"></a><span>                                     </span><span class="hs-identifier">RelativeSeek</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-2422"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2336</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2423"></a><span>                                     </span><span class="hs-identifier">SeekFromEnd</span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-2424"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2337</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2425"></a><span>        </span><span class="hs-identifier">nonnegInt</span><span> </span><span class="hs-identifier">pos</span><span>
</span><a name="line-2426"></a><span>
</span><a name="line-2427"></a><span class="hs-comment">-- | Obtains the current read or write location of a large object descriptor.</span><span>
</span><a name="line-2428"></a><span>
</span><a name="line-2429"></a><span class="hs-identifier">loTell</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-identifier">Int</span><span class="hs-special">)</span><span>
</span><a name="line-2430"></a><span class="hs-identifier">loTell</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><a name="line-2431"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2432"></a><span>        </span><span class="hs-identifier">nonnegInt</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_tell</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span>
</span><a name="line-2433"></a><span>
</span><a name="line-2434"></a><span class="hs-comment">-- | Truncates a large object to a given length.  If the length is greater</span><span>
</span><a name="line-2435"></a><span class="hs-comment">-- than the current large object,  then the large object is extended with</span><span>
</span><a name="line-2436"></a><span class="hs-comment">-- null bytes.  ('\x00')</span><span>
</span><a name="line-2437"></a><span class="hs-comment">--</span><span>
</span><a name="line-2438"></a><span class="hs-comment">-- The file offest is not changed.</span><span>
</span><a name="line-2439"></a><span class="hs-comment">--</span><span>
</span><a name="line-2440"></a><span class="hs-comment">-- 'loTruncate' is new as of PostgreSQL 8.3; if this function is run against</span><span>
</span><a name="line-2441"></a><span class="hs-comment">-- an older server version, it will fail and return 'Nothing'</span><span>
</span><a name="line-2442"></a><span>
</span><a name="line-2443"></a><span class="hs-identifier">loTruncate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2444"></a><span class="hs-identifier">loTruncate</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span> </span><span class="hs-identifier">size</span><span>
</span><a name="line-2445"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2446"></a><span>        </span><span class="hs-identifier">negError</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_truncate</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">fromIntegral</span><span> </span><span class="hs-identifier">size</span><span class="hs-special">)</span><span>
</span><a name="line-2447"></a><span>
</span><a name="line-2448"></a><span class="hs-comment">-- | Closes a large object descriptor.  Any large object descriptors that</span><span>
</span><a name="line-2449"></a><span class="hs-comment">-- remain open at the end of a transaction will be closed automatically.</span><span>
</span><a name="line-2450"></a><span>
</span><a name="line-2451"></a><span class="hs-identifier">loClose</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2452"></a><span class="hs-identifier">loClose</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">LoFd</span><span> </span><span class="hs-identifier">fd</span><span class="hs-special">)</span><span>
</span><a name="line-2453"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2454"></a><span>        </span><span class="hs-identifier">negError</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_close</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">fd</span><span>
</span><a name="line-2455"></a><span>
</span><a name="line-2456"></a><span class="hs-comment">-- | Removes a large object from the database.</span><span>
</span><a name="line-2457"></a><span>
</span><a name="line-2458"></a><span class="hs-identifier">loUnlink</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Connection</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2459"></a><span class="hs-identifier">loUnlink</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-identifier">oid</span><span>
</span><a name="line-2460"></a><span>    </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">withConn</span><span> </span><span class="hs-identifier">connection</span><span> </span><span class="hs-operator">$</span><span> </span><span class="hs-glyph">\</span><span class="hs-identifier">c</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-2461"></a><span>        </span><span class="hs-identifier">negError</span><span> </span><span class="hs-operator">=&lt;&lt;</span><span> </span><span class="hs-identifier">c_lo_unlink</span><span> </span><span class="hs-identifier">c</span><span> </span><span class="hs-identifier">oid</span><span>
</span><a name="line-2462"></a><span>
</span><a name="line-2463"></a><span>
</span><a name="line-2464"></a><span>
</span><a name="line-2465"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQconnectdb&quot;</span><span>
</span><a name="line-2466"></a><span>    </span><span class="hs-identifier">c_PQconnectdb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span class="hs-special">)</span><span>
</span><a name="line-2467"></a><span>
</span><a name="line-2468"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQconnectStart&quot;</span><span>
</span><a name="line-2469"></a><span>    </span><span class="hs-identifier">c_PQconnectStart</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span class="hs-special">)</span><span>
</span><a name="line-2470"></a><span>
</span><a name="line-2471"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQconnectPoll&quot;</span><span>
</span><a name="line-2472"></a><span>    </span><span class="hs-identifier">c_PQconnectPoll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2473"></a><span>
</span><a name="line-2474"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQdb&quot;</span><span>
</span><a name="line-2475"></a><span>    </span><span class="hs-identifier">c_PQdb</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2476"></a><span>
</span><a name="line-2477"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQuser&quot;</span><span>
</span><a name="line-2478"></a><span>    </span><span class="hs-identifier">c_PQuser</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2479"></a><span>
</span><a name="line-2480"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQpass&quot;</span><span>
</span><a name="line-2481"></a><span>    </span><span class="hs-identifier">c_PQpass</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2482"></a><span>
</span><a name="line-2483"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQhost&quot;</span><span>
</span><a name="line-2484"></a><span>    </span><span class="hs-identifier">c_PQhost</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2485"></a><span>
</span><a name="line-2486"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQport&quot;</span><span>
</span><a name="line-2487"></a><span>    </span><span class="hs-identifier">c_PQport</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2488"></a><span>
</span><a name="line-2489"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQoptions&quot;</span><span>
</span><a name="line-2490"></a><span>    </span><span class="hs-identifier">c_PQoptions</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2491"></a><span>
</span><a name="line-2492"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQbackendPID&quot;</span><span>
</span><a name="line-2493"></a><span>    </span><span class="hs-identifier">c_PQbackendPID</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2494"></a><span>
</span><a name="line-2495"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQconnectionNeedsPassword&quot;</span><span>
</span><a name="line-2496"></a><span>    </span><span class="hs-identifier">c_PQconnectionNeedsPassword</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2497"></a><span>
</span><a name="line-2498"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQconnectionUsedPassword&quot;</span><span>
</span><a name="line-2499"></a><span>    </span><span class="hs-identifier">c_PQconnectionUsedPassword</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2500"></a><span>
</span><a name="line-2501"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQstatus&quot;</span><span>
</span><a name="line-2502"></a><span>    </span><span class="hs-identifier">c_PQstatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2503"></a><span>
</span><a name="line-2504"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQtransactionStatus&quot;</span><span>
</span><a name="line-2505"></a><span>    </span><span class="hs-identifier">c_PQtransactionStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2506"></a><span>
</span><a name="line-2507"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQparameterStatus&quot;</span><span>
</span><a name="line-2508"></a><span>    </span><span class="hs-identifier">c_PQparameterStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2509"></a><span>
</span><a name="line-2510"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQprotocolVersion&quot;</span><span>
</span><a name="line-2511"></a><span>    </span><span class="hs-identifier">c_PQprotocolVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2512"></a><span>
</span><a name="line-2513"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQserverVersion&quot;</span><span>
</span><a name="line-2514"></a><span>    </span><span class="hs-identifier">c_PQserverVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2515"></a><span>
</span><a name="line-2516"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-string">&quot;dynamic&quot;</span><span>
</span><a name="line-2517"></a><span>    </span><span class="hs-identifier">mkLibpqVersion</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Int</span><span>
</span><a name="line-2518"></a><span>
</span><a name="line-2519"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQsocket&quot;</span><span>
</span><a name="line-2520"></a><span>    </span><span class="hs-identifier">c_PQsocket</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2521"></a><span>
</span><a name="line-2522"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQerrorMessage&quot;</span><span>
</span><a name="line-2523"></a><span>    </span><span class="hs-identifier">c_PQerrorMessage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2524"></a><span>
</span><a name="line-2525"></a><span>
</span><a name="line-2526"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2438</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2527"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQfinish&quot;</span><span>
</span><a name="line-2528"></a><span>    </span><span class="hs-identifier">c_PQfinish</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2529"></a><span>
</span><a name="line-2530"></a><span class="hs-pragma">{-# LINE</span><span> </span><span class="hs-pragma">2444</span><span> </span><span class="hs-pragma">&quot;src/Database/PostgreSQL/LibPQ.hsc&quot;</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><a name="line-2531"></a><span>
</span><a name="line-2532"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQreset&quot;</span><span>
</span><a name="line-2533"></a><span>    </span><span class="hs-identifier">c_PQreset</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2534"></a><span>
</span><a name="line-2535"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQresetStart&quot;</span><span>
</span><a name="line-2536"></a><span>    </span><span class="hs-identifier">c_PQresetStart</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2537"></a><span>
</span><a name="line-2538"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQresetPoll&quot;</span><span>
</span><a name="line-2539"></a><span>    </span><span class="hs-identifier">c_PQresetPoll</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2540"></a><span>
</span><a name="line-2541"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQclientEncoding&quot;</span><span>
</span><a name="line-2542"></a><span>    </span><span class="hs-identifier">c_PQclientEncoding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2543"></a><span>
</span><a name="line-2544"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h pg_encoding_to_char&quot;</span><span>
</span><a name="line-2545"></a><span>    </span><span class="hs-identifier">c_pg_encoding_to_char</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2546"></a><span>
</span><a name="line-2547"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsetClientEncoding&quot;</span><span>
</span><a name="line-2548"></a><span>    </span><span class="hs-identifier">c_PQsetClientEncoding</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2549"></a><span>
</span><a name="line-2550"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">PGVerbosity</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2551"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQsetErrorVerbosity&quot;</span><span>
</span><a name="line-2552"></a><span>    </span><span class="hs-identifier">c_PQsetErrorVerbosity</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">PGVerbosity</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">PGVerbosity</span><span>
</span><a name="line-2553"></a><span>
</span><a name="line-2554"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQputCopyData&quot;</span><span>
</span><a name="line-2555"></a><span>    </span><span class="hs-identifier">c_PQputCopyData</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CChar</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2556"></a><span>
</span><a name="line-2557"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQputCopyEnd&quot;</span><span>
</span><a name="line-2558"></a><span>    </span><span class="hs-identifier">c_PQputCopyEnd</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2559"></a><span>
</span><a name="line-2560"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQgetCopyData&quot;</span><span>
</span><a name="line-2561"></a><span>    </span><span class="hs-identifier">c_PQgetCopyData</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2562"></a><span>
</span><a name="line-2563"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsendQuery&quot;</span><span>
</span><a name="line-2564"></a><span>    </span><span class="hs-identifier">c_PQsendQuery</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2565"></a><span>
</span><a name="line-2566"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsendQueryParams&quot;</span><span>
</span><a name="line-2567"></a><span>    </span><span class="hs-identifier">c_PQsendQueryParams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2568"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2569"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2570"></a><span>
</span><a name="line-2571"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsendPrepare&quot;</span><span>
</span><a name="line-2572"></a><span>    </span><span class="hs-identifier">c_PQsendPrepare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2573"></a><span>                    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2574"></a><span>
</span><a name="line-2575"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsendQueryPrepared&quot;</span><span>
</span><a name="line-2576"></a><span>    </span><span class="hs-identifier">c_PQsendQueryPrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2577"></a><span>                          </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2578"></a><span>
</span><a name="line-2579"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsendDescribePrepared&quot;</span><span>
</span><a name="line-2580"></a><span>    </span><span class="hs-identifier">c_PQsendDescribePrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2581"></a><span>
</span><a name="line-2582"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsendDescribePortal&quot;</span><span>
</span><a name="line-2583"></a><span>    </span><span class="hs-identifier">c_PQsendDescribePortal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2584"></a><span>
</span><a name="line-2585"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQflush&quot;</span><span>
</span><a name="line-2586"></a><span>    </span><span class="hs-identifier">c_PQflush</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2587"></a><span>
</span><a name="line-2588"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQgetCancel&quot;</span><span>
</span><a name="line-2589"></a><span>    </span><span class="hs-identifier">c_PQgetCancel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGcancel</span><span class="hs-special">)</span><span>
</span><a name="line-2590"></a><span>
</span><a name="line-2591"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h &amp;PQfreeCancel&quot;</span><span>
</span><a name="line-2592"></a><span>    </span><span class="hs-identifier">p_PQfreeCancel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGcancel</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2593"></a><span>
</span><a name="line-2594"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQcancel&quot;</span><span>
</span><a name="line-2595"></a><span>    </span><span class="hs-identifier">c_PQcancel</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGcancel</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2596"></a><span>
</span><a name="line-2597"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQnotifies&quot;</span><span>
</span><a name="line-2598"></a><span>    </span><span class="hs-identifier">c_PQnotifies</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Notify</span><span class="hs-special">)</span><span>
</span><a name="line-2599"></a><span>
</span><a name="line-2600"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQconsumeInput&quot;</span><span>
</span><a name="line-2601"></a><span>    </span><span class="hs-identifier">c_PQconsumeInput</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2602"></a><span>
</span><a name="line-2603"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQisBusy&quot;</span><span>
</span><a name="line-2604"></a><span>    </span><span class="hs-identifier">c_PQisBusy</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2605"></a><span>
</span><a name="line-2606"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQsetnonblocking&quot;</span><span>
</span><a name="line-2607"></a><span>    </span><span class="hs-identifier">c_PQsetnonblocking</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2608"></a><span>
</span><a name="line-2609"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQisnonblocking&quot;</span><span>
</span><a name="line-2610"></a><span>    </span><span class="hs-identifier">c_PQisnonblocking</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2611"></a><span>
</span><a name="line-2612"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQsetSingleRowMode&quot;</span><span>
</span><a name="line-2613"></a><span>    </span><span class="hs-identifier">c_PQsetSingleRowMode</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2614"></a><span>
</span><a name="line-2615"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQgetResult&quot;</span><span>
</span><a name="line-2616"></a><span>    </span><span class="hs-identifier">c_PQgetResult</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span>
</span><a name="line-2617"></a><span>
</span><a name="line-2618"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQexec&quot;</span><span>
</span><a name="line-2619"></a><span>    </span><span class="hs-identifier">c_PQexec</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span>
</span><a name="line-2620"></a><span>
</span><a name="line-2621"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQexecParams&quot;</span><span>
</span><a name="line-2622"></a><span>    </span><span class="hs-identifier">c_PQexecParams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2623"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2624"></a><span>                   </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span>
</span><a name="line-2625"></a><span>
</span><a name="line-2626"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQprepare&quot;</span><span>
</span><a name="line-2627"></a><span>    </span><span class="hs-identifier">c_PQprepare</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2628"></a><span>                </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span>
</span><a name="line-2629"></a><span>
</span><a name="line-2630"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQexecPrepared&quot;</span><span>
</span><a name="line-2631"></a><span>    </span><span class="hs-identifier">c_PQexecPrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2632"></a><span>                     </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span>
</span><a name="line-2633"></a><span>
</span><a name="line-2634"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQdescribePrepared&quot;</span><span>
</span><a name="line-2635"></a><span>    </span><span class="hs-identifier">c_PQdescribePrepared</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span>
</span><a name="line-2636"></a><span>
</span><a name="line-2637"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQdescribePortal&quot;</span><span>
</span><a name="line-2638"></a><span>    </span><span class="hs-identifier">c_PQdescribePortal</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span class="hs-special">)</span><span>
</span><a name="line-2639"></a><span>
</span><a name="line-2640"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h &amp;PQclear&quot;</span><span>
</span><a name="line-2641"></a><span>    </span><span class="hs-identifier">p_PQclear</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2642"></a><span>
</span><a name="line-2643"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQresultStatus&quot;</span><span>
</span><a name="line-2644"></a><span>    </span><span class="hs-identifier">c_PQresultStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2645"></a><span>
</span><a name="line-2646"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQresStatus&quot;</span><span>
</span><a name="line-2647"></a><span>    </span><span class="hs-identifier">c_PQresStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2648"></a><span>
</span><a name="line-2649"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQresultErrorMessage&quot;</span><span>
</span><a name="line-2650"></a><span>    </span><span class="hs-identifier">c_PQresultErrorMessage</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2651"></a><span>
</span><a name="line-2652"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQresultErrorField&quot;</span><span>
</span><a name="line-2653"></a><span>    </span><span class="hs-identifier">c_PQresultErrorField</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2654"></a><span>
</span><a name="line-2655"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQntuples&quot;</span><span>
</span><a name="line-2656"></a><span>    </span><span class="hs-identifier">c_PQntuples</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2657"></a><span>
</span><a name="line-2658"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQnfields&quot;</span><span>
</span><a name="line-2659"></a><span>    </span><span class="hs-identifier">c_PQnfields</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2660"></a><span>
</span><a name="line-2661"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQfname&quot;</span><span>
</span><a name="line-2662"></a><span>    </span><span class="hs-identifier">c_PQfname</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2663"></a><span>
</span><a name="line-2664"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQfnumber&quot;</span><span>
</span><a name="line-2665"></a><span>    </span><span class="hs-identifier">c_PQfnumber</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2666"></a><span>
</span><a name="line-2667"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQftable&quot;</span><span>
</span><a name="line-2668"></a><span>    </span><span class="hs-identifier">c_PQftable</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2669"></a><span>
</span><a name="line-2670"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQftablecol&quot;</span><span>
</span><a name="line-2671"></a><span>    </span><span class="hs-identifier">c_PQftablecol</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2672"></a><span>
</span><a name="line-2673"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQfformat&quot;</span><span>
</span><a name="line-2674"></a><span>    </span><span class="hs-identifier">c_PQfformat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2675"></a><span>
</span><a name="line-2676"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQftype&quot;</span><span>
</span><a name="line-2677"></a><span>    </span><span class="hs-identifier">c_PQftype</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2678"></a><span>
</span><a name="line-2679"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQfmod&quot;</span><span>
</span><a name="line-2680"></a><span>    </span><span class="hs-identifier">c_PQfmod</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2681"></a><span>
</span><a name="line-2682"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQfsize&quot;</span><span>
</span><a name="line-2683"></a><span>    </span><span class="hs-identifier">c_PQfsize</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2684"></a><span>
</span><a name="line-2685"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQgetvalue&quot;</span><span>
</span><a name="line-2686"></a><span>    </span><span class="hs-identifier">c_PQgetvalue</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2687"></a><span>
</span><a name="line-2688"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQgetisnull&quot;</span><span>
</span><a name="line-2689"></a><span>    </span><span class="hs-identifier">c_PQgetisnull</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2690"></a><span>
</span><a name="line-2691"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQgetlength&quot;</span><span>
</span><a name="line-2692"></a><span>    </span><span class="hs-identifier">c_PQgetlength</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2693"></a><span>
</span><a name="line-2694"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQnparams&quot;</span><span>
</span><a name="line-2695"></a><span>    </span><span class="hs-identifier">c_PQnparams</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2696"></a><span>
</span><a name="line-2697"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQparamtype&quot;</span><span>
</span><a name="line-2698"></a><span>    </span><span class="hs-identifier">c_PQparamtype</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2699"></a><span>
</span><a name="line-2700"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQcmdStatus&quot;</span><span>
</span><a name="line-2701"></a><span>    </span><span class="hs-identifier">c_PQcmdStatus</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2702"></a><span>
</span><a name="line-2703"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQcmdTuples&quot;</span><span>
</span><a name="line-2704"></a><span>    </span><span class="hs-identifier">c_PQcmdTuples</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGresult</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2705"></a><span>
</span><a name="line-2706"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQescapeStringConn&quot;</span><span>
</span><a name="line-2707"></a><span>    </span><span class="hs-identifier">c_PQescapeStringConn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span>
</span><a name="line-2708"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-comment">-- Actually (CString)</span><span>
</span><a name="line-2709"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2710"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-2711"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2712"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-2713"></a><span>
</span><a name="line-2714"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQescapeByteaConn&quot;</span><span>
</span><a name="line-2715"></a><span>    </span><span class="hs-identifier">c_PQescapeByteaConn</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span>
</span><a name="line-2716"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-comment">-- Actually (Ptr CUChar)</span><span>
</span><a name="line-2717"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-2718"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-2719"></a><span>                        </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Actually (IO (Ptr CUChar))</span><span>
</span><a name="line-2720"></a><span>
</span><a name="line-2721"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fe.h PQunescapeBytea&quot;</span><span>
</span><a name="line-2722"></a><span>    </span><span class="hs-identifier">c_PQunescapeBytea</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-comment">-- Actually (Ptr CUChar)</span><span>
</span><a name="line-2723"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-2724"></a><span>                      </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- Actually (IO (Ptr CUChar))</span><span>
</span><a name="line-2725"></a><span>
</span><a name="line-2726"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQescapeIdentifier&quot;</span><span>
</span><a name="line-2727"></a><span>    </span><span class="hs-identifier">c_PQescapeIdentifier</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span>
</span><a name="line-2728"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2729"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span>
</span><a name="line-2730"></a><span>                         </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CString</span><span>
</span><a name="line-2731"></a><span>
</span><a name="line-2732"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h &amp;PQfreemem&quot;</span><span>
</span><a name="line-2733"></a><span>    </span><span class="hs-identifier">p_PQfreemem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-2734"></a><span>
</span><a name="line-2735"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQfreemem&quot;</span><span>
</span><a name="line-2736"></a><span>    </span><span class="hs-identifier">c_PQfreemem</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">a</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2737"></a><span>
</span><a name="line-2738"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;noticehandlers.h hs_postgresql_libpq_malloc_noticebuffer&quot;</span><span>
</span><a name="line-2739"></a><span>    </span><span class="hs-identifier">c_malloc_noticebuffer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CNoticeBuffer</span><span class="hs-special">)</span><span>
</span><a name="line-2740"></a><span>
</span><a name="line-2741"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;noticehandlers.h hs_postgresql_libpq_free_noticebuffer&quot;</span><span>
</span><a name="line-2742"></a><span>    </span><span class="hs-identifier">c_free_noticebuffer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CNoticeBuffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-2743"></a><span>
</span><a name="line-2744"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;noticehandlers.h hs_postgresql_libpq_get_notice&quot;</span><span>
</span><a name="line-2745"></a><span>    </span><span class="hs-identifier">c_get_notice</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CNoticeBuffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGnotice</span><span class="hs-special">)</span><span>
</span><a name="line-2746"></a><span>
</span><a name="line-2747"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;noticehandlers.h &amp;hs_postgresql_libpq_discard_notices&quot;</span><span>
</span><a name="line-2748"></a><span>    </span><span class="hs-identifier">p_discard_notices</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">NoticeReceiver</span><span>
</span><a name="line-2749"></a><span>
</span><a name="line-2750"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;noticehandlers.h &amp;hs_postgresql_libpq_store_notices&quot;</span><span>
</span><a name="line-2751"></a><span>    </span><span class="hs-identifier">p_store_notices</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">NoticeReceiver</span><span>
</span><a name="line-2752"></a><span>
</span><a name="line-2753"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span> </span><span class="hs-keyword">unsafe</span><span> </span><span class="hs-string">&quot;libpq-fe.h PQsetNoticeReceiver&quot;</span><span>
</span><a name="line-2754"></a><span>    </span><span class="hs-identifier">c_PQsetNoticeReceiver</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">NoticeReceiver</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">CNoticeBuffer</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">FunPtr</span><span> </span><span class="hs-identifier">NoticeReceiver</span><span class="hs-special">)</span><span>
</span><a name="line-2755"></a><span>
</span><a name="line-2756"></a><span>
</span><a name="line-2757"></a><span class="hs-keyword">type</span><span> </span><span class="hs-identifier">CFd</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2758"></a><span>
</span><a name="line-2759"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_creat&quot;</span><span>
</span><a name="line-2760"></a><span>    </span><span class="hs-identifier">c_lo_creat</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2761"></a><span>
</span><a name="line-2762"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_create&quot;</span><span>
</span><a name="line-2763"></a><span>    </span><span class="hs-identifier">c_lo_create</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2764"></a><span>
</span><a name="line-2765"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_import&quot;</span><span>
</span><a name="line-2766"></a><span>    </span><span class="hs-identifier">c_lo_import</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2767"></a><span>
</span><a name="line-2768"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_import_with_oid&quot;</span><span>
</span><a name="line-2769"></a><span>    </span><span class="hs-identifier">c_lo_import_with_oid</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">Oid</span><span>
</span><a name="line-2770"></a><span>
</span><a name="line-2771"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_export&quot;</span><span>
</span><a name="line-2772"></a><span>    </span><span class="hs-identifier">c_lo_export</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2773"></a><span>
</span><a name="line-2774"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_open&quot;</span><span>
</span><a name="line-2775"></a><span>    </span><span class="hs-identifier">c_lo_open</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CFd</span><span>
</span><a name="line-2776"></a><span>
</span><a name="line-2777"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_write&quot;</span><span>
</span><a name="line-2778"></a><span>    </span><span class="hs-identifier">c_lo_write</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CString</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2779"></a><span>
</span><a name="line-2780"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_read&quot;</span><span>
</span><a name="line-2781"></a><span>    </span><span class="hs-identifier">c_lo_read</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">Word8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2782"></a><span>
</span><a name="line-2783"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_lseek&quot;</span><span>
</span><a name="line-2784"></a><span>    </span><span class="hs-identifier">c_lo_lseek</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CInt</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2785"></a><span>
</span><a name="line-2786"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_tell&quot;</span><span>
</span><a name="line-2787"></a><span>    </span><span class="hs-identifier">c_lo_tell</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2788"></a><span>
</span><a name="line-2789"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_truncate&quot;</span><span>
</span><a name="line-2790"></a><span>    </span><span class="hs-identifier">c_lo_truncate</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CSize</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2791"></a><span>
</span><a name="line-2792"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_close&quot;</span><span>
</span><a name="line-2793"></a><span>    </span><span class="hs-identifier">c_lo_close</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">CFd</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2794"></a><span>
</span><a name="line-2795"></a><span class="hs-keyword">foreign</span><span> </span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">ccall</span><span>        </span><span class="hs-string">&quot;libpq-fs.h lo_unlink&quot;</span><span>
</span><a name="line-2796"></a><span>    </span><span class="hs-identifier">c_lo_unlink</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier">Ptr</span><span> </span><span class="hs-identifier">PGconn</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">Oid</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">IO</span><span> </span><span class="hs-identifier">CInt</span><span>
</span><a name="line-2797"></a></pre></body></html>